var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
// eslint-disable-next-line max-classes-per-file
import { DeviceFactory, Entity, EntityFactory, Role, User, UserFactory, } from '../binding';
import { ManagedType } from './ManagedType';
import { PersistenceType } from './Type';
import { BasicType } from './BasicType';
import { SingularAttribute } from './SingularAttribute';
import { PluralAttribute } from './PluralAttribute';
import { Attribute } from './Attribute';
import { Metadata, Permission } from '../intersection';
export class EntityType extends ManagedType {
    /**
     * @param ref
     * @param superType
     * @param typeConstructor
     */
    constructor(ref, superType, typeConstructor) {
        super(ref, typeConstructor);
        this.declaredId = null;
        this.declaredVersion = null;
        this.declaredAcl = null;
        this.loadPermission = new Permission();
        this.updatePermission = new Permission();
        this.deletePermission = new Permission();
        this.queryPermission = new Permission();
        this.schemaSubclassPermission = new Permission();
        this.insertPermission = new Permission();
        this.superType = superType;
    }
    /**
     * @inheritDoc
     */
    get persistenceType() {
        return PersistenceType.ENTITY;
    }
    get id() {
        return this.declaredId || this.superType.id;
    }
    get version() {
        return this.declaredVersion || this.superType.version;
    }
    get acl() {
        return this.declaredAcl || this.superType.acl;
    }
    /**
     * @inheritDoc
     */
    createProxyClass() {
        let { typeConstructor } = this.superType;
        if (typeConstructor === Object) {
            switch (this.name) {
                case 'User':
                    typeConstructor = User;
                    break;
                case 'Role':
                    typeConstructor = Role;
                    break;
                default:
                    typeConstructor = Entity;
                    break;
            }
        }
        return this.enhancer.createProxy(typeConstructor);
    }
    /**
     * Gets all on this class referencing attributes
     *
     * @param db The instances will be found by this EntityManager
     * @param [options] Some options to pass
     * @param [options.classes] An array of class names to filter for, null for no filter
     * @return A map from every referencing class to a set of its referencing attribute names
     */
    getReferencing(db, options) {
        const opts = Object.assign({}, options);
        const { entities } = db.metamodel;
        const referencing = new Map();
        const names = Object.keys(entities);
        for (let i = 0, len = names.length; i < len; i += 1) {
            const name = names[i];
            // Skip class if not in class filter
            if (!opts.classes || opts.classes.indexOf(name) !== -1) {
                const entity = entities[name];
                const iter = entity.attributes();
                for (let el = iter.next(); !el.done; el = iter.next()) {
                    const attr = el.value;
                    // Filter only referencing singular and collection attributes
                    if ((attr instanceof SingularAttribute && attr.type === this)
                        || (attr instanceof PluralAttribute && attr.elementType === this)) {
                        const typeReferences = referencing.get(attr.declaringType) || new Set();
                        typeReferences.add(attr.name);
                        referencing.set(attr.declaringType, typeReferences);
                    }
                }
            }
        }
        return referencing;
    }
    /**
     * @inheritDoc
     */
    createObjectFactory(db) {
        switch (this.name) {
            case 'User':
                return UserFactory.create(this, db);
            case 'Device':
                return DeviceFactory.create(this, db);
            default:
                return EntityFactory.create(this, db);
        }
    }
    /**
     * @param state The root object state, can be <code>null</code> if a currentObject is provided
     * @param jsonObject The json data to merge
     * @param currentObject The object where the jsonObject will be merged into, if the current object is null,
     * a new instance will be created
     * @param options The options used to apply the json
     * @param [options.persisting=false] indicates if the current state will be persisted.
     * Used to update the internal change tracking state of collections and mark the object persistent or dirty afterwards
     * @param [options.onlyMetadata=false] Indicates if only the metadata should be updated
     * @return The merged entity instance
     */
    fromJsonValue(state, jsonObject, currentObject, options) {
        var _a, _b;
        // handle references
        if (typeof jsonObject === 'string') {
            return ((_a = state.db) === null || _a === void 0 ? void 0 : _a.getReference(jsonObject)) || null;
        }
        if (!jsonObject || typeof jsonObject !== 'object') {
            return null;
        }
        const json = jsonObject;
        const opt = Object.assign({ persisting: false, onlyMetadata: false }, options);
        let obj;
        if (currentObject) {
            const currentObjectState = Metadata.get(currentObject);
            // merge state into the current object if:
            // 1. The provided json does not contains an id and we have an already created object for it
            // 2. The object was created without an id and was later fetched from the server (e.g. User/Role)
            // 3. The provided json has the same id as the current object, they can differ on embedded json for a reference
            if (!json.id || !currentObjectState.id || json.id === currentObjectState.id) {
                obj = currentObject;
            }
        }
        if (!obj) {
            obj = (_b = state.db) === null || _b === void 0 ? void 0 : _b.getReference(this.typeConstructor, json.id);
        }
        if (!obj) {
            return null;
        }
        const objectState = Metadata.get(obj);
        // deserialize our properties
        objectState.enable(false);
        super.fromJsonValue(objectState, json, obj, opt);
        objectState.enable(true);
        if (opt.persisting) {
            objectState.setPersistent();
        }
        else if (!opt.onlyMetadata) {
            objectState.setDirty();
        }
        return obj;
    }
    /**
     * Converts the given object to json
     * @param state The root object state
     * @param object The object to convert
     * @param [options=false] to json options by default excludes the metadata
     * @param [options.excludeMetadata=false] Excludes the metadata form the serialized json
     * @param [options.depth=0] Includes up to depth referenced objects into the serialized json
     * @param [options.persisting=false] indicates if the current state will be persisted.
     *  Used to update the internal change tracking state of collections and mark the object persistent if its true
     * @return JSON-Object
     */
    toJsonValue(state, object, options) {
        const { depth = 0, persisting = false } = options || {};
        const isInDepth = depth === true || depth > -1;
        // check if object is already loaded in state
        const objectState = object && Metadata.get(object);
        if (isInDepth && objectState && objectState.isAvailable) {
            // serialize our properties
            objectState.enable(false);
            const json = super.toJsonValue(objectState, object, Object.assign(Object.assign({}, options), { persisting, depth: typeof depth === 'boolean' ? depth : depth - 1 }));
            objectState.enable(true);
            return json;
        }
        if (state.db && object instanceof this.typeConstructor) {
            object.attach(state.db);
            return object.id;
        }
        return null;
    }
    toString() {
        return `EntityType(${this.ref})`;
    }
    toJSON() {
        const _a = super.toJSON(), { acl } = _a, json = __rest(_a, ["acl"]);
        return Object.assign(Object.assign({}, json), { acl: Object.assign(Object.assign({}, acl), { schemaSubclass: this.schemaSubclassPermission.toJSON(), load: this.loadPermission.toJSON(), insert: this.insertPermission.toJSON(), update: this.updatePermission.toJSON(), delete: this.deletePermission.toJSON(), query: this.queryPermission.toJSON() }) });
    }
}
EntityType.Object = class ObjectType extends EntityType {
    static get ref() {
        return '/db/Object';
    }
    constructor() {
        super(EntityType.Object.ref, null, Object);
        this.declaredId = new class extends SingularAttribute {
            constructor() {
                super('id', BasicType.String, true);
            }
            getJsonValue(state) {
                return state.id || undefined;
            }
            setJsonValue(state, object, jsonValue) {
                if (!state.id) {
                    // eslint-disable-next-line no-param-reassign
                    state.id = jsonValue;
                }
            }
        }();
        this.declaredId.init(this, 0);
        this.declaredId.isId = true;
        this.declaredVersion = new class extends SingularAttribute {
            constructor() {
                super('version', BasicType.Integer, true);
            }
            getJsonValue(state) {
                return state.version || undefined;
            }
            setJsonValue(state, object, jsonValue) {
                if (jsonValue) {
                    // eslint-disable-next-line no-param-reassign
                    state.version = jsonValue;
                }
            }
        }();
        this.declaredVersion.init(this, 1);
        this.declaredVersion.isVersion = true;
        this.declaredAcl = new class extends SingularAttribute {
            constructor() {
                super('acl', BasicType.JsonObject, true);
            }
            getJsonValue(state, object, options) {
                const persisted = Attribute.attachState(object, {});
                const persistedAcl = persisted.acl || {};
                const acl = state.acl.toJSON();
                const unchanged = Object.keys(acl).every((permission) => {
                    const oldPermission = (persistedAcl[permission] || {});
                    const newPermission = acl[permission];
                    const newKeys = Object.keys(newPermission);
                    const oldKeys = Object.keys(oldPermission);
                    return newKeys.length === oldKeys.length
                        && newKeys.every((ref) => oldPermission[ref] === newPermission[ref]);
                });
                if (!unchanged) {
                    state.setDirty();
                }
                if (options.persisting) {
                    persisted.acl = acl;
                }
                return acl;
            }
            setJsonValue(state, object, jsonValue, options) {
                const acl = (jsonValue || {});
                if (options.persisting) {
                    const persistedState = Attribute.attachState(object, {});
                    persistedState.acl = acl;
                }
                state.acl.fromJSON(acl);
            }
        }();
        this.declaredAcl.init(this, 2);
        this.declaredAcl.isAcl = true;
        this.declaredAttributes = [this.declaredId, this.declaredVersion, this.declaredAcl];
    }
    createObjectFactory() {
        throw new Error("Objects can't be directly created and persisted");
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5VHlwZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9tZXRhbW9kZWwvRW50aXR5VHlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLGdEQUFnRDtBQUNoRCxPQUFPLEVBQ0wsYUFBYSxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQVcsSUFBSSxFQUFFLElBQUksRUFBRSxXQUFXLEdBQ3ZFLE1BQU0sWUFBWSxDQUFDO0FBR3BCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUN6QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3hELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFnQixNQUFNLGlCQUFpQixDQUFDO0FBRXJFLE1BQU0sT0FBTyxVQUE2QixTQUFRLFdBQWM7SUE0STlEOzs7O09BSUc7SUFDSCxZQUFZLEdBQVcsRUFBRSxTQUEwQixFQUFFLGVBQTBCO1FBQzdFLEtBQUssQ0FBQyxHQUFHLEVBQUUsZUFBZSxDQUFDLENBQUM7UUEzQ3ZCLGVBQVUsR0FBcUMsSUFBSSxDQUFDO1FBRXBELG9CQUFlLEdBQXFDLElBQUksQ0FBQztRQUV6RCxnQkFBVyxHQUFrQyxJQUFJLENBQUM7UUFFbEQsbUJBQWMsR0FBZSxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBRTlDLHFCQUFnQixHQUFlLElBQUksVUFBVSxFQUFFLENBQUM7UUFFaEQscUJBQWdCLEdBQWUsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUVoRCxvQkFBZSxHQUFlLElBQUksVUFBVSxFQUFF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