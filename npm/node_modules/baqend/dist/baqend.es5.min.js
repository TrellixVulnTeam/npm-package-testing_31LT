/*! baqend 3.0.0 | Copyright (c) 2021 Baqend GmbH | License information baqend.es5.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(function(){try{return require("rxjs")}catch(e){}}(),function(){try{return require("validator")}catch(e){}}()):"function"==typeof define&&define.amd?define("Baqend",["rxjs","validator"],t):"object"==typeof exports?exports.Baqend=t(function(){try{return require("rxjs")}catch(e){}}(),function(){try{return require("validator")}catch(e){}}()):e.Baqend=t(e.rxjs,e.validator)}(window,(function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=66)}([function(e,t,r){"use strict";r.r(t),r.d(t,"__extends",(function(){return o})),r.d(t,"__assign",(function(){return i})),r.d(t,"__rest",(function(){return a})),r.d(t,"__decorate",(function(){return s})),r.d(t,"__param",(function(){return u})),r.d(t,"__metadata",(function(){return c})),r.d(t,"__awaiter",(function(){return l})),r.d(t,"__generator",(function(){return d})),r.d(t,"__createBinding",(function(){return p})),r.d(t,"__exportStar",(function(){return f})),r.d(t,"__values",(function(){return h})),r.d(t,"__read",(function(){return y})),r.d(t,"__spread",(function(){return b})),r.d(t,"__spreadArrays",(function(){return g})),r.d(t,"__await",(function(){return m})),r.d(t,"__asyncGenerator",(function(){return v})),r.d(t,"__asyncDelegator",(function(){return O})),r.d(t,"__asyncValues",(function(){return _})),r.d(t,"__makeTemplateObject",(function(){return w})),r.d(t,"__importStar",(function(){return E})),r.d(t,"__importDefault",(function(){return T})),r.d(t,"__classPrivateFieldGet",(function(){return S})),r.d(t,"__classPrivateFieldSet",(function(){return M}));var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function o(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function a(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function s(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function u(e,t){return function(r,n){t(r,n,e)}}function c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))}function d(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var p=Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function f(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||p(t,e,r)}function h(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function b(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}function g(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n}function m(e){return this instanceof m?(this.v=e,this):new m(e)}function v(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),i=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){o[e]&&(n[e]=function(t){return new Promise((function(r,n){i.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=o[e](t)).value instanceof m?Promise.resolve(r.value.v).then(u,c):l(i[0][2],r)}catch(e){l(i[0][3],e)}var r}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}}function O(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,o){t[n]=e[n]?function(t){return(r=!r)?{value:m(e[n](t)),done:"return"===n}:o?o(t):t}:o}}function _(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=h(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,o){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,o,(t=e[r](t)).done,t.value)}))}}}function w(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var P=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function E(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&p(t,e,r);return P(t,e),t}function T(e){return e&&e.__esModule?e:{default:e}}function S(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function M(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(87);Object.defineProperty(t,"Metadata",{enumerable:!0,get:function(){return n.Metadata}}),Object.defineProperty(t,"MetadataState",{enumerable:!0,get:function(){return n.MetadataState}});var o=r(48);Object.defineProperty(t,"Permission",{enumerable:!0,get:function(){return o.Permission}});var i=r(49);Object.defineProperty(t,"Validator",{enumerable:!0,get:function(){return i.Validator}});var a=r(89);Object.defineProperty(t,"ValidationResult",{enumerable:!0,get:function(){return a.ValidationResult}});var s=r(90);Object.defineProperty(t,"Code",{enumerable:!0,get:function(){return s.Code}});var u=r(91);Object.defineProperty(t,"Modules",{enumerable:!0,get:function(){return u.Modules}});var c=r(92);Object.defineProperty(t,"Logger",{enumerable:!0,get:function(){return c.Logger}});var l=r(93);Object.defineProperty(t,"PushMessage",{enumerable:!0,get:function(){return l.PushMessage}});var d=r(28);Object.defineProperty(t,"TokenStorage",{enumerable:!0,get:function(){return d.TokenStorage}});var p=r(94);Object.defineProperty(t,"GlobalStorage",{enumerable:!0,get:function(){return p.GlobalStorage}});var f=r(95);Object.defineProperty(t,"WebStorage",{enumerable:!0,get:function(){return f.WebStorage}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Beacon=t.SW=t.Install=t.UploadAPNSCertificate=t.GCMAKey=t.VAPIDPublicKey=t.VAPIDKeys=t.DeviceRegistered=t.DevicePush=t.DeviceRegister=t.DropAllIndexes=t.CreateDropIndex=t.ListIndexes=t.CleanUpAssets=t.GetAllRevalidationStatus=t.CancelRevalidation=t.GetRevalidationStatus=t.RevalidateAssets=t.DownloadAsset=t.CreateManifest=t.DeleteFile=t.UpdateFileMetadata=t.GetFileMetadata=t.UploadFile=t.DownloadFile=t.CreateFile=t.DeleteFileBucket=t.SetFileBucketMetadata=t.GetFileBucketMetadata=t.UploadPatchArchive=t.DownloadArchive=t.ListBuckets=t.ListFiles=t.GetAllModules=t.GetBaqendModule=t.PostBaqendModule=t.DeleteBaqendCode=t.SetBaqendCode=t.GetBaqendCode=t.RevokeUserToken=t.UserToken=t.OAuth1=t.OAuth2=t.VerifyUsername=t.ChangeUsername=t.Verify=t.ResetPassword=t.NewPassword=t.Logout=t.ValidateUser=t.Me=t.Register=t.Login=t.UpdateField=t.UpdatePartially=t.CommitTransaction=t.NewTransaction=t.GetQueryParameters=t.RunQuery=t.GetQueryCode=t.ListThisQueryResources=t.CreateQuery=t.ListQueryResources=t.AdhocCountQueryPOST=t.AdhocCountQuery=t.AdhocQueryPOST=t.AdhocQuery=t.DeleteSchema=t.ReplaceSchema=t.UpdateSchema=t.GetSchema=t.ReplaceAllSchemas=t.UpdateAllSchemas=t.GetAllSchemas=t.DeleteObject=t.ReplaceObject=t.GetObject=t.CreateObject=t.TruncateBucket=t.ImportBucket=t.ExportBucket=t.GetBucketIds=t.GetBucketNames=t.UnbanIp=t.Unban=t.Banned=t.BannedIp=t.EventsUrl=t.Status=t.Connect=t.UpdateOrestesConfig=t.GetOrestesConfig=t.DeleteBloomFilter=t.GetBloomFilterExpirations=t.GetBloomFilter=t.Specification=t.ApiVersion=t.ListAllResources=void 0;var n=r(6);t.ListAllResources=n.Message.create({method:"GET",path:"/",status:[200]}),t.ApiVersion=n.Message.create({method:"GET",path:"/version",status:[200]}),t.Specification=n.Message.create({method:"GET",path:"/spec",status:[200]}),t.GetBloomFilter=n.Message.create({method:"GET",path:"/bloomfilter?rules=false",status:[200]}),t.GetBloomFilterExpirations=n.Message.create({method:"GET",path:"/bloomfilter/expirations",status:[200]}),t.DeleteBloomFilter=n.Message.create({method:"DELETE",path:"/bloomfilter?flush=true",status:[204]}),t.GetOrestesConfig=n.Message.create({method:"GET",path:"/config",status:[200]}),t.UpdateOrestesConfig=n.Message.create({method:"PUT",path:"/config",status:[200,202]}),t.Connect=n.Message.create({method:"GET",path:"/connect",status:[200]}),t.Status=n.Message.create({method:"GET",path:"/status",status:[200]}),t.EventsUrl=n.Message.create({method:"GET",path:"/events-url",status:[200]}),t.BannedIp=n.Message.create({method:"GET",path:"/banned/:ip",status:[204]}),t.Banned=n.Message.create({method:"GET",path:"/banned",status:[]}),t.Unban=n.Message.create({method:"DELETE",path:"/banned",status:[204]}),t.UnbanIp=n.Message.create({method:"DELETE",path:"/banned/:ip",status:[204]}),t.GetBucketNames=n.Message.create({method:"GET",path:"/db",status:[200]}),t.GetBucketIds=n.Message.create({method:"GET",path:"/db/:bucket/ids?start=0&count=-1",status:[200]}),t.ExportBucket=n.Message.create({method:"GET",path:"/db/:bucket",status:[200]}),t.ImportBucket=n.Message.create({method:"PUT",path:"/db/:bucket",status:[200]}),t.TruncateBucket=n.Message.create({method:"DELETE",path:"/db/:bucket",status:[200]}),t.CreateObject=n.Message.create({method:"POST",path:"/db/:bucket",status:[201,202]}),t.GetObject=n.Message.create({method:"GET",path:"/db/:bucket/:oid",status:[200,304]}),t.ReplaceObject=n.Message.create({method:"PUT",path:"/db/:bucket/:oid",status:[200,202]}),t.DeleteObject=n.Message.create({method:"DELETE",path:"/db/:bucket/:oid",status:[202,204]}),t.GetAllSchemas=n.Message.create({method:"GET",path:"/schema",status:[200]}),t.UpdateAllSchemas=n.Message.create({method:"POST",path:"/schema",status:[200]}),t.ReplaceAllSchemas=n.Message.create({method:"PUT",path:"/schema",status:[200]}),t.GetSchema=n.Message.create({method:"GET",path:"/schema/:bucket",status:[200]}),t.UpdateSchema=n.Message.create({method:"POST",path:"/schema/:bucket",status:[200]}),t.ReplaceSchema=n.Message.create({method:"PUT",path:"/schema/:bucket",status:[200]}),t.DeleteSchema=n.Message.create({method:"DELETE",path:"/schema/:bucket",status:[204]}),t.AdhocQuery=n.Message.create({method:"GET",path:"/db/:bucket/query?q&start=0&count=-1&sort=&eager=&hinted=",status:[200]}),t.AdhocQueryPOST=n.Message.create({method:"POST",path:"/db/:bucket/query?start=0&count=-1&sort=",status:[200]}),t.AdhocCountQuery=n.Message.create({method:"GET",path:"/db/:bucket/count?q",status:[200]}),t.AdhocCountQueryPOST=n.Message.create({method:"POST",path:"/db/:bucket/count",status:[200]}),t.ListQueryResources=n.Message.create({method:"GET",path:"/query",status:[200]}),t.CreateQuery=n.Message.create({method:"POST",path:"/query",status:[201]}),t.ListThisQueryResources=n.Message.create({method:"GET",path:"/query/:qid",status:[200]}),t.GetQueryCode=n.Message.create({method:"GET",path:"/query/:qid/source",status:[200]}),t.RunQuery=n.Message.create({method:"GET",path:"/query/:qid/result?start=0&count=-1",status:[200]}),t.GetQueryParameters=n.Message.create({method:"GET",path:"/query/:qid/parameters",status:[200]}),t.NewTransaction=n.Message.create({method:"POST",path:"/transaction",status:[201]}),t.CommitTransaction=n.Message.create({method:"PUT",path:"/transaction/:tid/committed",status:[200]}),t.UpdatePartially=n.Message.create({method:"POST",path:"/db/:bucket/:oid",status:[200]}),t.UpdateField=n.Message.create({method:"POST",path:"/db/:bucket/:oid/:field",status:[200]}),t.Login=n.Message.create({method:"POST",path:"/db/User/login",status:[200]}),t.Register=n.Message.create({method:"POST",path:"/db/User/register",status:[200,204]}),t.Me=n.Message.create({method:"GET",path:"/db/User/me",status:[200]}),t.ValidateUser=n.Message.create({method:"GET",path:"/db/User/validate",status:[200]}),t.Logout=n.Message.create({method:"GET",path:"/db/User/logout",status:[204]}),t.NewPassword=n.Message.create({method:"POST",path:"/db/User/password",status:[200]}),t.ResetPassword=n.Message.create({method:"POST",path:"/db/User/reset",status:[200]}),t.Verify=n.Message.create({method:"GET",path:"/db/User/verify?token=",status:[204]}),t.ChangeUsername=n.Message.create({method:"POST",path:"/db/User/changeUsername",status:[204]}),t.VerifyUsername=n.Message.create({method:"GET",path:"/db/User/verifyUsername?token=",status:[204]}),t.OAuth2=n.Message.create({method:"GET",path:"/db/User/OAuth/:provider?state=&code=&oauth_verifier=&oauth_token=&error_description=",status:[200]}),t.OAuth1=n.Message.create({method:"GET",path:"/db/User/OAuth1/:provider",status:[200]}),t.UserToken=n.Message.create({method:"POST",path:"/db/User/:oid/token",status:[200]}),t.RevokeUserToken=n.Message.create({method:"DELETE",path:"/db/User/:oid/token",status:[204]}),t.GetBaqendCode=n.Message.create({method:"GET",path:"/code/:bucket/:type",status:[200]}),t.SetBaqendCode=n.Message.create({method:"PUT",path:"/code/:bucket/:type",status:[200,202]}),t.DeleteBaqendCode=n.Message.create({method:"DELETE",path:"/code/:bucket/:type",status:[202,204]}),t.PostBaqendModule=n.Message.create({method:"POST",path:"/code/:bucket",status:[200,204]}),t.GetBaqendModule=n.Message.create({method:"GET",path:"/code/:bucket",status:[200,204]}),t.GetAllModules=n.Message.create({method:"GET",path:"/code",status:[200]}),t.ListFiles=n.Message.create({method:"GET",path:"/file/:bucket/ids?path=/&start=&count=-1&deep=false",status:[200]}),t.ListBuckets=n.Message.create({method:"GET",path:"/file/buckets",status:[200]}),t.DownloadArchive=n.Message.create({method:"GET",path:"/file",status:[200]}),t.UploadPatchArchive=n.Message.create({method:"POST",path:"/file",status:[200]}),t.GetFileBucketMetadata=n.Message.create({method:"GET",path:"/file/:bucket",status:[200]}),t.SetFileBucketMetadata=n.Message.create({method:"PUT",path:"/file/:bucket",status:[204]}),t.DeleteFileBucket=n.Message.create({method:"DELETE",path:"/file/:bucket",status:[204]}),t.CreateFile=n.Message.create({method:"POST",path:"/file/:bucket",status:[200]}),t.DownloadFile=n.Message.create({method:"GET",path:"/file/:bucket/*oid",status:[200,304]}),t.UploadFile=n.Message.create({method:"PUT",path:"/file/:bucket/*oid",status:[200]}),t.GetFileMetadata=n.Message.create({method:"HEAD",path:"/file/:bucket/*oid",status:[200]}),t.UpdateFileMetadata=n.Message.create({method:"POST",path:"/file/:bucket/*oid",status:[200]}),t.DeleteFile=n.Message.create({method:"DELETE",path:"/file/:bucket/*oid",status:[200,204]}),t.CreateManifest=n.Message.create({method:"POST",path:"/pwa/manifest",status:[202]}),t.DownloadAsset=n.Message.create({method:"GET",path:"/asset/*url",status:[200,304]}),t.RevalidateAssets=n.Message.create({method:"POST",path:"/asset/revalidate",status:[202]}),t.GetRevalidationStatus=n.Message.create({method:"GET",path:"/asset/revalidate/:id",status:[200,202]}),t.CancelRevalidation=n.Message.create({method:"DELETE",path:"/asset/revalidate/:id",status:[202]}),t.GetAllRevalidationStatus=n.Message.create({method:"GET",path:"/asset/revalidate?state=",status:[200]}),t.CleanUpAssets=n.Message.create({method:"POST",path:"/asset/cleanup",status:[202]}),t.ListIndexes=n.Message.create({method:"GET",path:"/index/:bucket",status:[200]}),t.CreateDropIndex=n.Message.create({method:"POST",path:"/index/:bucket",status:[202]}),t.DropAllIndexes=n.Message.create({method:"DELETE",path:"/index/:bucket",status:[202]}),t.DeviceRegister=n.Message.create({method:"POST",path:"/db/Device/register",status:[200]}),t.DevicePush=n.Message.create({method:"POST",path:"/db/Device/push",status:[204]}),t.DeviceRegistered=n.Message.create({method:"GET",path:"/db/Device/registered",status:[200]}),t.VAPIDKeys=n.Message.create({method:"POST",path:"/config/VAPIDKeys",status:[200]}),t.VAPIDPublicKey=n.Message.create({method:"GET",path:"/config/VAPIDPublicKey",status:[200]}),t.GCMAKey=n.Message.create({method:"POST",path:"/config/GCMKey",status:[204]}),t.UploadAPNSCertificate=n.Message.create({method:"POST",path:"/config/APNSCert",status:[204]}),t.Install=n.Message.create({method:"GET",path:"/speedkit?d=",status:[200]}),t.SW=n.Message.create({method:"GET",path:"/speedkit?r=&v=",status:[200]}),t.Beacon=n.Message.create({method:"POST",path:"/rum/pi",status:[200]})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(73);Object.defineProperty(t,"isNode",{enumerable:!0,get:function(){return n.isNode}});var o=r(74);Object.defineProperty(t,"atob",{enumerable:!0,get:function(){return o.atob}});var i=r(75);Object.defineProperty(t,"hmac",{enumerable:!0,get:function(){return i.hmac}});var a=r(76);Object.defineProperty(t,"Lockable",{enumerable:!0,get:function(){return a.Lockable}});var s=r(77);Object.defineProperty(t,"uuid",{enumerable:!0,get:function(){return s.uuid}});var u=r(79);Object.defineProperty(t,"deprecated",{enumerable:!0,get:function(){return u.deprecated}});var c=r(80);Object.defineProperty(t,"trailingSlashIt",{enumerable:!0,get:function(){return c.trailingSlashIt}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12);Object.defineProperty(t,"PersistentError",{enumerable:!0,get:function(){return n.PersistentError}});var o=r(68);Object.defineProperty(t,"CommunicationError",{enumerable:!0,get:function(){return o.CommunicationError}});var i=r(69);Object.defineProperty(t,"IllegalEntityError",{enumerable:!0,get:function(){return i.IllegalEntityError}});var a=r(70);Object.defineProperty(t,"EntityExistsError",{enumerable:!0,get:function(){return a.EntityExistsError}});var s=r(71);Object.defineProperty(t,"RollbackError",{enumerable:!0,get:function(){return s.RollbackError}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(86);Object.defineProperty(t,"Accessor",{enumerable:!0,get:function(){return n.Accessor}});var o=r(26);Object.defineProperty(t,"Enhancer",{enumerable:!0,get:function(){return o.Enhancer}});var i=r(27);Object.defineProperty(t,"Factory",{enumerable:!0,get:function(){return i.Factory}});var a=r(47);Object.defineProperty(t,"ManagedFactory",{enumerable:!0,get:function(){return a.ManagedFactory}});var s=r(29);Object.defineProperty(t,"EntityFactory",{enumerable:!0,get:function(){return s.EntityFactory}});var u=r(96);Object.defineProperty(t,"LoginOption",{enumerable:!0,get:function(){return u.LoginOption}}),Object.defineProperty(t,"UserFactory",{enumerable:!0,get:function(){return u.UserFactory}});var c=r(97);Object.defineProperty(t,"DeviceFactory",{enumerable:!0,get:function(){return c.DeviceFactory}});var l=r(98);Object.defineProperty(t,"FileFactory",{enumerable:!0,get:function(){return l.FileFactory}});var d=r(51);Object.defineProperty(t,"Managed",{enumerable:!0,get:function(){return d.Managed}});var p=r(30);Object.defineProperty(t,"Entity",{enumerable:!0,get:function(){return p.Entity}});var f=r(101);Object.defineProperty(t,"Role",{enumerable:!0,get:function(){return f.Role}});var h=r(53);Object.defineProperty(t,"User",{enumerable:!0,get:function(){return h.User}});var y=r(50);Object.defineProperty(t,"File",{enumerable:!0,get:function(){return y.File}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(67);Object.defineProperty(t,"Message",{enumerable:!0,get:function(){return n.Message}}),Object.defineProperty(t,"StatusCode",{enumerable:!0,get:function(){return n.StatusCode}}),Object.defineProperty(t,"OAuthMessages",{enumerable:!0,get:function(){return n.OAuthMessages}});var o=r(25);Object.defineProperty(t,"Connector",{enumerable:!0,get:function(){return o.Connector}});var i=r(72);Object.defineProperty(t,"FetchConnector",{enumerable:!0,get:function(){return i.FetchConnector}});var a=r(39);Object.defineProperty(t,"XMLHttpConnector",{enumerable:!0,get:function(){return a.XMLHttpConnector}});var s=r(81);Object.defineProperty(t,"IFrameConnector",{enumerable:!0,get:function(){return s.IFrameConnector}});var u=r(82);Object.defineProperty(t,"NodeConnector",{enumerable:!0,get:function(){return u.NodeConnector}});var c=r(83);Object.defineProperty(t,"WebSocketConnector",{enumerable:!0,get:function(){return c.WebSocketConnector}})},function(e,t,r){"use strict";for(var n=r(8),o=[],i=0;i<256;++i)o.push((i+256).toString(16).substr(1));t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase();if(!Object(n.a)(r))throw TypeError("Stringified UUID is invalid");return r}},function(e,t,r){"use strict";var n=r(63);t.a=function(e){return"string"==typeof e&&n.a.test(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Attribute=t.PersistentAttributeType=void 0;var n,o=r(0),i=r(5);!function(e){e[e.BASIC=0]="BASIC",e[e.ELEMENT_COLLECTION=1]="ELEMENT_COLLECTION",e[e.EMBEDDED=2]="EMBEDDED",e[e.MANY_TO_MANY=3]="MANY_TO_MANY",e[e.MANY_TO_ONE=4]="MANY_TO_ONE",e[e.ONE_TO_MANY=5]="ONE_TO_MANY",e[e.ONE_TO_ONE=6]="ONE_TO_ONE"}(n=t.PersistentAttributeType||(t.PersistentAttributeType={}));var a=Symbol("AttachedState"),s=Symbol("AttachedSize"),u=function(){function e(e,t){this.isId=!1,this.isVersion=!1,this.isAcl=!1,this.order=null,this.accessor=null,this.declaringType=null,this.metadata=null,this.isMetadata=!!t,this.name=e}return e.attachState=function(e,t,r){return void 0===r&&(r=!1),void 0===t||!r&&void 0!==e[a]||Object.defineProperty(e,a,{value:t,configurable:!0}),e[a]},e.attachSize=function(e,t){return void 0!==t&&Object.defineProperty(e,s,{value:t,configurable:!0}),e[s]||-1},Object.defineProperty(e.prototype,"persistentAttributeType",{get:function(){return-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAssociation",{get:function(){return this.persistentAttributeType>n.EMBEDDED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCollection",{get:function(){return this.persistentAttributeType===n.ELEMENT_COLLECTION},enumerable:!1,configurable:!0}),e.prototype.init=function(e,t){if(this.declaringType)throw new Error("The attribute is already initialized.");this.order=t,this.accessor=new i.Accessor,this.declaringType=e},e.prototype.getValue=function(e){return this.accessor.getValue(e,this)},e.prototype.setValue=function(e,t){this.accessor.setValue(e,this,t)},e.prototype.hasMetadata=function(e){return!!this.metadata&&e in this.metadata},e.prototype.getMetadata=function(e){return this.hasMetadata(e)&&this.metadata[e]||null},e.prototype.toJSON=function(){return o.__assign({name:this.name,order:this.order},this.metadata&&{metadata:this.metadata})},e.PersistentAttributeType=n,e}();t.Attribute=u},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Type=t.PersistenceType=void 0,function(e){e[e.BASIC=0]="BASIC",e[e.EMBEDDABLE=1]="EMBEDDABLE",e[e.ENTITY=2]="ENTITY",e[e.MAPPED_SUPERCLASS=3]="MAPPED_SUPERCLASS"}(n=t.PersistenceType||(t.PersistenceType={}));var o=function(){function e(e,t){if(0!==e.indexOf("/db/"))throw new SyntaxError("Type ref "+e+" is invalid.");this.ref=e,this.name=e.substring(4),this._typeConstructor=t}return Object.defineProperty(e.prototype,"persistenceType",{get:function(){return-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBasic",{get:function(){return this.persistenceType===n.BASIC},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmbeddable",{get:function(){return this.persistenceType===n.EMBEDDABLE},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEntity",{get:function(){return this.persistenceType===n.ENTITY},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMappedSuperclass",{get:function(){return this.persistenceType===n.MAPPED_SUPERCLASS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typeConstructor",{get:function(){return this._typeConstructor},set:function(e){if(this._typeConstructor)throw new Error("typeConstructor has already been set.");this._typeConstructor=e},enumerable:!1,configurable:!0}),e}();t.Type=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluralAttribute=t.CollectionType=void 0;var n,o=r(0),i=r(9);!function(e){e[e.COLLECTION=0]="COLLECTION",e[e.LIST=1]="LIST",e[e.MAP=2]="MAP",e[e.SET=3]="SET"}(n=t.CollectionType||(t.CollectionType={}));var a=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.elementType=n,o.typeConstructor=r,o}return o.__extends(t,e),Object.defineProperty(t.prototype,"persistentAttributeType",{get:function(){return i.PersistentAttributeType.ELEMENT_COLLECTION},enumerable:!1,configurable:!0}),t.prototype.keyValue=function(e){return String(e&&"object"==typeof e&&"id"in e?e.id:e)},t.CollectionType=n,t}(i.Attribute);t.PluralAttribute=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PersistentError=void 0,t.PersistentError=function(){function e(e,t){Object.prototype.hasOwnProperty.call(Error,"captureStackTrace")?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e||"An unexpected persistent error occurred.",this.name=this.constructor.name,t&&(this.cause=t,t.stack&&(this.stack+="\nCaused By: "+t.stack))}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0}}),e}(),t.PersistentError.of=function(e){return e instanceof t.PersistentError?e:new t.PersistentError(null,e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(104);Object.defineProperty(t,"Metamodel",{enumerable:!0,get:function(){return n.Metamodel}});var o=r(62);Object.defineProperty(t,"DbIndex",{enumerable:!0,get:function(){return o.DbIndex}});var i=r(10);Object.defineProperty(t,"Type",{enumerable:!0,get:function(){return i.Type}}),Object.defineProperty(t,"PersistenceType",{enumerable:!0,get:function(){return i.PersistenceType}});var a=r(38);Object.defineProperty(t,"SingularAttribute",{enumerable:!0,get:function(){return a.SingularAttribute}});var s=r(61);Object.defineProperty(t,"SetAttribute",{enumerable:!0,get:function(){return s.SetAttribute}});var u=r(11);Object.defineProperty(t,"PluralAttribute",{enumerable:!0,get:function(){return u.PluralAttribute}}),Object.defineProperty(t,"CollectionType",{enumerable:!0,get:function(){return u.CollectionType}});var c=r(57);Object.defineProperty(t,"ModelBuilder",{enumerable:!0,get:function(){return c.ModelBuilder}});var l=r(60);Object.defineProperty(t,"MapAttribute",{enumerable:!0,get:function(){return l.MapAttribute}});var d=r(19);Object.defineProperty(t,"ManagedType",{enumerable:!0,get:function(){return d.ManagedType}});var p=r(59);Object.defineProperty(t,"ListAttribute",{enumerable:!0,get:function(){return p.ListAttribute}});var f=r(36);Object.defineProperty(t,"EntityType",{enumerable:!0,get:function(){return f.EntityType}});var h=r(58);Object.defineProperty(t,"EmbeddableType",{enumerable:!0,get:function(){return h.EmbeddableType}});var y=r(105);Object.defineProperty(t,"CollectionAttribute",{enumerable:!0,get:function(){return y.CollectionAttribute}});var b=r(37);Object.defineProperty(t,"BasicType",{enumerable:!0,get:function(){return b.BasicType}});var g=r(9);Object.defineProperty(t,"Attribute",{enumerable:!0,get:function(){return g.Attribute}}),Object.defineProperty(t,"PersistentAttributeType",{enumerable:!0,get:function(){return g.PersistentAttributeType}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.db=void 0;var n,o,i=r(23);t.db=(n=new i.EntityManagerFactory,o=n.createEntityManager(!0),Object.assign(o,{configure:function(e){return n.configure(e),this},connect:function(e,t,r,o){return t instanceof Function?this.connect(e,void 0,t,r):(n.connect(e,t),this.ready(r,o))}}),o)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Acl=void 0;var n=r(48),o=function(){function e(){this.read=new n.Permission,this.write=new n.Permission}return e.prototype.clear=function(){this.read.clear(),this.write.clear()},e.prototype.copy=function(e){return this.read.copy(e.read),this.write.copy(e.write),this},e.prototype.isPublicReadAllowed=function(){return this.read.isPublicAllowed()},e.prototype.setPublicReadAllowed=function(){return this.read.setPublicAllowed()},e.prototype.isReadAllowed=function(e){return this.read.isAllowed(e)},e.prototype.isReadDenied=function(e){return this.read.isDenied(e)},e.prototype.allowReadAccess=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=this.read).allowAccess.apply(e,t),this},e.prototype.denyReadAccess=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=this.read).denyAccess.apply(e,t),this},e.prototype.deleteReadAccess=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=this.read).deleteAccess.apply(e,t),this},e.prototype.isPublicWriteAllowed=function(){return this.write.isPublicAllowed()},e.prototype.setPublicWriteAllowed=function(){return this.write.setPublicAllowed()},e.prototype.isWriteAllowed=function(e){return this.write.isAllowed(e)},e.prototype.isWriteDenied=function(e){return this.write.isDenied(e)},e.prototype.allowWriteAccess=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=this.write).allowAccess.apply(e,t),this},e.prototype.denyWriteAccess=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=this.write).denyAccess.apply(e,t),this},e.prototype.deleteWriteAccess=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return(e=this.write).deleteAccess.apply(e,t),this},e.prototype.toJSON=function(){return{read:this.read.toJSON(),write:this.write.toJSON()}},e.prototype.fromJSON=function(e){this.read.fromJSON(e.read||{}),this.write.fromJSON(e.write||{})},e}();t.Acl=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enumerable=void 0,t.enumerable=function(e){return function(t,r,n){n.enumerable=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Node=void 0;var n=r(0),o=r(5),i=r(18),a=n.__importStar(r(2)),s=r(1),u=r(55),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.firstResult=0,t.maxResults=-1,t.order={},t}return n.__extends(t,e),t.prototype.eventStream=function(e,t,r,n){if(e instanceof Function)return this.eventStream({},e,t,r);var o=u.Stream.createEventStream(this.entityManager,this.createRealTimeQuery(),e);return t instanceof Function?o.subscribe(t,r,n):o},t.prototype.resultStream=function(e,t,r,n){if(e instanceof Function)return this.resultStream({},e,t,r);var o=u.Stream.createResultStream(this.entityManager,this.createRealTimeQuery(),e);return t instanceof Function?o.subscribe(t,r,n):o},t.prototype.resultList=function(e,t,r){var n,o=this;if(e instanceof Function)return this.resultList({},e,t);var s=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!s)throw new Error("Only typed queries can be executed.");var u,c=this.serializeQuery(),l=this.serializeSort();return u=((null===(n=this.entityManager.connection)||void 0===n?void 0:n.host.length)||0)+c.length+l.length>i.Query.MAX_URI_SIZE?new a.AdhocQueryPOST(s.name,this.firstResult,this.maxResults,l).entity(c,"text"):new a.AdhocQuery(s.name,c,this.firstResult,this.maxResults,l),this.entityManager.send(u).then((function(t){return o.createResultList(t.entity,e)})).then(t,r)},t.prototype.singleResult=function(e,t,r){var n,o=this;if(e instanceof Function)return this.singleResult({},e,t);var s=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!s)throw new Error("Only typed queries can be executed.");var u,c=this.serializeQuery(),l=this.serializeSort();return u=((null===(n=this.entityManager.connection)||void 0===n?void 0:n.host.length)||0)+c.length>i.Query.MAX_URI_SIZE?new a.AdhocQueryPOST(s.name,this.firstResult,1,l).entity(c,"text"):new a.AdhocQuery(s.name,c,this.firstResult,1,l),this.entityManager.send(u).then((function(t){return o.createResultList(t.entity,e)})).then((function(e){return e.length?e[0]:null})).then(t,r)},t.prototype.count=function(e,t){var r,n=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!n)throw new Error("Only typed queries can be executed.");var o,s=this.serializeQuery();return o=((null===(r=this.entityManager.connection)||void 0===r?void 0:r.host.length)||0)+s.length>i.Query.MAX_URI_SIZE?new a.AdhocCountQueryPOST(n.name).entity(s,"text"):new a.AdhocCountQuery(n.name,s),this.entityManager.send(o).then((function(e){return e.entity.count})).then(e,t)},t.prototype.serializeQuery=function(){return JSON.stringify(this,(function(e,t){var r=this[e];return r instanceof Date?{$date:t}:r instanceof o.Entity?r.id:t}))},t.prototype.serializeSort=function(){return JSON.stringify(this.order)},t.prototype.createResultList=function(e,t){var r=this;return e.length?Promise.all(e.map((function(e){if(e.id){var n=r.entityManager.getReference(r.resultClass,e.id),o=s.Metadata.get(n);return o.type.fromJsonValue(o,e,n,{persisting:!0}),r.entityManager.resolveDepth(n,t)}return r.entityManager.load(Object.keys(e)[0])}))).then((function(e){return e.filter((function(e){return!!e}))})):Promise.resolve([])},t.prototype.createRealTimeQuery=function(){var e=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!e)throw new Error("Only typed queries can be executed.");var t={bucket:e.name,query:this.serializeQuery()},r=this.serializeSort();return r&&"{}"!==r&&(t.sort=r),this.maxResults>0&&(t.limit=this.maxResults),this.firstResult>0&&(t.offset=this.firstResult),t},t.prototype.addOrder=function(e,t){return"string"==typeof e?this.order[e]=t:this.order=e,this},t.prototype.addOffset=function(e){return this.firstResult=e,this},t.prototype.addLimit=function(e){return this.maxResults=e,this},t}(i.Query);t.Node=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flatArgs=t.Query=void 0;var n=function(){function e(e,t){this.entityManager=e,this.resultClass=t}return e.prototype.ascending=function(e){return this.addOrder(e,1)},e.prototype.descending=function(e){return this.addOrder(e,-1)},e.prototype.sort=function(e){if("object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype)throw new Error("sort must be an object.");return this.addOrder(e)},e.prototype.offset=function(e){if(e<0)throw new Error("The offset can't be nagative.");return this.addOffset(e)},e.prototype.limit=function(e){if(e<0)throw new Error("The limit can't be nagative.");return this.addLimit(e)},e.MAX_URI_SIZE=2e3,e}();t.Query=n,t.flatArgs=function(e){return Array.prototype.concat.apply([],e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManagedType=void 0;var n=r(0),o=r(10),i=r(5),a=r(1),s=function(e){function t(t,r){var n=e.call(this,0!==t.indexOf("/db/")?"/db/"+t:t,r)||this;return n.enhancer=null,n.declaredAttributes=[],n.schemaAddPermission=new a.Permission,n.schemaReplacePermission=new a.Permission,n.metadata=null,n.superType=null,n._validationCode=null,n}return n.__extends(t,e),Object.defineProperty(t.prototype,"validationCode",{get:function(){return this._validationCode},set:function(e){this._validationCode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"typeConstructor",{get:function(){return this._typeConstructor||(this.typeConstructor=this.createProxyClass()),this._typeConstructor},set:function(e){if(this._typeConstructor)throw new Error("Type constructor has already been set.");var t=e.prototype instanceof i.Entity;if(this.isEntity){if(!t)throw new TypeError("Entity classes must extends the Entity class.")}else if(!(e.prototype instanceof i.Managed)||t)throw new TypeError("Embeddable classes must extends the Managed class.");this.enhancer.enhance(this,e),this._typeConstructor=e},enumerable:!1,configurable:!0}),t.prototype.init=function(e){this.enhancer=e,this._typeConstructor&&!i.Enhancer.getIdentifier(this._typeConstructor)&&i.Enhancer.setIdentifier(this._typeConstructor,this.ref)},t.prototype.create=function(){var e=Object.create(this.typeConstructor.prototype);return i.Managed.init(e),e},t.prototype.attributes=function(){var e,t,r=0,n=this;return this.superType&&(t=this.superType.attributes()),(e={})[Symbol.iterator]=function(){return this},e.next=function(){if(t){var e=t.next();if(!e.done)return e;t=null}if(r<n.declaredAttributes.length){var o=n.declaredAttributes[r];return r+=1,{value:o,done:!1}}return{done:!0,value:void 0}},e},t.prototype.addAttribute=function(e,t){if(this.getAttribute(e.name))throw new Error("An attribute with the name "+e.name+" is already declared.");var r;r=e.order?e.order:void 0===t?this.declaredAttributes.length:t,e.init(this,r),this.declaredAttributes.push(e),this._typeConstructor&&"Object"!==this.name&&this.enhancer.enhanceProperty(this._typeConstructor,e)},t.prototype.removeAttribute=function(e){var t=this.declaredAttributes.length;if(this.declaredAttributes=this.declaredAttributes.filter((function(t){return t.name!==e})),t===this.declaredAttributes.length)throw new Error("An Attribute with the name "+e+" is not declared.")},t.prototype.getAttribute=function(e){var t=this.getDeclaredAttribute(e);return!t&&this.superType&&(t=this.superType.getAttribute(e)),t},t.prototype.getDeclaredAttribute=function(e){return this.declaredAttributes.filter((function(t){return t.name===e||t.order===e}))[0]||null},t.prototype.fromJsonValue=function(e,t,r,n){if(!t||!r)return null;for(var o=this.attributes(),i=o.next();!i.done;i=o.next()){var a=i.value;n.onlyMetadata&&!a.isMetadata||a.setJsonValue(e,r,t[a.name],n)}return r},t.prototype.toJsonValue=function(e,t,r){if(!(t instanceof this.typeConstructor))return null;for(var n={},o=this.attributes(),i=o.next();!i.done;i=o.next()){var a=i.value;r.excludeMetadata&&a.isMetadata||(n[a.name]=a.getJsonValue(e,t,r))}return n},t.prototype.toJSON=function(){var e={};return this.declaredAttributes.forEach((function(t){t.isMetadata||(e[t.name]=t)})),n.__assign(n.__assign(n.__assign({class:this.ref,fields:e,acl:{schemaAdd:this.schemaAddPermission.toJSON(),schemaReplace:this.schemaReplacePermission.toJSON()}},this.superType&&{superClass:this.superType.ref}),this.isEmbeddable&&{embedded:!0}),this.metadata&&{metadata:this.metadata})},t.prototype.references=function(){var e,t,r,n=this.attributes();return(e={})[Symbol.iterator]=function(){return this},e.next=function(){for(;;){if(r){var e=r.next();if(!e.done)return{value:{path:[t.name].concat(e.value.path)}};r=null}var o=n.next();if(o.done)return{done:!0,value:void 0};var i=(t=o.value).isCollection?t.elementType:t.type;if(i.isEntity)return{value:{path:[t.name]}};i.isEmbeddable&&(r=i.references())}},e},t.prototype.hasMetadata=function(e){return!!this.metadata&&!!this.metadata[e]},t.prototype.getMetadata=function(e){return this.hasMetadata(e)?this.metadata[e]:null},t}(o.Type);t.ManagedType=s},function(e,t,r){"use strict";var n=r(8);t.a=function(e){if(!Object(n.a)(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),o=new Uint8Array(16);function i(){if(!n)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(o)}},function(e,t,r){"use strict";var n=r(7),o=r(20);t.a=function(e,t,r){function i(e,i,a,s){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof i&&(i=Object(o.a)(i)),16!==i.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+e.length);if(u.set(i),u.set(e,i.length),(u=r(u))[6]=15&u[6]|t,u[8]=63&u[8]|128,a){s=s||0;for(var c=0;c<16;++c)a[s+c]=u[c];return a}return Object(n.a)(u)}try{i.name=e}catch(e){}return i.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",i.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntityManagerFactory=void 0;var n=r(0),o=r(24),i=n.__importStar(r(2)),a=r(6),s=r(3),u=r(1),c=r(13),l=Symbol("Connected"),d=Symbol("WebSocket"),p=function(e){function t(t){void 0===t&&(t={});var r=e.call(this)||this;r.connection=null,r.metamodel=r.createMetamodel(),r.code=new u.Code(r.metamodel,r),r.tokenStorageFactory=u.TokenStorage.WEB_STORAGE||u.TokenStorage.GLOBAL,r.tokenStorage=null,r.staleness=null;var n="string"==typeof t?{host:t}:t||{};r.configure(n);var o=!0,a=new Promise((function(e){r[l]=e}));return n.host?r.connect(n.host,n.port,n.secure,n.basePath):o=!1,r.tokenStorage||(o=!1,a=a.then((function(){return r.tokenStorageFactory.create(r.connection.origin)})).then((function(e){r.tokenStorage=e}))),n.schema?(r.connectData=n,r.metamodel.init(n.schema)):(o=!1,a=a.then((function(){var e=new i.Connect;return e.withCredentials=!0,0===r.staleness&&e.noCache(),r.send(e)})).then((function(e){r.connectData=e.entity,null===r.staleness&&(r.staleness=r.connectData.bloomFilterRefresh||60),r.metamodel.isInitialized||r.metamodel.init(r.connectData.schema),r.tokenStorage.update(r.connectData.token)}))),o||r.withLock((function(){return a}),!0),r}return n.__extends(t,e),Object.defineProperty(t.prototype,"websocket",{get:function(){if(!this[d]){var e=this.connection.secure,t=void 0;t=this.connectData.websocket?(e?"wss:":"ws:")+this.connectData.websocket:this.connection.origin.replace(/^http/,"ws")+this.connection.basePath+"/events",this[d]=a.WebSocketConnector.create(t)}return this[d]},enumerable:!1,configurable:!0}),t.prototype.configure=function(e){if(this.connection)throw new Error("The EntityManagerFactory can only be configured before is is connected.");e.tokenStorage&&(this.tokenStorage=e.tokenStorage),e.tokenStorageFactory&&(this.tokenStorageFactory=e.tokenStorageFactory),void 0!==e.staleness&&(this.staleness=e.staleness)},t.prototype.connect=function(e,t,r,n){if(this.connection)throw new Error("The EntityManagerFactory is already connected.");return"boolean"==typeof t?this.connect(e,0,t,r):(this.connection=a.Connector.create(e,t,r,n),this[l](),this.ready())},t.prototype.createMetamodel=function(){return new c.Metamodel(this)},t.prototype.createEntityManager=function(e){var t=this,r=new o.EntityManager(this);return this.isReady?r.connected(this.connection,this.connectData,e?this.tokenStorage:new u.TokenStorage(this.connection.origin)):r.withLock((function(){return t.ready().then((function(){r.connected(t.connection,t.connectData,e?t.tokenStorage:new u.TokenStorage(t.connection.origin))}))}),!0),r},t.prototype.send=function(e){return e.tokenStorage()||e.tokenStorage(this.tokenStorage),this.connection.send(e)},t}(s.Lockable);t.EntityManagerFactory=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntityManager=void 0;var n=r(0),o=n.__importStar(r(2)),i=r(5),a=r(3),s=r(6),u=r(32),c=r(33),l=r(34),d=r(4),p=r(13),f=r(1),h=function(e){function t(t){var r=e.call(this)||this;return r.List=Array,r.Set=Set,r.Map=Map,r.GeoPoint=c.GeoPoint,r.log=f.Logger.create(r),r.connection=null,r.entities={},r.modules=new f.Modules(r),r.me=null,r.deviceMe=null,r.tokenStorage=null,r.bloomFilter=null,r.cacheWhiteList=null,r.cacheBlackList=null,r.bloomFilterRefresh=60,r.bloomFilterLock=new a.Lockable,r.File=null,r.entityManagerFactory=t,r.metamodel=t.metamodel,r.code=t.code,r}return n.__extends(t,e),Object.defineProperty(t.prototype,"isOpen",{get:function(){return!!this.connection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"token",{get:function(){return this.tokenStorage.token},set:function(e){this.tokenStorage.update(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCachingDisabled",{get:function(){return!this.isCachingEnabled()},enumerable:!1,configurable:!0}),t.prototype.isCachingEnabled=function(){return!!this.bloomFilter},Object.defineProperty(t.prototype,"isDeviceRegistered",{get:function(){return!!this.deviceMe},enumerable:!1,configurable:!0}),t.prototype.connected=function(e,t,r){this.connection=e,this.tokenStorage=r,this.bloomFilterRefresh=this.entityManagerFactory.staleness,this.File=i.FileFactory.create(this),this._createObjectFactory(this.metamodel.embeddables),this._createObjectFactory(this.metamodel.entities),t&&(t.device&&this._updateDevice(t.device),t.user&&r.token&&this._updateUser(t.user,!0),this.bloomFilterRefresh>0&&t.bloomFilter&&a.atob&&!a.isNode&&this._updateBloomFilter(t.bloomFilter))},t.prototype._createObjectFactory=function(e){for(var t=Object.values(e),r=function(e){var r=t[e],o=r.name;n[o]?(r.typeConstructor=n[o],Object.defineProperty(n,o,{value:r.createObjectFactory(n)})):Object.defineProperty(n,o,{get:function(){return Object.defineProperty(this,o,{value:r.createObjectFactory(this)}),this[o]},set:function(e){r.typeConstructor=e},configurable:!0})},n=this,o=0;o<t.length;o+=1)r(o)},t.prototype.send=function(e,t){var r=this;if(void 0===t&&(t=!0),!this.connection)throw new Error("This EntityManager is not connected.");var n=e;n.tokenStorage(this.tokenStorage);var o=this.connection.send(n);return t||(o=o.catch((function(e){throw e.status===s.StatusCode.BAD_CREDENTIALS&&r._logout(),e}))),o},t.prototype.getReference=function(e,t){var r,n=null;if(t){var o=t;r=this.metamodel.entity(e),n=0===o.indexOf("/db/")?o:r.ref+"/"+encodeURIComponent(o)}else if("string"==typeof e){var i=e.indexOf("/","/db/".length);-1!==i&&(n=e),r=this.metamodel.entity(-1!==i?e.substring(0,i):e)}else r=this.metamodel.entity(e);var a=this.entities[n];if(!a){a=r.create();var s=f.Metadata.get(a);n&&(s.id=n),s.setUnavailable(),this._attach(a)}return a},t.prototype.createQueryBuilder=function(e){return new l.Builder(this,e)},t.prototype.clear=function(){this.entities={}},t.prototype.close=function(){return this.connection=null,this.clear()},t.prototype.contains=function(e){return!!e&&!!e.id&&this.entities[e.id]===e},t.prototype.containsById=function(e){return!!(e&&e.id&&this.entities[e.id])},t.prototype.detach=function(e){var t=this;return f.Metadata.get(e).withLock((function(){return t.removeReference(e),Promise.resolve(e)}))},t.prototype.resolveDepth=function(e,t){var r=this;if(!t||!t.depth)return Promise.resolve(e);var o=t.resolved||[],i=[],a=n.__assign(n.__assign({},t),{resolved:o,depth:!0===t.depth||t.depth-1});return this.getSubEntities(e,1).forEach((function(e){null!==e&&-1===o.indexOf(e)&&e.id&&(o.push(e),i.push(r.load(e.id,void 0,a)))})),Promise.all(i).then((function(){return e}))},t.prototype.load=function(e,t,r){var n=this,i=r||{},a=this.getReference(e,t),u=f.Metadata.get(a);if(!i.refresh&&i.local&&u.isAvailable)return this.resolveDepth(a,i);var c=new o.GetObject(u.bucket,u.key);return this.ensureCacheHeader(a.id,c,i.refresh),this.send(c).then((function(r){return a.version&&a.version>r.entity.version?(i.refresh=!0,n.load(e,t,i)):(n.addToWhiteList(r.entity.id),r.status!==s.StatusCode.NOT_MODIFIED&&u.type.fromJsonValue(u,r.entity,a,{persisting:!0}),n.resolveDepth(a,i))}),(function(e){if(e.status===s.StatusCode.OBJECT_NOT_FOUND)return n.removeReference(a),u.setRemoved(),null;throw e}))},t.prototype.insert=function(e,t){var r,n=this,i=t||{};return this._save(e,i,(function(e,t){if(e.version)throw new d.PersistentError("Existing objects can't be inserted.");return r=!e.id,new o.CreateObject(e.bucket,t)})).then((function(t){return r&&n._attach(e),t}))},t.prototype.update=function(e,t){var r=t||{};return this._save(e,r,(function(e,t){if(!e.version)throw new d.PersistentError("New objects can't be inserted.");if(r.force){t.version;var i=n.__rest(t,["version"]);return new o.ReplaceObject(e.bucket,e.key,i).ifMatch("*")}return new o.ReplaceObject(e.bucket,e.key,t).ifMatch(""+e.version)}))},t.prototype.save=function(e,t,r){void 0===r&&(r=!1);var i=t||{},a=function(e,t){if(i.force){if(!e.id)throw new d.PersistentError("New special objects can't be forcefully saved.");t.version;var r=n.__rest(t,["version"]);return new o.ReplaceObject(e.bucket,e.key,r)}return e.version?new o.ReplaceObject(e.bucket,e.key,t).ifMatch(e.version):new o.CreateObject(e.bucket,t)};return r?this._locklessSave(e,i,a):this._save(e,i,a)},t.prototype.optimisticSave=function(e,t){var r=this;return f.Metadata.get(e).withLock((function(){return r._optimisticSave(e,t)}))},t.prototype._optimisticSave=function(e,t){var r=this,n=!1,o=Promise.resolve(t(e,(function(){n=!0})));return n?Promise.resolve(e):o.then((function(){return r.save(e,{},!0).catch((function(n){if(412===n.status)return r.refresh(e,{}).then((function(){return r._optimisticSave(e,t)}));throw n}))}))},t.prototype._locklessSave=function(e,t,r){var o=this;this.attach(e);var i,a,u=f.Metadata.get(e);if(u.isAvailable&&(a=u.type.toJsonValue(u,e,{persisting:!0})),u.isDirty){t.refresh||u.setPersistent();var c=this.send(r(u,a)).then((function(r){return u.id&&u.id!==r.entity.id&&(o.removeReference(e),u.id=r.entity.id,o._attach(e)),u.type.fromJsonValue(u,r.entity,e,{persisting:t.refresh,onlyMetadata:!t.refresh}),e}),(function(t){if(t.status===s.StatusCode.OBJECT_NOT_FOUND)return o.removeReference(e),u.setRemoved(),null;throw u.setDirty(),t}));i=[c]}else i=[Promise.resolve(e)];var l=n.__assign({},t);return l.depth=0,this.getSubEntities(e,t.depth).forEach((function(e){i.push(o._save(e,l,r))})),Promise.all(i).then((function(){return e}))},t.prototype._save=function(e,t,r){var n=this;this.ensureBloomFilterFreshness();var o=f.Metadata.get(e);return o.version&&this.addToBlackList(e.id),o.withLock((function(){return n._locklessSave(e,t,r)}))},t.prototype.getSubEntities=function(e,t,r,n){if(void 0===r&&(r=[]),!t)return r;for(var o=n||e,i=f.Metadata.get(e).type.references(),a=i.next();!a.done;a=i.next())for(var s=a.value,u=this.getSubEntitiesByPath(e,s.path),c=0,l=u.length;c<l;c+=1){var d=u[c];-1===r.indexOf(d)&&d!==o&&(r.push(d),this.getSubEntities(d,!0===t?t:t-1,r,o))}return r},t.prototype.getSubEntitiesByPath=function(e,t){var r=this,n=[e];return t.forEach((function(e){var t=[];n.forEach((function(n){var o=n[e];if(o){var i=r.metamodel.managedType(n.constructor).getAttribute(e);if(i instanceof p.PluralAttribute)for(var a=o.entries(),s=a.next();!s.done;s=a.next()){var u=s.value;t.push(u[1]),i instanceof p.MapAttribute&&i.keyType.isEntity&&t.push(u[0])}else t.push(o)}})),n=t})),n},t.prototype.delete=function(e,t){var r=this,i=t||{};this.attach(e);var a=f.Metadata.get(e);return a.withLock((function(){if(!a.version&&!i.force)throw new d.IllegalEntityError(e);var t=new o.DeleteObject(a.bucket,a.key);r.addToBlackList(e.id),i.force||t.ifMatch(""+a.version);var s=[r.send(t).then((function(){return r.removeReference(e),a.setRemoved(),e}))],u=n.__assign({},i);return u.depth=0,r.getSubEntities(e,i.depth).forEach((function(e){s.push(r.delete(e,u))})),Promise.all(s).then((function(){return e}))}))},t.prototype.flush=function(){throw new Error("Not implemented.")},t.prototype.persist=function(e){this.attach(e)},t.prototype.refresh=function(e,t){return e.id?this.load(e.id,void 0,n.__assign(n.__assign({},t),{refresh:!0})):Promise.resolve(e)},t.prototype.attach=function(e){if(!this.contains(e)){if(!this.metamodel.entity(e.constructor))throw new d.IllegalEntityError(e);if(this.containsById(e))throw new d.EntityExistsError(e);this._attach(e)}},t.prototype._attach=function(e){var t=f.Metadata.get(e);if(t.isAttached){if(t.db!==this)throw new d.EntityExistsError(e)}else t.db=this;t.id||"User"!==t.type.name&&"Role"!==t.type.name&&"logs.AppLog"!==t.type.name&&(t.id="/db/"+t.type.name+"/"+a.uuid()),t.id&&(this.entities[t.id]=e)},t.prototype.removeReference=function(e){var t=f.Metadata.get(e);if(!t||!t.id)throw new d.IllegalEntityError(e);delete this.entities[t.id]},t.prototype.register=function(e,t,r){var n=this,a=r>i.LoginOption.NO_LOGIN;if(this.me&&a)throw new d.PersistentError("User is already logged in.");return this.withLock((function(){var i=new o.Register({user:e,password:t,login:a});return n._userRequest(i,r)}))},t.prototype.login=function(e,t,r){var n=this;if(this.me)throw new d.PersistentError("User is already logged in.");return this.withLock((function(){var i=new o.Login({username:e,password:t});return n._userRequest(i,r)}))},t.prototype.logout=function(){var e=this;return this.withLock((function(){return e.send(new o.Logout).then(e._logout.bind(e))}))},t.prototype.loginWithOAuth=function(e,t,r){if(!this.connection)throw new Error("This EntityManager is not connected.");if(this.me)throw new d.PersistentError("User is already logged in.");var o,i=n.__assign({title:"Login with "+e,timeout:3e5,state:{},loginOption:!0},r);if(i.redirect&&Object.assign(i.state,{redirect:i.redirect,loginOption:i.loginOption}),!s.OAuthMessages[e])throw new Error("OAuth provider "+e+" not supported.");(o=new s.OAuthMessages[e](t,i.scope,JSON.stringify(i.state))).addRedirectOrigin(this.connection.origin+this.connection.basePath),i.path&&o.path(i.path);var a={width:""+i.width,height:""+i.height};if(i.redirect){var u=-1!==document.URL.indexOf("http://")||-1!==document.URL.indexOf("https://");return this.openOAuthWindow(o.request.path,u?"_self":"_system",a),new Promise((function(){}))}var c=this._userRequest(o,i.loginOption);return this.openOAuthWindow(o.request.path,i.title,a),new Promise((function(e,t){var r=setTimeout((function(){t(new d.PersistentError("OAuth login timeout."))}),i.timeout);c.then(e,t).then((function(){clearTimeout(r)}))}))},t.prototype.openOAuthWindow=function(e,t,r){var n=Object.keys(r).filter((function(e){return void 0!==r[e]})).map((function(e){return e+"="+r[e]})).join(",");open(e,t,n)},t.prototype.renew=function(e){var t=this;return this.withLock((function(){var r=new o.Me;return t._userRequest(r,e)}))},t.prototype.newPassword=function(e,t,r){var n=this;return this.withLock((function(){var i=new o.NewPassword({username:e,password:t,newPassword:r});return n.send(i,!0).then((function(e){return n._updateUser(e.entity)}))}))},t.prototype.newPasswordWithToken=function(e,t,r){var n=this;return this.withLock((function(){return n._userRequest(new o.NewPassword({token:e,newPassword:t}),r)}))},t.prototype.resetPassword=function(e){return this.send(new o.ResetPassword({username:e}))},t.prototype.changeUsername=function(e,t,r){return this.send(new o.ChangeUsername({username:e,newUsername:t,password:r}))},t.prototype._updateUser=function(e,t){void 0===t&&(t=!1);var r=this.getReference(e.id),n=f.Metadata.get(r);return n.type.fromJsonValue(n,e,r,{persisting:!0}),t&&(this.me=r),r},t.prototype._logout=function(){this.me=null,this.token=null},t.prototype._userRequest=function(e,t){var r=this,n=void 0===t||t,o=n>i.LoginOption.NO_LOGIN;return o&&(this.tokenStorage.temporary=n<i.LoginOption.PERSIST_LOGIN),this.send(e,!o).then((function(e){return e.entity?r._updateUser(e.entity,o):null}),(function(e){if(e.status===s.StatusCode.OBJECT_NOT_FOUND)return o&&r._logout(),null;throw e}))},t.prototype.registerDevice=function(e,t,r){var n=this,i=new o.DeviceRegister({devicetype:e,subscription:t,device:r});return i.withCredentials=!0,this.send(i).then((function(e){return n._updateDevice(e.entity)}))},t.prototype._updateDevice=function(e){var t=this.getReference(e.id),r=f.Metadata.get(t);return r.type.fromJsonValue(r,e,t,{persisting:!0}),this.deviceMe=t,t},t.prototype.checkDeviceRegistration=function(){return this.send(new o.DeviceRegistered).then((function(){return!0}),(function(e){if(e.status===s.StatusCode.OBJECT_NOT_FOUND)return!1;throw e}))},t.prototype.pushDevice=function(e){return this.send(new o.DevicePush(e.toJSON()))},t.prototype.validate=function(e){for(var t=f.Metadata.get(e).type,r=new f.ValidationResult,n=t.attributes(),o=n.next();!o.done;o=n.next()){var i=new f.Validator(o.value.name,e);r.fields[i.key]=i}var a=t.validationCode;return a&&a(r.fields),r},t.prototype.addToWhiteList=function(e){this.isCachingEnabled()&&(this.bloomFilter.contains(e)&&this.cacheWhiteList.add(e),this.cacheBlackList.delete(e))},t.prototype.addToBlackList=function(e){this.isCachingEnabled()&&e&&(this.bloomFilter.contains(e)||this.cacheBlackList.add(e),this.cacheWhiteList.delete(e))},t.prototype.refreshBloomFilter=function(){var e=this;if(!this.isCachingEnabled())return Promise.resolve(null);var t=new o.GetBloomFilter;return t.noCache(),this.send(t).then((function(t){return e._updateBloomFilter(t.entity),e.bloomFilter}))},t.prototype._updateBloomFilter=function(e){this.bloomFilter=new u.BloomFilter(e),this.cacheWhiteList=new Set,this.cacheBlackList=new Set},t.prototype.ensureBloomFilterFreshness=function(){var e=this;if(this.isCachingEnabled()){var t=(new Date).getTime(),r=1e3*this.bloomFilterRefresh;this.bloomFilterLock.isReady&&t-this.bloomFilter.creation>r&&this.bloomFilterLock.withLock((function(){return e.refreshBloomFilter()}))}},t.prototype.mustRevalidate=function(e){return!a.isNode&&(this.ensureBloomFilterFreshness(),!this.isCachingEnabled()||!this.bloomFilterLock.isReady||!this.cacheWhiteList.has(e)&&(this.cacheBlackList.has(e)||this.bloomFilter.contains(e)))},t.prototype.ensureCacheHeader=function(e,t,r){(r||!e||this.mustRevalidate(e))&&t.noCache()},t.prototype.createURL=function(e,t){var r=this,n=this.connection;if(!n)throw new Error("This EntityManager is not connected.");return this.tokenStorage.signPath(n.basePath+e,t).then((function(o){var i=n.origin+o;return r.mustRevalidate(e)&&(i+=(t?"&":"?")+"BCB"),i}))},t.prototype.requestAPIToken=function(e,t){var r=this._getUserReference(e,t),n=new o.UserToken(r.key);return this.send(n).then((function(e){return e.entity}))},t.prototype.revokeAllTokens=function(e,t){var r=this._getUserReference(e,t),n=new o.RevokeUserToken(r.key);return this.send(n)},t.prototype._getUserReference=function(e,t){return"string"==typeof t?this.getReference(e,t):t},n.__decorate([a.deprecated("EntityManager.isCachingEnabled()")],t.prototype,"isCachingDisabled",null),t}(a.Lockable);t.EntityManager=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Connector=void 0;var n=r(4),o=function(){function e(t,r,n,o){this.host=t,this.port=r,this.secure=n,this.basePath=o,this.origin=e.toUri(this.host,this.port,this.secure,""),this.gzip=!1}return e.isUsable=function(e,t,r,n){return!1},e.create=function(t,r,n,o){var i=t,a=r,s=n,u=o;if("undefined"!=typeof location&&(i||(i=location.hostname,a=Number(location.port)),void 0===s&&(s="https:"===location.protocol)),s=void 0===s||!!s,void 0===u&&(u=e.DEFAULT_BASE_PATH),-1!==i.indexOf("/")){var c=/^(https?):\/\/([^/:]+|\[[^\]]+])(:(\d*))?(\/\w+)?\/?$/.exec(i);if(!c)throw new Error("The connection uri host "+i+" seems not to be valid");s="https"===c[1],i=c[2].replace(/(\[|])/g,""),a=Number(c[4]),u=c[5]||""}else"localhost"!==i&&/^[a-z0-9-]*$/.test(i)&&(i+=e.HTTP_DOMAIN);a||(a=s?443:80);var l=e.toUri(i,a,s,u),d=this.connections[l];if(!d){for(var p=this.connectors.length-1;p>=0;p-=1){var f=this.connectors[p];if(f.isUsable&&f.isUsable(i,a,s,u)){d=new f(i,a,s,u);break}}if(!d)throw new Error("No connector is usable for the requested connection.");this.connections[l]=d}return d},e.toUri=function(e,t,r,n){var o=(r?"https://":"http://")+(-1!==e.indexOf(":")?"["+e+"]":e);return o+=r&&443!==t||!r&&80!==t?":"+t:"",o+=n},e.prototype.send=function(e){var t=this,r={status:0,headers:{}};return Promise.resolve().then((function(){return t.prepareRequest(e)})).then((function(){return new Promise((function(r){t.doSend(e,e.request,r)}))})).then((function(e){r=e})).then((function(){return t.prepareResponse(e,r)})).then((function(){return e.doReceive(r),r})).catch((function(e){throw r.entity=null,n.PersistentError.of(e)}))},e.prototype.prepareRequest=function(e){var t,r=this;if(!e.mimeType()){var n=e.request.type;"json"===n?e.mimeType("application/json;charset=utf-8"):"text"===n&&e.mimeType("text/plain;charset=utf-8")}switch(this.toFormat(e),e.responseType()){case"json":t="application/json";break;case"text":t="text/*";break;default:t="application/json,text/*;q=0.5,*/*;q=0.1"}if(e.accept()||e.accept(t),this.gzip){var o=e.ifNoneMatch();o&&'""'!==o&&"*"!==o&&e.ifNoneMatch(o.slice(0,-1)+'--gzip"')}var i=e.tokenStorage();if("/connect"===e.request.path)return i.signPath(this.basePath+e.request.path).then((function(t){return e.request.path=t.substring(r.basePath.length),e.cacheControl()&&(e.request.path+=(-1!==e.request.path.indexOf("?")?"&":"?")+"BCB"),e}));if(i){var a=i.token;a&&e.header("authorization","BAT "+a)}return e},e.prototype.prepareResponse=function(e,t){var r,n=this;t.status=1223===t.status?204:t.status;var o=t.headers||{},i=204===t.status?null:t.entity;if(i&&(!(r=e.responseType())||t.status>=400)){var a=o["content-type"]||o["Content-Type"];a&&a.indexOf("application/json")>-1&&(r="json")}o.etag&&(o.etag=o.etag.replace("--gzip",""));var s=e.tokenStorage();if(s){var u=o["baqend-authorization-token"]||o["Baqend-Authorization-Token"];u&&s.update(u)}return new Promise((function(e){e(i&&n.fromFormat(t,i,r))})).then((function(r){t.entity=r,-1!==e.request.path.indexOf("/connect")&&r&&(n.gzip=!!r.gzip)}),(function(e){throw new Error("Response was not valid "+r+": "+e.message)}))},e.DEFAULT_BASE_PATH="/v1",e.HTTP_DOMAIN=".app.baqend.com",e.RESPONSE_HEADERS=["baqend-authorization-token","content-type","baqend-size","baqend-acl","etag","last-modified","baqend-created-at","baqend-custom-headers"],e.connectors=[],e.connections={},e}();t.Connector=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Enhancer=void 0;var n=r(0),o=Symbol("BaqendId"),i=Symbol("BaqendType"),a=function(){function e(){}return e.prototype.createProxy=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(e)},e.getBaqendType=function(e){return e[i]},e.getIdentifier=function(e){return e[o]},e.setIdentifier=function(e,t){e[o]=t},e.prototype.enhance=function(t,r){if(r[i]!==t){if(Object.prototype.hasOwnProperty.call(r,i))throw new Error("Type is already used by a different manager");r[i]=t,e.setIdentifier(r,t.ref),this.enhancePrototype(r.prototype,t)}},e.prototype.enhancePrototype=function(e,t){var r=this;t.isEmbeddable||(e.toString===Object.prototype.toString&&Object.defineProperty(e,"toString",{value:function(){return this._metadata.id||this._metadata.bucket},enumerable:!1}),t.superType&&"Object"===t.superType.name&&t.superType.declaredAttributes.forEach((function(t){t.isMetadata||r.enhanceProperty(e,t)})),t.declaredAttributes.forEach((function(t){r.enhanceProperty(e,t)})))},e.prototype.enhanceProperty=function(e,t){var r=t.name;Object.defineProperty(e,r,{get:function(){return this._metadata.throwUnloadedPropertyAccess(r),null},set:function(e){this._metadata.throwUnloadedPropertyAccess(r),Object.defineProperty(this,r,{value:e,writable:!0,enumerable:!0,configurable:!0})},configurable:!0,enumerable:!0})},e}();t.Enhancer=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=void 0;var n=function(){function e(){this.type=null,this.prototype=null}return e.extend=function(t,r){r!==e.prototype&&this.extend(t,Object.getPrototypeOf(r));for(var n=Object.getOwnPropertyNames(r),o=0,i=n.length;o<i;o+=1){var a=n[o];Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))}return t},e.createFactory=function(t){var r=e.extend((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.newInstance(e)}),this.prototype);return r.prototype=t.prototype,r.type=t,r},e.prototype.new=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.newInstance(e)},e.prototype.newInstance=function(e){if(!e||0===e.length)return new this.type;var t=[null];return Array.prototype.push.apply(t,e),new(Function.prototype.bind.apply(this.type,t))},e}();t.Factory=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenStorage=void 0;var n=r(3),o=function(){function e(t,r,n){this.tokenData=r?e.parse(r):null,this.origin=t,this.temporary=!!n}return e.parse=function(e){return{val:e,createdAt:1e3*parseInt(e.substring(0,8),16),expireAt:1e3*parseInt(e.substring(8,16),16),sig:e.substring(e.length-40),data:e.substring(0,e.length-40)}},Object.defineProperty(e.prototype,"token",{get:function(){return this.tokenData?this.tokenData.val:null},enumerable:!1,configurable:!0}),e.create=function(t){return Promise.resolve(new e(t))},e.prototype.saveToken=function(t,r,n){this._saveToken!==e.prototype._saveToken&&(console.log("Using deprecated TokenStorage._saveToken implementation."),this._saveToken(t,r,n))},e.prototype._saveToken=function(e,t,r){},e.prototype.update=function(t){var r=t?e.parse(t):null;this.tokenData&&r&&this.tokenData.expireAt>r.expireAt||(this.tokenData=r,this.saveToken(this.origin,t,this.temporary))},e.prototype.signPath=function(t,r){void 0===r&&(r=!0);var n=this.tokenData,o=Promise.resolve(t.split("/").map(encodeURIComponent).join("/"));return n&&r?o.then((function(t){return e.hmac(t+n.data,n.sig).then((function(e){return t+"?BAT="+(n.data+e)}))})).catch((function(e){return console.warn("Can't sign the resource, run the SDK on a secured origin, or provide an alternative hmac implementation on TokenStorage.hmac",e),o})):o},e.hmac=n.hmac,e}();t.TokenStorage=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntityFactory=void 0;var n=r(0),o=r(47),i=r(1),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.newInstance=function(t){var r=e.prototype.newInstance.call(this,t);return i.Metadata.get(r).db=this.db,r},t.prototype.load=function(e,t,r,n){return"function"==typeof t?this.load(e,{},t,r):this.db.load(this.managedType.typeConstructor,e,t).then(r,n)},t.prototype.ref=function(e){return this.db.getReference(this.managedType.ref,e)},t.prototype.fromJSON=function(e){var t=this.db.getReference(this.managedType.ref,e.id);return this.managedType.fromJsonValue(i.Metadata.get(t),e,t,{persisting:!1})},t.prototype.find=function(){return this.db.createQueryBuilder(this.managedType.typeConstructor)},t.prototype.partialUpdate=function(e,t){return this.ref(e).partialUpdate(t)},t}(o.ManagedFactory);t.EntityFactory=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Entity=void 0;var n=r(0),o=r(51),i=r(31),a=r(16),s=r(4),u=r(26),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._metadata.id},set:function(e){if(this._metadata.id)throw new Error("The id can't be set twice: "+e);0===(""+e).indexOf("/db/"+this._metadata.bucket+"/")?this._metadata.id=e:this.key=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._metadata.key},set:function(e){this._metadata.key=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._metadata.version},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"acl",{get:function(){return this._metadata.throwUnloadedPropertyAccess("acl"),this._metadata.acl},enumerable:!1,configurable:!0}),t.prototype.attach=function(e){e.attach(this)},t.prototype.ready=function(e){var t=this;return this._metadata.ready().then((function(){return t})).then(e)},t.prototype.save=function(e,t,r){return"function"==typeof e?this.save({},e,t):this._metadata.db.save(this,e).then(t,r)},t.prototype.insert=function(e,t,r){return"function"==typeof e?this.insert({},e,t):this._metadata.db.insert(this,e).then(t,r)},t.prototype.update=function(e,t,r){return"function"==typeof e?this.update({},e,t):this._metadata.db.update(this,e).then(t,r)},t.prototype.load=function(e,t,r){if("function"==typeof e)return this.load({},e,t);var o=n.__assign({local:!0},e);if(null===this.id)throw new s.PersistentError("This object can't be loaded, it does have an id.");return this._metadata.db.load(this.id,void 0,o).then(t,r)},t.prototype.delete=function(e,t,r){return"function"==typeof e?this.delete({},e,t):this._metadata.db.delete(this,e).then(t,r)},t.prototype.optimisticSave=function(e,t,r){return this._metadata.db.optimisticSave(this,e).then(t,r)},t.prototype.attr=function(){throw new Error("Attr is not yet implemented.")},t.prototype.validate=function(){return this._metadata.db.validate(this)},t.prototype.partialUpdate=function(e){return new i.EntityPartialUpdateBuilder(this,e)},t.prototype.getReferencing=function(e){var t=this,r=this._metadata.db,n=this._metadata.type.getReferencing(r,e),o=Array.from(n).map((function(e){var n=e[0],o=e[1],i=r.createQueryBuilder(n.typeConstructor),a=[];return o.forEach((function(e){a.push(i.equal(e,t))})),(1===a.length?a[0]:i.or(a)).resultList()}));return Promise.all(o).then((function(e){return e.filter((function(e){return!!e.length}))})).then((function(e){return Array.prototype.concat.apply([],e)}))},t.prototype.toString=function(){var e=u.Enhancer.getBaqendType(this.constructor);return this.id||e.ref},t.prototype.toJSON=function(e){var t=e;"boolean"==typeof t&&(t={excludeMetadata:t}),"object"!=typeof t&&(t={});var r=this._metadata;return r.type.toJsonValue(r,this,t)},n.__decorate([a.enumerable(!0)],t.prototype,"id",null),n.__decorate([a.enumerable(!1)],t.prototype,"key",null),n.__decorate([a.enumerable(!0)],t.prototype,"version",null),n.__decorate([a.enumerable(!0)],t.prototype,"acl",null),n.__decorate([a.enumerable(!1)],t.prototype,"attach",null),n.__decorate([a.enumerable(!1)],t.prototype,"ready",null),n.__decorate([a.enumerable(!1)],t.prototype,"save",null),n.__decorate([a.enumerable(!1)],t.prototype,"insert",null),n.__decorate([a.enumerable(!1)],t.prototype,"update",null),n.__decorate([a.enumerable(!1)],t.prototype,"load",null),n.__decorate([a.enumerable(!1)],t.prototype,"delete",null),n.__decorate([a.enumerable(!1)],t.prototype,"optimisticSave",null),n.__decorate([a.enumerable(!1)],t.prototype,"attr",null),n.__decorate([a.enumerable(!1)],t.prototype,"validate",null),n.__decorate([a.enumerable(!1)],t.prototype,"partialUpdate",null),n.__decorate([a.enumerable(!1)],t.prototype,"getReferencing",null),n.__decorate([a.enumerable(!1)],t.prototype,"toString",null),n.__decorate([a.enumerable(!1)],t.prototype,"toJSON",null),t}(o.Managed);t.Entity=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(99);Object.defineProperty(t,"EntityPartialUpdateBuilder",{enumerable:!0,get:function(){return n.EntityPartialUpdateBuilder}});var o=r(52);Object.defineProperty(t,"PartialUpdateBuilder",{enumerable:!0,get:function(){return o.PartialUpdateBuilder}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(102);Object.defineProperty(t,"BloomFilter",{enumerable:!0,get:function(){return n.BloomFilter}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GeoPoint=void 0;var n=function(){function e(e,t){var r,n;if("string"==typeof e){var o=e.indexOf(";");r=Number(e.substring(0,o)),n=Number(e.substring(o+1))}else Array.isArray(e)?(r=e[0],n=e[1]):"object"==typeof e?(r=e.latitude,n=e.longitude):(r="number"==typeof e?e:0,n="number"==typeof t?t:0);if(this.longitude=n,this.latitude=r,this.latitude<-90||this.latitude>90)throw new Error("Latitude "+this.latitude+" is not in bound of -90 <= latitude <= 90");if(this.longitude<-180||this.longitude>180)throw new Error("Longitude "+this.longitude+" is not in bound of -180 <= longitude <= 180")}return e.current=function(){return new Promise((function(t,r){navigator||r(new Error("This seems not to be a browser context.")),navigator.geolocation||r(new Error("This browser does not support geolocation.")),navigator.geolocation.getCurrentPosition((function(r){t(new e(r.coords.latitude,r.coords.longitude))}),(function(e){r(e)}))}))},e.prototype.kilometersTo=function(t){return Number((e.EARTH_RADIUS_IN_KILOMETERS*this.radiansTo(t)).toFixed(3))},e.prototype.milesTo=function(t){return Number((e.EARTH_RADIUS_IN_MILES*this.radiansTo(t)).toFixed(3))},e.prototype.radiansTo=function(t){var r=t,n=this.latitude*e.DEG_TO_RAD,o=r.latitude*e.DEG_TO_RAD,i=(r.longitude-this.longitude)*e.DEG_TO_RAD;return Math.acos(Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos(i))},e.prototype.toString=function(){return this.latitude+";"+this.longitude},e.prototype.toJSON=function(){return{latitude:this.latitude,longitude:this.longitude}},e.DEG_TO_RAD=Math.PI/180,e.EARTH_RADIUS_IN_KILOMETERS=6371,e.EARTH_RADIUS_IN_MILES=3956,e}();t.GeoPoint=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(103);Object.defineProperty(t,"Builder",{enumerable:!0,get:function(){return n.Builder}});var o=r(35);Object.defineProperty(t,"Condition",{enumerable:!0,get:function(){return o.Condition}});var i=r(54);Object.defineProperty(t,"Filter",{enumerable:!0,get:function(){return i.Filter}});var a=r(17);Object.defineProperty(t,"Node",{enumerable:!0,get:function(){return a.Node}});var s=r(56);Object.defineProperty(t,"Operator",{enumerable:!0,get:function(){return s.Operator}});var u=r(18);Object.defineProperty(t,"flatArgs",{enumerable:!0,get:function(){return u.flatArgs}}),Object.defineProperty(t,"Query",{enumerable:!0,get:function(){return u.Query}});var c=r(55);Object.defineProperty(t,"Stream",{enumerable:!0,get:function(){return c.Stream}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Condition=void 0;var n=r(18);t.Condition={where:function(e){return this.addFilter(null,null,e)},equal:function(e,t){return this.addFilter(e,null,t)},notEqual:function(e,t){return this.addFilter(e,"$ne",t)},greaterThan:function(e,t){return this.addFilter(e,"$gt",t)},greaterThanOrEqualTo:function(e,t){return this.addFilter(e,"$gte",t)},lessThan:function(e,t){return this.addFilter(e,"$lt",t)},lessThanOrEqualTo:function(e,t){return this.addFilter(e,"$lte",t)},between:function(e,t,r){return this.addFilter(e,"$gt",t).addFilter(e,"$lt",r)},in:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.addFilter(e,"$in",n.flatArgs(t))},notIn:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.addFilter(e,"$nin",n.flatArgs(t))},isNull:function(e){return this.equal(e,null)},isNotNull:function(e){return this.addFilter(e,"$exists",!0).addFilter(e,"$ne",null)},containsAll:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.addFilter(e,"$all",n.flatArgs(t))},mod:function(e,t,r){return this.addFilter(e,"$mod",[t,r])},matches:function(e,t){var r=t instanceof RegExp?t:new RegExp(t);if(r.ignoreCase)throw new Error("RegExp.ignoreCase flag is not supported.");if(r.global)throw new Error("RegExp.global flag is not supported.");if(0!==r.source.indexOf("^"))throw new Error("regExp must be an anchored expression, i.e. it must be started with a ^.");var n=this.addFilter(e,"$regex",r.source);return r.multiline&&n.addFilter(e,"$options","m"),n},size:function(e,t){return this.addFilter(e,"$size",t)},near:function(e,t,r){return this.addFilter(e,"$nearSphere",{$geometry:{type:"Point",coordinates:[t.longitude,t.latitude]},$maxDistance:r})},withinPolygon:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var o=n.flatArgs(t);return this.addFilter(e,"$geoWithin",{$geometry:{type:"Polygon",coordinates:[o.map((function(e){return[e.longitude,e.latitude]}))]}})}},Object.assign(t.Condition,{eq:t.Condition.equal,ne:t.Condition.notEqual,lt:t.Condition.lessThan,le:t.Condition.lessThanOrEqualTo,gt:t.Condition.greaterThan,ge:t.Condition.greaterThanOrEqualTo,containsAny:t.Condition.in})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntityType=void 0;var n=r(0),o=r(5),i=r(19),a=r(10),s=r(37),u=r(38),c=r(11),l=r(9),d=r(1),p=function(e){function t(t,r,n){var o=e.call(this,t,n)||this;return o.declaredId=null,o.declaredVersion=null,o.declaredAcl=null,o.loadPermission=new d.Permission,o.updatePermission=new d.Permission,o.deletePermission=new d.Permission,o.queryPermission=new d.Permission,o.schemaSubclassPermission=new d.Permission,o.insertPermission=new d.Permission,o.superType=r,o}return n.__extends(t,e),Object.defineProperty(t.prototype,"persistenceType",{get:function(){return a.PersistenceType.ENTITY},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.declaredId||this.superType.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this.declaredVersion||this.superType.version},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"acl",{get:function(){return this.declaredAcl||this.superType.acl},enumerable:!1,configurable:!0}),t.prototype.createProxyClass=function(){var e=this.superType.typeConstructor;if(e===Object)switch(this.name){case"User":e=o.User;break;case"Role":e=o.Role;break;default:e=o.Entity}return this.enhancer.createProxy(e)},t.prototype.getReferencing=function(e,t){for(var r=n.__assign({},t),o=e.metamodel.entities,i=new Map,a=Object.keys(o),s=0,l=a.length;s<l;s+=1){var d=a[s];if(!r.classes||-1!==r.classes.indexOf(d))for(var p=o[d].attributes(),f=p.next();!f.done;f=p.next()){var h=f.value;if(h instanceof u.SingularAttribute&&h.type===this||h instanceof c.PluralAttribute&&h.elementType===this){var y=i.get(h.declaringType)||new Set;y.add(h.name),i.set(h.declaringType,y)}}}return i},t.prototype.createObjectFactory=function(e){switch(this.name){case"User":return o.UserFactory.create(this,e);case"Device":return o.DeviceFactory.create(this,e);default:return o.EntityFactory.create(this,e)}},t.prototype.fromJsonValue=function(t,r,o,i){var a,s;if("string"==typeof r)return(null===(a=t.db)||void 0===a?void 0:a.getReference(r))||null;if(!r||"object"!=typeof r)return null;var u,c=r,l=n.__assign({persisting:!1,onlyMetadata:!1},i);if(o){var p=d.Metadata.get(o);c.id&&p.id&&c.id!==p.id||(u=o)}if(u||(u=null===(s=t.db)||void 0===s?void 0:s.getReference(this.typeConstructor,c.id)),!u)return null;var f=d.Metadata.get(u);return f.enable(!1),e.prototype.fromJsonValue.call(this,f,c,u,l),f.enable(!0),l.persisting?f.setPersistent():l.onlyMetadata||f.setDirty(),u},t.prototype.toJsonValue=function(t,r,o){var i=o||{},a=i.depth,s=void 0===a?0:a,u=i.persisting,c=void 0!==u&&u,l=!0===s||s>-1,p=r&&d.Metadata.get(r);if(l&&p&&p.isAvailable){p.enable(!1);var f=e.prototype.toJsonValue.call(this,p,r,n.__assign(n.__assign({},o),{persisting:c,depth:"boolean"==typeof s?s:s-1}));return p.enable(!0),f}return t.db&&r instanceof this.typeConstructor?(r.attach(t.db),r.id):null},t.prototype.toString=function(){return"EntityType("+this.ref+")"},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this),r=t.acl,o=n.__rest(t,["acl"]);return n.__assign(n.__assign({},o),{acl:n.__assign(n.__assign({},r),{schemaSubclass:this.schemaSubclassPermission.toJSON(),load:this.loadPermission.toJSON(),insert:this.insertPermission.toJSON(),update:this.updatePermission.toJSON(),delete:this.deletePermission.toJSON(),query:this.queryPermission.toJSON()})})},t.Object=function(e){function r(){var r=e.call(this,t.Object.ref,null,Object)||this;return r.declaredId=new(function(e){function t(){return e.call(this,"id",s.BasicType.String,!0)||this}return n.__extends(t,e),t.prototype.getJsonValue=function(e){return e.id||void 0},t.prototype.setJsonValue=function(e,t,r){e.id||(e.id=r)},t}(u.SingularAttribute)),r.declaredId.init(r,0),r.declaredId.isId=!0,r.declaredVersion=new(function(e){function t(){return e.call(this,"version",s.BasicType.Integer,!0)||this}return n.__extends(t,e),t.prototype.getJsonValue=function(e){return e.version||void 0},t.prototype.setJsonValue=function(e,t,r){r&&(e.version=r)},t}(u.SingularAttribute)),r.declaredVersion.init(r,1),r.declaredVersion.isVersion=!0,r.declaredAcl=new(function(e){function t(){return e.call(this,"acl",s.BasicType.JsonObject,!0)||this}return n.__extends(t,e),t.prototype.getJsonValue=function(e,t,r){var n=l.Attribute.attachState(t,{}),o=n.acl||{},i=e.acl.toJSON();return Object.keys(i).every((function(e){var t=o[e]||{},r=i[e],n=Object.keys(r),a=Object.keys(t);return n.length===a.length&&n.every((function(e){return t[e]===r[e]}))}))||e.setDirty(),r.persisting&&(n.acl=i),i},t.prototype.setJsonValue=function(e,t,r,n){var o=r||{};n.persisting&&(l.Attribute.attachState(t,{}).acl=o);e.acl.fromJSON(o)},t}(u.SingularAttribute)),r.declaredAcl.init(r,2),r.declaredAcl.isAcl=!0,r.declaredAttributes=[r.declaredId,r.declaredVersion,r.declaredAcl],r}return n.__extends(r,e),Object.defineProperty(r,"ref",{get:function(){return"/db/Object"},enumerable:!1,configurable:!0}),r.prototype.createObjectFactory=function(){throw new Error("Objects can't be directly created and persisted")},r}(t),t}(i.ManagedType);t.EntityType=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BasicType=void 0;var n=r(0),o=r(5),i=r(33),a=r(10);function s(e){return e instanceof Date?e.toISOString().replace(/\.?0*Z/,"Z"):null}function u(e,t){var r="string"==typeof e?new Date(e):null;return t&&r&&t.toISOString()===r.toISOString()?t:r}var c=function(e){function t(t,r,n){var o=this,i=0===t.indexOf("/db/")?t:"/db/"+t;return(o=e.call(this,i,r)||this).noResolving=!!n,o}return n.__extends(t,e),Object.defineProperty(t.prototype,"persistenceType",{get:function(){return a.PersistenceType.BASIC},enumerable:!1,configurable:!0}),t.prototype.toJsonValue=function(e,t){return null==t?null:this.typeConstructor(t)},t.prototype.fromJsonValue=function(e,t,r){return null==t?null:t},t.prototype.toString=function(){return"BasicType("+this.ref+")"},t.Boolean=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.fromJsonValue=function(t,r,n){return"string"==typeof r?"false"!==r:e.prototype.fromJsonValue.call(this,t,r,n)},t}(t))("Boolean",Boolean),t.Double=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.fromJsonValue=function(t,r,n){return"string"==typeof r?parseFloat(r):e.prototype.fromJsonValue.call(this,t,r,n)},t}(t))("Double",Number),t.Integer=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.fromJsonValue=function(t,r,n){return"string"==typeof r?parseInt(r,10):e.prototype.fromJsonValue.call(this,t,r,n)},t}(t))("Integer",Number),t.String=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(t))("String",String),t.DateTime=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.toJsonValue=function(e,t){return s(t)},t.prototype.fromJsonValue=function(e,t,r){return u(t,r)},t}(t))("DateTime",Date),t.Date=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.toJsonValue=function(e,t){var r=s(t);return r?r.substring(0,r.indexOf("T")):null},t.prototype.fromJsonValue=function(e,t,r){return u(t,r)},t}(t))("Date",Date),t.Time=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.toJsonValue=function(e,t){var r=s(t);return r?r.substring(r.indexOf("T")+1):null},t.prototype.fromJsonValue=function(e,t,r){return"string"==typeof t?u("1970-01-01T"+t,r):null},t}(t))("Time",Date),t.File=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.toJsonValue=function(e,t){return t instanceof o.File?t.id:null},t.prototype.fromJsonValue=function(e,t,r){return t?r&&r.id===t?r:e.db?new e.db.File(t):null:null},t}(t))("File",o.File),t.GeoPoint=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.toJsonValue=function(e,t){return t instanceof i.GeoPoint?t.toJSON():null},t.prototype.fromJsonValue=function(e,t){return t?new i.GeoPoint(t):null},t}(t))("GeoPoint",i.GeoPoint),t.JsonArray=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.toJsonValue=function(e,t){return Array.isArray(t)?t:null},t.prototype.fromJsonValue=function(e,t){return Array.isArray(t)?t:null},t}(t))("JsonArray",Array),t.JsonObject=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.toJsonValue=function(e,t){return t&&t.constructor===Object?t:null},t}(t))("JsonObject",Object),t}(a.Type);t.BasicType=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SingularAttribute=void 0;var n=r(0),o=r(9),i=r(10),a=function(e){function t(t,r,n){var o=e.call(this,t,n)||this;return o.type=r,o}return n.__extends(t,e),Object.defineProperty(t.prototype,"typeConstructor",{get:function(){return this.type.typeConstructor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"persistentAttributeType",{get:function(){switch(this.type.persistenceType){case i.PersistenceType.BASIC:return o.PersistentAttributeType.BASIC;case i.PersistenceType.EMBEDDABLE:return o.PersistentAttributeType.EMBEDDED;case i.PersistenceType.ENTITY:return o.PersistentAttributeType.ONE_TO_MANY;default:throw new Error("Unknown persistent attribute type.")}},enumerable:!1,configurable:!0}),t.prototype.getJsonValue=function(e,t,r){var n=o.Attribute.attachState(t,{}),i=this.getValue(t),a=n[this.name]!==i;return r.persisting&&(n[this.name]=i),a&&e.setDirty(),this.type.toJsonValue(e,i,r)},t.prototype.setJsonValue=function(e,t,r,n){var i=this.type.fromJsonValue(e,r,this.getValue(t),n);n.persisting&&(o.Attribute.attachState(t,{})[this.name]=i);this.setValue(t,i)},t.prototype.toJSON=function(){return n.__assign({type:this.type.ref},e.prototype.toJSON.call(this))},t}(o.Attribute);t.SingularAttribute=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XMLHttpConnector=void 0;var n=r(0),o=r(25),i=r(3),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.isUsable=function(e,t,r,n){return"undefined"!=typeof XMLHttpRequest},t.prototype.doSend=function(e,t,r){var n=this;if("OAUTH"===t.method){this.oAuthHandle&&this.oAuthHandle({status:409,headers:{},entity:'{"message": "A new OAuth request was sent."}'}),localStorage.removeItem("oauth-response");var i=function(e){"oauth-response"===e.key&&n.oAuthHandle&&e.newValue&&n.oAuthHandle(JSON.parse(e.newValue))};return this.oAuthHandle=function(e){r(e),localStorage.removeItem("oauth-response"),removeEventListener("storage",i,!1)},void addEventListener("storage",i,!1)}var a=new XMLHttpRequest,s=this.origin+this.basePath+t.path;a.onreadystatechange=function(){if(a.responseType&&2===a.readyState&&a.status>=400&&(a.responseType="text"),4===a.readyState){var e={headers:{},status:a.status,entity:a.response||a.responseText};o.Connector.RESPONSE_HEADERS.forEach((function(t){e.headers[t]=a.getResponseHeader(t)||""})),r(e)}},a.upload&&e.progress()&&(a.upload.onprogress=e.progress()),a.open(t.method,s,!0);for(var u=t.entity,c=t.headers,l=Object.keys(c),d=0,p=l.length;d<p;d+=1){var f=l[d];a.setRequestHeader(f,c[f])}switch(a.withCredentials=e.withCredentials,e.responseType()){case"arraybuffer":a.responseType="arraybuffer";break;case"blob":case"data-url":case"base64":a.responseType="blob"}a.send(u)},t.prototype.fromFormat=function(e,t,r){if("json"===r)return JSON.parse(t);if("data-url"===r||"base64"===r){var n=new FileReader;return n.readAsDataURL(t),new Promise((function(e,t){n.onload=e,n.onerror=t})).then((function(){var e=n.result;return"base64"===r&&"string"==typeof e&&(e=e.substring(e.indexOf(",")+1)),e}))}return t},t.prototype.toFormat=function(e){var t=e.request.type;if(t){var r=e.request.entity,n=e.mimeType();switch(t){case"blob":n=n||r.type;break;case"arraybuffer":case"form":break;case"data-url":var o=r.match(/^data:(.+?)(;base64)?,(.*)$/),a=o[2];if(r=o[3],t="blob",n=n||o[1],!a){r=decodeURIComponent(r);break}case"base64":for(var s=i.atob(r),u=s.length,c=new Uint8Array(u),l=0;l<u;l+=1)c[l]=s.charCodeAt(l);t="blob",r=new Blob([c],{type:n});break;case"json":"string"!=typeof r&&(r=JSON.stringify(r));break;case"text":break;default:throw new Error("Supported request format:"+t)}e.entity(r,t).mimeType(n)}},t}(o.Connector);t.XMLHttpConnector=a,o.Connector.connectors.push(a)},function(e,t,r){"use strict";var n,o,i=r(21),a=r(7),s=0,u=0;t.a=function(e,t,r){var c=t&&r||0,l=t||new Array(16),d=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:o;if(null==d||null==p){var f=e.random||(e.rng||i.a)();null==d&&(d=n=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==p&&(p=o=16383&(f[6]<<8|f[7]))}var h=void 0!==e.msecs?e.msecs:Date.now(),y=void 0!==e.nsecs?e.nsecs:u+1,b=h-s+(y-u)/1e4;if(b<0&&void 0===e.clockseq&&(p=p+1&16383),(b<0||h>s)&&void 0===e.nsecs&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=h,u=y,o=p;var g=(1e4*(268435455&(h+=122192928e5))+y)%4294967296;l[c++]=g>>>24&255,l[c++]=g>>>16&255,l[c++]=g>>>8&255,l[c++]=255&g;var m=h/4294967296*1e4&268435455;l[c++]=m>>>8&255,l[c++]=255&m,l[c++]=m>>>24&15|16,l[c++]=m>>>16&255,l[c++]=p>>>8|128,l[c++]=255&p;for(var v=0;v<6;++v)l[c+v]=d[v];return t||Object(a.a)(l)}},function(e,t,r){"use strict";var n=r(22),o=r(64),i=Object(n.a)("v3",48,o.a);t.a=i},function(e,t,r){"use strict";var n=r(21),o=r(7);t.a=function(e,t,r){var i=(e=e||{}).random||(e.rng||n.a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var a=0;a<16;++a)t[r+a]=i[a];return t}return Object(o.a)(i)}},function(e,t,r){"use strict";var n=r(22),o=r(65),i=Object(n.a)("v5",80,o.a);t.a=i},function(e,t,r){"use strict";t.a="00000000-0000-0000-0000-000000000000"},function(e,t,r){"use strict";var n=r(8);t.a=function(e){if(!Object(n.a)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},function(e,t,r){"use strict";function n(){throw new Error("This functionality is only available, if the optional rxjs dependency is also provided.")}Object.defineProperty(t,"__esModule",{value:!0}),t.Subscriber=t.Subscription=t.Observable=void 0;var o={Observable:n,Subscription:n,Subscriber:n};try{o=r(85)}catch(e){}var i=o.Observable,a=o.Subscription,s=o.Subscriber;t.Observable=i,t.Subscription=a,t.Subscriber=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManagedFactory=void 0;var n=r(0),o=r(27),i=r(1),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.methods=null,t.managedType=null,t.db=null,t}return n.__extends(t,e),t.create=function(e,t){var r=this.createFactory(e.typeConstructor);return r.methods=r.prototype,r.managedType=e,r.db=t,r},t.prototype.fromJSON=function(e){var t=this.newInstance();return this.managedType.fromJsonValue(i.Metadata.create(this.managedType,this.db),e,t,{persisting:!1})},t.prototype.addMethods=function(e){Object.assign(this.methods,e)},t.prototype.addMethod=function(e,t){this.methods[e]=t},t}(o.Factory);t.ManagedFactory=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Permission=void 0;var n=r(0),o=function(){function e(){this.rules={}}return e.prototype.allRules=function(){return Object.keys(this.rules)},e.prototype.clear=function(){this.rules={}},e.prototype.copy=function(e){return this.rules=n.__assign({},e.rules),this},e.prototype.isPublicAllowed=function(){var e=this;return!("*"in this.rules)&&!this.allRules().some((function(t){return"allow"===e.rules[t]}))},e.prototype.setPublicAllowed=function(){var e=this;this.allRules().forEach((function(t){"allow"===e.rules[t]&&delete e.rules[t]}))},e.prototype.getRule=function(e){return this.rules[this.ref(e)]},e.prototype.isAllowed=function(e){return"allow"===this.rules[this.ref(e)]},e.prototype.isDenied=function(e){return"deny"===this.rules[this.ref(e)]},e.prototype.allowAccess=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0;r<e.length;r+=1)this.rules[this.ref(e[r])]="allow";return this},e.prototype.denyAccess=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0;r<e.length;r+=1)this.rules[this.ref(e[r])]="deny";return this},e.prototype.deleteAccess=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0;r<e.length;r+=1)delete this.rules[this.ref(e[r])];return this},e.prototype.toJSON=function(){return n.__assign({},this.rules)},e.prototype.fromJSON=function(e){this.rules=e},e.fromJSON=function(e){var t=new this;return t.fromJSON(e),t},e.prototype.ref=function(e){var t="string"==typeof e?e:e.id;if(0===t.indexOf("/db/User/")||0===t.indexOf("/db/Role/"))return t;throw new TypeError("The given object isn't a user, role or a valid reference.")},e.BASE_PERMISSIONS=["load","update","delete","query","insert"],e}();t.Permission=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Validator=void 0;var n=r(0),o={},i=o;try{i=r(88)}catch(e){}var a=function(){function e(e,t){this.errors=[],this.key=e,this.entity=t}return e.compile=function(e,t){for(var r=[],a=e.attributes(),s=a.next();!s.done;s=a.next()){var u=s.value;r.push(u.name)}var c=new(Function.bind.apply(Function,n.__spreadArrays([void 0],r,[t])));return function(e){if(i===o)throw new Error("Validation code will not be executed. Make sure that the validator package is correctly provided as an external dependency.");var t=r.map((function(t){return e[t]}));return c.apply({},t)}},Object.defineProperty(e.prototype,"value",{get:function(){return this.entity[this.key]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){return 0===this.errors.length},enumerable:!1,configurable:!0}),e.prototype.is=function(e,t){return e instanceof Function?this.is("is",e):(!1===t(this.value,i)&&this.errors.push(e),this)},e.prototype.callMethod=function(e,t,r){var n=r||[];try{n.unshift(this.toStringValue()),!1===i[e].apply(this,n)&&this.errors.push(t||e)}catch(e){this.errors.push(t||e.message)}return this},e.prototype.toStringValue=function(){var e=this.value;return"string"==typeof e||e instanceof Date?e:JSON.stringify(e)},e.prototype.toJSON=function(){return{isValid:this.isValid,errors:this.errors}},e}();t.Validator=a;var s=["contains","equals","matches"];Object.keys(i).forEach((function(e){(e.startsWith("is")||s.includes(e))&&(a.prototype[e]=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n="string"==typeof t[0]?t.shift():null;return this.callMethod(e,n,t)})}))},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.File=void 0;var o=r(0),i=r(4),a=r(15),s=r(3),u=o.__importStar(r(2)),c=r(6),l="/file".length,d=Symbol("Id"),p=Symbol("Metadata"),f=Symbol("Data"),h=function(){function e(e){this.db=null,this[n]=null;var t="string"==typeof e?{id:e}:e||{};if(t.id){if(-1===t.id.indexOf("/","/file/".length)||0!==t.id.indexOf("/file/"))throw new Error("Invalid file reference "+t.id);this[d]=t.id}else this[d]=this.createIdFromOptions(t);this.setDataOptions(t),this.isFolder="/"===this.id.charAt(this.id.length-1)}return Object.defineProperty(e.prototype,"id",{get:function(){return this[d]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){throw new Error("This method is removed. Use the asynchronous File.createURL() method instead.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.id.substring(this.id.lastIndexOf("/",this.id.length-2)+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mimeType",{get:function(){if(this.isFolder)throw new Error("A folder has no mimeType");return this.checkAvailable(),this[p].mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"acl",{get:function(){return this.checkAvailable(),this[p].acl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastModified",{get:function(){if(this.isFolder)throw new Error("A folder has no lastModified");return this.checkAvailable(),this[p].lastModified},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"createdAt",{get:function(){if(this.isFolder)throw new Error("A folder has no creation date");return this.checkAvailable(),this[p].createdAt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eTag",{get:function(){if(this.isFolder)throw new Error("A folder has no eTag");return this.checkAvailable(),this[p].eTag},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"headers",{get:function(){if(this.isFolder)throw new Error("A folder has no custom headers");return this.checkAvailable(),this[p].headers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){if(this.isFolder)throw new Error("A folder has no size");return this.checkAvailable(),this[p].size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bucket",{get:function(){return this.id.substring(l+1,this.id.indexOf("/",l+1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.id.substring(this.id.indexOf("/",l+1)+1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.id.substring(l)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.id.substring(l,this.id.lastIndexOf("/",this.id.length-2))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMetadataLoaded",{get:function(){return!!this[p]},enumerable:!1,configurable:!0}),e.parseETag=function(e){if(!e)return null;var t=e.match(/^(?:[wW]\/)?["'](.*)["']$/);return t?t[1]:null},e.prototype.createURL=function(e){if(this.isFolder)throw new Error("Url can not be created for folders.");return this.db.createURL(this.id,"boolean"==typeof e?e:"www"!==this.bucket)},e.prototype.upload=function(e,t,r){var n,o=this,i=e||{};if(this.isFolder)throw new Error("A folder cannot be uploaded");this.setDataOptions(i);var a=new u.UploadFile(this.bucket,this.key).entity(this[f].data,null===(n=this[f])||void 0===n?void 0:n.type),s=this[p];return s&&(a.acl(s.acl),a.contentLength(s.size),a.mimeType(s.mimeType),a.customHeaders(s.headers)),a.progress(i.progress||null),this.conditional(a,i),this.db.addToBlackList(this.id),this.db.send(a).then((function(e){return o[f]=null,o.fromJSON(e.entity),o})).then(t,r)},e.prototype.download=function(e,t,r){var n=this,o=e||{};if(this.isFolder)throw new Error("A folder cannot be downloaded");var i=o.type||"blob",a=new u.DownloadFile(this.bucket,this.key).responseType(i);return this.db.ensureCacheHeader(this.id,a,o.refresh),this.db.send(a).then((function(e){return n.db.addToWhiteList(n.id),n.fromHeaders(e.headers),e.entity}),(function(e){if(e.status===c.StatusCode.OBJECT_NOT_FOUND)return null;throw e})).then(t,r)},e.prototype.delete=function(e,t,r){var n=this,o=e||{},i=new u.DeleteFile(this.bucket,this.key);return this.conditional(i,o),this.isFolder||this.db.addToBlackList(this.id),this.db.send(i).then((function(e){return n.isFolder?e.entity.map((function(e){return new n.db.File(e)})):n})).then(t,r)},e.prototype.createIdFromOptions=function(e){var t,r;if(e.path)r=e.path;else{var n=s.trailingSlashIt(e.parent||"/www");if(n.length<3)throw new Error("Invalid parent name: "+n);r=n+(e.name||(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.name)||s.uuid())}if("/"!==r.charAt(0)&&(r="/"+r),-1!==r.indexOf("//")||r.length<3)throw new Error("Invalid path: "+r);return"/file"+r},e.prototype.conditional=function(e,t){if(!t.force){var r=this[p];r&&(r.lastModified||r.eTag)?(e.ifUnmodifiedSince(r.lastModified),e.ifMatch(r.eTag)):e.ifNoneMatch("*")}},e.prototype.loadMetadata=function(e,t,r){var n=this,o=e||{};if(this.isFolder)throw new Error("A folder has no mata data.");var i=new u.GetFileMetadata(this.bucket,this.key);return this.db.ensureCacheHeader(this.id,i,o.refresh),this.db.send(i).then((function(e){return n.fromHeaders(e.headers),n}),(function(e){if(e.status===c.StatusCode.OBJECT_NOT_FOUND)return null;throw e})).then(t,r)},e.prototype.saveMetadata=function(e,t,r){var n=this,o=e||{},i=this.toJSON(),a=new u.UpdateFileMetadata(this.bucket,this.key).entity(i);return this.conditional(a,o),this.db.send(a).then((function(e){return n.fromJSON(e.entity),n})).then(t,r)},e.prototype.setDataOptions=function(e){var t=e.data,r=e.type,n=o.__rest(e,["data","type"]);if(t){this[f]={type:r,data:t};var i=this.guessMimeType(e)||void 0;this.fromJSON(o.__assign(o.__assign({},n),{mimeType:i}))}},e.prototype.guessMimeType=function(e){var t=e.mimeType;if(t)return t;if("undefined"!=typeof Blob&&e.data instanceof Blob)return e.data.type;if("data-url"===e.type&&"string"==typeof e.data){var r=e.data.match(/^data:(.+?)(;base64)?,.*$/);return r&&r[1]}return null},e.prototype.fromHeaders=function(t){this.fromJSON({eTag:e.parseETag(t.etag),lastModified:t["last-modified"],createdAt:t["baqend-created-at"],mimeType:t["content-type"],acl:t["baqend-acl"]&&JSON.parse(t["baqend-acl"]),size:+t["baqend-size"],headers:t["baqend-custom-headers"]&&JSON.parse(t["baqend-custom-headers"])})},e.prototype.fromJSON=function(e){var t=e.id;if(t&&this.id!==t)throw new Error("This file id "+this.id+" does not match the given json id "+t);var r,n=this[p]||{};e.acl instanceof a.Acl?r=e.acl:(r=n.acl||new a.Acl,e.acl&&r.fromJSON(e.acl)),this[p]=o.__assign(o.__assign({},this[p]),{mimeType:e.mimeType,lastModified:e.lastModified&&new Date(e.lastModified)||n.lastModified,createdAt:e.createdAt&&new Date(e.createdAt)||n.createdAt,eTag:e.eTag||n.eTag,acl:r,size:"number"==typeof e.size?e.size:e.contentLength,headers:e.headers||n.headers||{}})},e.prototype.toJSON=function(){var e;this.checkAvailable();var t=this[p];return{id:this.id,mimeType:t.mimeType,eTag:t.eTag,acl:null===(e=t.acl)||void 0===e?void 0:e.toJSON(),size:t.size,lastModified:t.lastModified&&t.lastModified.toISOString(),createdAt:t.createdAt&&t.createdAt.toISOString(),headers:t.headers}},e.prototype.checkAvailable=function(){if(!this.isMetadataLoaded)throw new i.PersistentError("The file metadata of "+this.id+" is not available.")},e}();t.File=h,n=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Managed=void 0;var n=r(0),o=r(16),i=r(26),a=r(1),s=function(){function e(t){e.init(this,t)}return e.init=function(e,t){var r=i.Enhancer.getBaqendType(e.constructor);r.isEntity&&Object.defineProperty(e,"_metadata",{value:a.Metadata.create(r),configurable:!0}),t&&Object.assign(e,t)},e.extend=function(t){return t.prototype=Object.create(this.prototype,{constructor:{value:t,configurable:!0,writable:!0}}),t.extend=e.extend,t},e.prototype.toString=function(){return i.Enhancer.getBaqendType(this.constructor).ref},e.prototype.toJSON=function(){var e=i.Enhancer.getBaqendType(this.constructor);return e.toJsonValue(a.Metadata.create(e),this,{persisting:!1})},n.__decorate([o.enumerable(!1)],e.prototype,"toString",null),n.__decorate([o.enumerable(!1)],e.prototype,"toJSON",null),e}();t.Managed=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PartialUpdateBuilder=void 0;var n=r(0),o=r(100),i=["$add","$and","$currentDate","$dec","$inc","$max","$min","$mul","$or","$pop","$push","$put","$remove","$rename","$replace","$set","$shift","$unshift","$xor"],a=function(){function e(e){this.operations=[],e&&this.addOperations(e)}return e.prototype.set=function(e,t){var r=t;if(r instanceof Set)r=Array.from(r);else if(r instanceof Map){var n={};r.forEach((function(e,t){n[t]=e})),r=n}return this.addOperation(e,"$set",r)},e.prototype.inc=function(e,t){return this.addOperation(e,"$inc","number"==typeof t?t:1)},e.prototype.dec=function(e,t){return this.inc(e,"number"==typeof t?-t:-1)},e.prototype.mul=function(e,t){if("number"!=typeof t)throw new Error("Multiplicator must be a number.");return this.addOperation(e,"$mul",t)},e.prototype.div=function(e,t){if("number"!=typeof t)throw new Error("Divisor must be a number.");return this.addOperation(e,"$mul",1/t)},e.prototype.min=function(e,t){if("number"!=typeof t)throw new Error("Value must be a number");return this.addOperation(e,"$min",t)},e.prototype.max=function(e,t){if("number"!=typeof t)throw new Error("Value must be a number");return this.addOperation(e,"$max",t)},e.prototype.remove=function(e,t){return this.addOperation(e,"$remove",t)},e.prototype.put=function(e,t,r){var n={};return"string"==typeof t||"number"==typeof t?n[t]=r:"object"==typeof t&&Object.assign(n,t),this.addOperation(e,"$put",n)},e.prototype.push=function(e,t){return this.addOperation(e,"$push",t)},e.prototype.unshift=function(e,t){return this.addOperation(e,"$unshift",t)},e.prototype.pop=function(e){return this.addOperation(e,"$pop")},e.prototype.shift=function(e){return this.addOperation(e,"$shift")},e.prototype.add=function(e,t){return this.addOperation(e,"$add",t)},e.prototype.replace=function(e,t,r){if(this.hasOperationOnPath(e))throw new Error("You cannot update "+e+" multiple times");return this.addOperation(e+"."+t,"$replace",r)},e.prototype.currentDate=function(e){return this.addOperation(e,"$currentDate")},e.prototype.and=function(e,t){return this.addOperation(e,"$and",t)},e.prototype.or=function(e,t){return this.addOperation(e,"$or",t)},e.prototype.xor=function(e,t){return this.addOperation(e,"$xor",t)},e.prototype.rename=function(e,t){return this.addOperation(e,"$rename",t)},e.prototype.toJSON=function(){return this.operations.reduce((function(e,t){var r,o;return n.__assign(n.__assign({},e),((r={})[t.name]=n.__assign(n.__assign({},e[t.name]),((o={})[t.path]=t.value,o)),r))}),{})},e.prototype.execute=function(){throw new Error('Cannot call "execute" on abstract PartialUpdateBuilder')},e.prototype.addOperation=function(e,t,r){if("string"!=typeof e)throw new Error("Path must be a string");if(-1===i.indexOf(t))throw new Error("Operation invalid: "+t);if(this.hasOperationOnPath(e))throw new Error("You cannot update "+e+" multiple times");if("number"==typeof r){if(Number.isNaN(r))throw new Error("NaN is not a supported value");if(!Number.isFinite(r))throw new Error("Infinity is not a supported value")}var n=void 0===r?null:r,a=new o.UpdateOperation(t,e,n);return this.operations.push(a),this},e.prototype.addOperations=function(e){var t=this;Object.keys(e).forEach((function(r){var n=e[r];Object.keys(n).forEach((function(e){var i=n[e];t.operations.push(new o.UpdateOperation(r,e,i))}))}))},e.prototype.hasOperationOnPath=function(e){return this.operations.some((function(t){return t.path===e}))},e}();t.PartialUpdateBuilder=a,Object.assign(a.prototype,{increment:a.prototype.inc,decrement:a.prototype.dec,multiply:a.prototype.mul,divide:a.prototype.div,atMost:a.prototype.min,atLeast:a.prototype.max,toNow:a.prototype.currentDate})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var n=r(0),o=r(16),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.newPassword=function(e,t,r,n){return this._metadata.db.newPassword(this.username,e,t).then(r,n)},t.prototype.changeUsername=function(e,t,r,n){return this._metadata.db.changeUsername(this.username,e,t).then(r,n)},t.prototype.requestAPIToken=function(e,t){return this._metadata.db.requestAPIToken(this.constructor,this).then(e,t)},n.__decorate([o.enumerable(!1)],t.prototype,"newPassword",null),n.__decorate([o.enumerable(!1)],t.prototype,"changeUsername",null),n.__decorate([o.enumerable(!1)],t.prototype,"requestAPIToken",null),t}(r(30).Entity);t.User=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=void 0;var n=r(0),o=r(17),i=r(35),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.filter={},t}return n.__extends(t,e),t.prototype.addFilter=function(e,t,r){if(null!==e){if("string"!=typeof e)throw new Error("Field must be a string.");if(t){var n=this.filter[e],o=void 0;"object"==typeof n&&Object.getPrototypeOf(n)===Object.prototype?o=n:(o={},this.filter[e]=o),o[t]=r}else this.filter[e]=r}else Object.assign(this.filter,r);return this},t.prototype.toJSON=function(){return this.filter},t}(o.Node);t.Filter=a,Object.assign(a.prototype,i.Condition)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var n=r(0),o=r(46),i=r(3),a=r(1),s=function(){function e(){}return e.createEventStream=function(t,r,o){var i=o||{};return i.reconnects=0,e.streamObservable(t,r,i,(function(o,i){o.type;var a=n.__rest(o,["type"]);"result"===o.type&&o.data.forEach((function(o,s){var u=n.__assign(n.__assign(n.__assign({matchType:"add",operation:"none",initial:!0},a),{data:e.resolveObject(t,o)}),r.sort&&{index:s});i(u)})),"match"===o.type&&i(n.__assign(n.__assign({initial:!1},a),{data:e.resolveObject(t,o.data)}))}))},e.createResultStream=function(t,r,n){var o,i=n||{};i.initial=!0,i.matchTypes="all",i.operations="any";var a=!!r.sort;return e.streamObservable(t,r,i,(function(r,n){if("result"===r.type&&n((o=r.data.map((function(r){return e.resolveObject(t,r)}))).slice()),"match"===r.type){var i=e.resolveObject(t,r.data);if("remove"===r.matchType||"changeIndex"===r.matchType)for(var s=0,u=o.length;s<u;s+=1)if(o[s].id===r.data.id){o.splice(s,1);break}"add"!==r.matchType&&"changeIndex"!==r.matchType||(a?o.splice(r.index,0,i):o.push(i)),n(o.slice())}}))},e.streamObservable=function(t,r,a,s){var u=e.parseOptions(a),c=t.entityManagerFactory.websocket,l=new o.Observable((function(e){var o=i.uuid(),a=c.openStream(t.tokenStorage,o);a.send(n.__assign(n.__assign({type:"subscribe"},r),u));var l=!1,d=e.next.bind(e),p=a.subscribe({complete:function(){l=!0,e.complete()},error:function(t){l=!0,e.error(t)},next:function(e){s(e,d)}});return function(){l||(a.send({type:"unsubscribe"}),p.unsubscribe(),l=!0)}}));return e.cachedObservable(l,u)},e.cachedObservable=function(e,t){var r=null,n=[];return new o.Observable((function(o){if(!r){var i=t.reconnects,a=1,s={next:function(e){a=1,n.forEach((function(t){return t.next(e)}))},error:function(e){n.forEach((function(t){return t.error(e)}))},complete:function(){0!==i?(i=i<0?-1:i-1,setTimeout((function(){r=e.subscribe(s)}),1e3*a),a*=2):n.forEach((function(e){return e.complete()}))}};r=e.subscribe(s)}return n.push(o),function(){n.splice(n.indexOf(o),1),!n.length&&r&&(r.unsubscribe(),r=null)}}))},e.parseOptions=function(t){var r=t||{},n={initial:void 0===r.initial||!!r.initial,matchTypes:e.normalizeMatchTypes(r.matchTypes),operations:e.normalizeOperations(r.operations),reconnects:e.normalizeReconnects(r.reconnects)};if(-1===n.matchTypes.indexOf("all")&&-1===n.operations.indexOf("any"))throw new Error("Only subscriptions for either operations or matchTypes are allowed. You cannot subscribe to a query using matchTypes and operations at the same time!");return n},e.normalizeMatchTypes=function(t){return e.normalizeSortedSet(t,"all","match types",["add","change","changeIndex","match","remove"])},e.normalizeReconnects=function(e){return void 0===e||e<0?-1:Number(e)},e.normalizeOperations=function(t){return e.normalizeSortedSet(t,"any","operations",["delete","insert","none","update"])},e.normalizeSortedSet=function(e,t,r,n){if(!e)return[t];var o,i=Array.isArray(e)?e:[e];if(0===i.length)return[t];i.sort();for(var a=null,s=i.length-1;s>=0;s-=1){if(!(o=i[s]))throw new Error("undefined and null not allowed!");if(o===a&&i.splice(s,1),o===t)return[t];if(-1===n.indexOf(o))throw new Error(o+" not allowed for "+r+"! (permitted: "+n+".)");a=o}return i},e.resolveObject=function(e,t){var r=e.getReference(t.id),n=a.Metadata.get(r);return t.version?r.version<=t.version&&n.type.fromJsonValue(n,t,r,{persisting:!0}):(n.setRemoved(),e.removeReference(r)),r},e}();t.Stream=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Operator=void 0;var n=r(0),o=function(e){function t(t,r,n,o){var i=e.call(this,t,r)||this;return i.operator=n,i.childes=o,i}return n.__extends(t,e),t.prototype.toJSON=function(){var e={};return e[this.operator]=this.childes,e},t}(r(17).Node);t.Operator=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModelBuilder=void 0;var n=r(37),o=r(36),i=r(58),a=r(59),s=r(60),u=r(61),c=r(38),l=r(4),d=r(1),p=function(){function e(){var e=this;this.models={},this.modelDescriptors=null,Object.keys(n.BasicType).forEach((function(t){var r=n.BasicType[t];r instanceof n.BasicType&&(e.models[r.ref]=r)}))}return e.prototype.getModel=function(e){if(e in this.models)return this.models[e];var t=this.buildModel(e);return this.models[e]=t,t},e.prototype.buildModels=function(e){var t=this;return this.modelDescriptors={},e.forEach((function(e){t.modelDescriptors[e.class]=e})),Object.keys(this.modelDescriptors).forEach((function(e){try{var r=t.getModel(e);t.buildAttributes(r)}catch(t){throw new l.PersistentError("Can't create model for entity class "+e,t)}})),this.getModel(o.EntityType.Object.ref),this.models},e.prototype.buildModel=function(e){var t,r=this.modelDescriptors[e];if(e===o.EntityType.Object.ref)t=new o.EntityType.Object;else{if(!r)throw new TypeError("No model available for "+e);if(r.embedded)t=new i.EmbeddableType(e);else{var n=r.superClass||o.EntityType.Object.ref;t=new o.EntityType(e,this.getModel(n))}}if(t.metadata={},r){t.metadata=r.metadata||{};var a=r.acl||{};Object.keys(a).forEach((function(e){t[e+"Permission"].fromJSON(a[e])}))}return t},e.prototype.buildAttributes=function(e){var t=this,r=this.modelDescriptors[e.ref],n=r.fields;Object.keys(n).forEach((function(r){var o=n[r];e.getAttribute(r)||e.addAttribute(t.buildAttribute(o),o.order)})),"string"==typeof r.validationCode&&(e.validationCode=d.Validator.compile(e,r.validationCode))},e.prototype.buildAttribute=function(e){var t=e.flags&&(-1!==e.flags.indexOf("METADATA")||-1!==e.flags.indexOf("READONLY")),r=e.name,n=e.type;if(0!==n.indexOf("/db/collection.")){var o=new c.SingularAttribute(r,this.getModel(n),t);return o.metadata=e.metadata,o}var i=n.substring(0,n.indexOf("[")),l=n.substring(n.indexOf("[")+1,n.indexOf("]")).trim();switch(i){case a.ListAttribute.ref:return new a.ListAttribute(r,this.getModel(l));case u.SetAttribute.ref:return new u.SetAttribute(r,this.getModel(l));case s.MapAttribute.ref:var d=l.substring(0,l.indexOf(",")).trim(),p=l.substring(l.indexOf(",")+1).trim();return new s.MapAttribute(r,this.getModel(d),this.getModel(p));default:throw new TypeError("No collection available for "+n)}},e}();t.ModelBuilder=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmbeddableType=void 0;var n=r(0),o=r(19),i=r(10),a=r(5),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"persistenceType",{get:function(){return i.PersistenceType.EMBEDDABLE},enumerable:!1,configurable:!0}),t.prototype.createProxyClass=function(){return this.enhancer.createProxy(a.Managed)},t.prototype.createObjectFactory=function(e){return a.ManagedFactory.create(this,e)},t.prototype.fromJsonValue=function(t,r,n,o){var i=n;return r&&(i instanceof this.typeConstructor||(i=this.create())),e.prototype.fromJsonValue.call(this,t,r,i,o)},t.prototype.toString=function(){return"EmbeddableType("+this.ref+")"},t}(o.ManagedType);t.EmbeddableType=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ListAttribute=void 0;var n=r(0),o=r(11),i=r(9),a=function(e){function t(t,r){return e.call(this,t,Array,r)||this}return n.__extends(t,e),Object.defineProperty(t,"ref",{get:function(){return"/db/collection.List"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collectionType",{get:function(){return o.CollectionType.LIST},enumerable:!1,configurable:!0}),t.prototype.getJsonValue=function(e,t,r){var n=this.getValue(t);if(!(n instanceof this.typeConstructor))return null;for(var o=n.length,a=new Array(o),s=i.Attribute.attachState(n),u=s||[],c=!s||s.length!==o,l=new Array(o),d=0;d<o;d+=1){var p=n[d];l[d]=this.elementType.toJsonValue(e,p,r),a[d]=p,c=c||u[d]!==p}return r.persisting&&i.Attribute.attachState(n,a,!0),c&&e.setDirty(),l},t.prototype.setJsonValue=function(e,t,r,n){var o=null;if(r){o=this.getValue(t);var a=r.length;o instanceof this.typeConstructor||(o=new this.typeConstructor(a));var s=new Array(a),u=i.Attribute.attachState(o)||[];a<o.length&&o.splice(a,o.length-a);for(var c=0;c<a;c+=1){var l=this.elementType.fromJsonValue(e,r[c],u[c],n);o[c]=l,s[c]=l}n.persisting&&i.Attribute.attachState(o,s,!0)}this.setValue(t,o)},t.prototype.toJSON=function(){return n.__assign({type:t.ref+"["+this.elementType.ref+"]"},e.prototype.toJSON.call(this))},t}(o.PluralAttribute);t.ListAttribute=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapAttribute=void 0;var n=r(0),o=r(11),i=r(9),a=r(4),s=function(e){function t(t,r,n){var o=e.call(this,t,Map,n)||this;return o.keyType=r,o}return n.__extends(t,e),Object.defineProperty(t,"ref",{get:function(){return"/db/collection.Map"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collectionType",{get:function(){return o.CollectionType.MAP},enumerable:!1,configurable:!0}),t.prototype.getJsonValue=function(e,t,r){var n=this.getValue(t);if(!(n instanceof this.typeConstructor))return null;for(var o={},s=i.Attribute.attachState(n)||{},u=i.Attribute.attachSize(n)!==n.size,c={},l=n.entries(),d=l.next();!d.done;d=l.next()){var p=d.value;if(null===p[0]||void 0===p[0])throw new a.PersistentError("Map keys can't be null nor undefined.");var f=this.keyValue(this.keyType.toJsonValue(e,p[0],r));c[f]=this.elementType.toJsonValue(e,p[1],r),o[f]=[p[0],p[1]],u=u||(s[f]||[])[1]!==p[1]}return r.persisting&&(i.Attribute.attachState(n,o,!0),i.Attribute.attachSize(n,n.size)),u&&e.setDirty(),c},t.prototype.setJsonValue=function(e,t,r,n){var o=null;if(r){(o=this.getValue(t))instanceof this.typeConstructor||(o=new this.typeConstructor);var a={},s=i.Attribute.attachState(o)||{};o.clear();for(var u=Object.keys(r),c=0,l=u.length;c<l;c+=1){var d=u[c],p=s[d]||[],f=this.keyType.fromJsonValue(e,d,p[0],n),h=this.elementType.fromJsonValue(e,r[d],p[1],n);a[d]=[f,h],o.set(f,h)}n.persisting&&(i.Attribute.attachState(o,a,!0),i.Attribute.attachSize(o,o.size))}this.setValue(t,o)},t.prototype.toJSON=function(){return n.__assign({type:t.ref+"["+this.keyType.ref+","+this.elementType.ref+"]"},e.prototype.toJSON.call(this))},t}(o.PluralAttribute);t.MapAttribute=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetAttribute=void 0;var n=r(0),o=r(11),i=r(9),a=function(e){function t(t,r){return e.call(this,t,Set,r)||this}return n.__extends(t,e),Object.defineProperty(t,"ref",{get:function(){return"/db/collection.Set"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collectionType",{get:function(){return o.CollectionType.SET},enumerable:!1,configurable:!0}),t.prototype.getJsonValue=function(e,t,r){var n=this.getValue(t);if(!(n instanceof this.typeConstructor))return null;for(var o={},a=i.Attribute.attachState(n)||{},s=i.Attribute.attachSize(n)!==n.size,u=[],c=n.values(),l=c.next();!l.done;l=c.next()){var d=l.value,p=this.elementType.toJsonValue(e,d,r);u.push(p);var f=this.keyValue(p);o[f]=d,s=s||a[f]!==d}return r.persisting&&(i.Attribute.attachState(n,o,!0),i.Attribute.attachSize(n,n.size)),s&&e.setDirty(),u},t.prototype.setJsonValue=function(e,t,r,n){var o=null;if(r){(o=this.getValue(t))instanceof this.typeConstructor||(o=new this.typeConstructor);var a={},s=i.Attribute.attachState(o)||{};o.clear();for(var u=0,c=r.length;u<c;u+=1){var l=r[u],d=this.keyValue(l),p=this.elementType.fromJsonValue(e,l,s[d],n);o.add(p),a[d]=p}n.persisting&&(i.Attribute.attachState(o,a,!0),i.Attribute.attachSize(o,o.size))}this.setValue(t,o)},t.prototype.toJSON=function(){return n.__assign({type:t.ref+"["+this.elementType.ref+"]"},e.prototype.toJSON.call(this))},t}(o.PluralAttribute);t.SetAttribute=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DbIndex=void 0;var n=function(){function e(t,r){if("string"==typeof t){var n={};n[t]=e.ASC,this.keys=[n]}else if(Array.isArray(t))this.keys=t;else{if(!t)throw new Error("The keys parameter must be an String, Object or Array.");this.keys=[t]}this.unique=!0===r}return e.fromJSON=function(t){return new e(t.keys,t.unique)},e.prototype.hasKey=function(e){for(var t=0;t<this.keys.length;t+=1)if(this.keys[t][e])return!0;return!1},Object.defineProperty(e.prototype,"isCompound",{get:function(){return this.keys.length>1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUnique",{get:function(){return this.unique},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{unique:this.unique,keys:this.keys}},e.ASC="asc",e.DESC="desc",e}();t.DbIndex=n},function(e,t,r){"use strict";t.a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},function(e,t,r){"use strict";function n(e){return 14+(e+64>>>9<<4)+1}function o(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function i(e,t,r,n,i,a){return o((s=o(o(t,e),o(n,a)))<<(u=i)|s>>>32-u,r);var s,u}function a(e,t,r,n,o,a,s){return i(t&r|~t&n,e,t,o,a,s)}function s(e,t,r,n,o,a,s){return i(t&n|r&~n,e,t,o,a,s)}function u(e,t,r,n,o,a,s){return i(t^r^n,e,t,o,a,s)}function c(e,t,r,n,o,a,s){return i(r^(t|~n),e,t,o,a,s)}t.a=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n=0;n<r;n+=8){var o=e[n>>5]>>>n%32&255,i=parseInt("0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;for(var r=1732584193,i=-271733879,l=-1732584194,d=271733878,p=0;p<e.length;p+=16){var f=r,h=i,y=l,b=d;r=a(r,i,l,d,e[p],7,-680876936),d=a(d,r,i,l,e[p+1],12,-389564586),l=a(l,d,r,i,e[p+2],17,606105819),i=a(i,l,d,r,e[p+3],22,-1044525330),r=a(r,i,l,d,e[p+4],7,-176418897),d=a(d,r,i,l,e[p+5],12,1200080426),l=a(l,d,r,i,e[p+6],17,-1473231341),i=a(i,l,d,r,e[p+7],22,-45705983),r=a(r,i,l,d,e[p+8],7,1770035416),d=a(d,r,i,l,e[p+9],12,-1958414417),l=a(l,d,r,i,e[p+10],17,-42063),i=a(i,l,d,r,e[p+11],22,-1990404162),r=a(r,i,l,d,e[p+12],7,1804603682),d=a(d,r,i,l,e[p+13],12,-40341101),l=a(l,d,r,i,e[p+14],17,-1502002290),i=a(i,l,d,r,e[p+15],22,1236535329),r=s(r,i,l,d,e[p+1],5,-165796510),d=s(d,r,i,l,e[p+6],9,-1069501632),l=s(l,d,r,i,e[p+11],14,643717713),i=s(i,l,d,r,e[p],20,-373897302),r=s(r,i,l,d,e[p+5],5,-701558691),d=s(d,r,i,l,e[p+10],9,38016083),l=s(l,d,r,i,e[p+15],14,-660478335),i=s(i,l,d,r,e[p+4],20,-405537848),r=s(r,i,l,d,e[p+9],5,568446438),d=s(d,r,i,l,e[p+14],9,-1019803690),l=s(l,d,r,i,e[p+3],14,-187363961),i=s(i,l,d,r,e[p+8],20,1163531501),r=s(r,i,l,d,e[p+13],5,-1444681467),d=s(d,r,i,l,e[p+2],9,-51403784),l=s(l,d,r,i,e[p+7],14,1735328473),i=s(i,l,d,r,e[p+12],20,-1926607734),r=u(r,i,l,d,e[p+5],4,-378558),d=u(d,r,i,l,e[p+8],11,-2022574463),l=u(l,d,r,i,e[p+11],16,1839030562),i=u(i,l,d,r,e[p+14],23,-35309556),r=u(r,i,l,d,e[p+1],4,-1530992060),d=u(d,r,i,l,e[p+4],11,1272893353),l=u(l,d,r,i,e[p+7],16,-155497632),i=u(i,l,d,r,e[p+10],23,-1094730640),r=u(r,i,l,d,e[p+13],4,681279174),d=u(d,r,i,l,e[p],11,-358537222),l=u(l,d,r,i,e[p+3],16,-722521979),i=u(i,l,d,r,e[p+6],23,76029189),r=u(r,i,l,d,e[p+9],4,-640364487),d=u(d,r,i,l,e[p+12],11,-421815835),l=u(l,d,r,i,e[p+15],16,530742520),i=u(i,l,d,r,e[p+2],23,-995338651),r=c(r,i,l,d,e[p],6,-198630844),d=c(d,r,i,l,e[p+7],10,1126891415),l=c(l,d,r,i,e[p+14],15,-1416354905),i=c(i,l,d,r,e[p+5],21,-57434055),r=c(r,i,l,d,e[p+12],6,1700485571),d=c(d,r,i,l,e[p+3],10,-1894986606),l=c(l,d,r,i,e[p+10],15,-1051523),i=c(i,l,d,r,e[p+1],21,-2054922799),r=c(r,i,l,d,e[p+8],6,1873313359),d=c(d,r,i,l,e[p+15],10,-30611744),l=c(l,d,r,i,e[p+6],15,-1560198380),i=c(i,l,d,r,e[p+13],21,1309151649),r=c(r,i,l,d,e[p+4],6,-145523070),d=c(d,r,i,l,e[p+11],10,-1120210379),l=c(l,d,r,i,e[p+2],15,718787259),i=c(i,l,d,r,e[p+9],21,-343485551),r=o(r,f),i=o(i,h),l=o(l,y),d=o(d,b)}return[r,i,l,d]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(n(t)),o=0;o<t;o+=8)r[o>>5]|=(255&e[o/8])<<o%32;return r}(e),8*e.length))}},function(e,t,r){"use strict";function n(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:return t^r^n;case 2:return t&r^t&n^r&n;case 3:return t^r^n}}function o(e,t){return e<<t|e>>>32-t}t.a=function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var i=unescape(encodeURIComponent(e));e=[];for(var a=0;a<i.length;++a)e.push(i.charCodeAt(a))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,u=Math.ceil(s/16),c=new Array(u),l=0;l<u;++l){for(var d=new Uint32Array(16),p=0;p<16;++p)d[p]=e[64*l+4*p]<<24|e[64*l+4*p+1]<<16|e[64*l+4*p+2]<<8|e[64*l+4*p+3];c[l]=d}c[u-1][14]=8*(e.length-1)/Math.pow(2,32),c[u-1][14]=Math.floor(c[u-1][14]),c[u-1][15]=8*(e.length-1)&4294967295;for(var f=0;f<u;++f){for(var h=new Uint32Array(80),y=0;y<16;++y)h[y]=c[f][y];for(var b=16;b<80;++b)h[b]=o(h[b-3]^h[b-8]^h[b-14]^h[b-16],1);for(var g=r[0],m=r[1],v=r[2],O=r[3],_=r[4],w=0;w<80;++w){var P=Math.floor(w/20),E=o(g,5)+n(P,m,v,O)+_+t[P]+h[w]>>>0;_=O,O=v,v=o(m,30)>>>0,m=g,g=E}r[0]=r[0]+g>>>0,r[1]=r[1]+m>>>0,r[2]=r[2]+v>>>0,r[3]=r[3]+O>>>0,r[4]=r[4]+_>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Map=t.List=t.Set=void 0;var a=r(14);t.binding=i(r(5)),t.connector=i(r(6)),t.error=i(r(4)),t.message=i(r(2)),t.metamodel=i(r(13)),t.util=i(r(3)),t.intersection=i(r(1)),t.caching=i(r(32)),t.query=i(r(34)),t.partialupdate=i(r(31)),t.model=i(r(106));var s=r(23);Object.defineProperty(t,"EntityManagerFactory",{enumerable:!0,get:function(){return s.EntityManagerFactory}});var u=r(24);Object.defineProperty(t,"EntityManager",{enumerable:!0,get:function(){return u.EntityManager}});var c=r(15);Object.defineProperty(t,"Acl",{enumerable:!0,get:function(){return c.Acl}});var l=r(33);Object.defineProperty(t,"GeoPoint",{enumerable:!0,get:function(){return l.GeoPoint}});var d=r(14);Object.defineProperty(t,"db",{enumerable:!0,get:function(){return d.db}});var p=r(107);Object.defineProperty(t,"connect",{enumerable:!0,get:function(){return p.connect}}),Object.defineProperty(t,"configure",{enumerable:!0,get:function(){return p.configure}});var f=Set;t.Set=f;var h=Map;t.Map=h;var y=Array;t.List=y,t.default=a.db},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthMessages=t.Message=t.StatusCode=void 0;var n=r(0),o=r(4),i="undefined"==typeof navigator||"undefined"!=typeof chrome&&/google/i.test(navigator.vendor)||/cros i686/i.test(navigator.platform);t.StatusCode={NOT_MODIFIED:304,BAD_CREDENTIALS:460,BUCKET_NOT_FOUND:461,INVALID_PERMISSION_MODIFICATION:462,INVALID_TYPE_VALUE:463,OBJECT_NOT_FOUND:404,OBJECT_OUT_OF_DATE:412,PERMISSION_DENIED:466,QUERY_DISPOSED:467,QUERY_NOT_SUPPORTED:468,SCHEMA_NOT_COMPATIBLE:469,SCHEMA_STILL_EXISTS:470,SYNTAX_ERROR:471,TRANSACTION_INACTIVE:472,TYPE_ALREADY_EXISTS:473,TYPE_STILL_REFERENCED:474,SCRIPT_ABORTION:475};var a=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.withCredentials=!1,this.progressCallback=null,this._tokenStorage=null,this._responseType=null;for(var r=0,n=this.spec.path[0],o=this.spec.path.length,i=1;i<o;i+=1)this.spec.dynamic&&o-1===i?n+=e[r].split("/").map(encodeURIComponent).join("/"):n+=encodeURIComponent(e[r])+this.spec.path[i],r+=1;var a="";for(i=0;i<this.spec.query.length;i+=1){var s=e[r];r+=1,null!=s&&(a+=a||-1!==n.indexOf("?")?"&":"?",a+=this.spec.query[i]+"="+encodeURIComponent(s))}this.request={method:this.spec.method,path:n+a,entity:null,headers:{}},e[r]&&this.entity(e[r],"json"),this.responseType("json")}return Object.defineProperty(e.prototype,"spec",{get:function(){return null},enumerable:!1,configurable:!0}),e.create=function(t){var r=t.path.split("?"),o=r[0].split(/[:*]\w*/),i=[];r[1]&&r[1].split("&").forEach((function(e){var t=e.split("=");i.push(t[0])}));var a={path:o,query:i,status:t.status,method:t.method,dynamic:-1!==t.path.indexOf("*")};return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"spec",{get:function(){return a},enumerable:!1,configurable:!0}),t}(e)},e.createExternal=function(t,r){var o=t.path,i=n.__rest(t,["path"]),a=n.__assign({dynamic:!1,path:[o]},i),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"spec",{get:function(){return a},enumerable:!1,configurable:!0}),t}(e);return Object.assign(s.prototype,r),s},Object.defineProperty(e.prototype,"isBinary",{get:function(){return this.request.type&&this.request.type in e.BINARY||this._responseType in e.BINARY},enumerable:!1,configurable:!0}),e.prototype.tokenStorage=function(e){return void 0===e?this._tokenStorage:(this._tokenStorage=e,this)},e.prototype.path=function(e){if(void 0!==e){var t=this.request.path.indexOf("?")+1;return this.request.path=e+(t>0?(e.indexOf("?")>-1?"&":"?")+this.request.path.substring(t):""),this}return this.request.path},e.prototype.header=function(e,t){return null===t?(delete this.request.headers[e],this):void 0!==t?(this.request.headers[e]=t,this):this.request.headers[e]},e.prototype.entity=function(e,t){var r=t;return r||(r="string"==typeof e?/^data:(.+?)(;base64)?,.*$/.test(e)?"data-url":"text":"undefined"!=typeof Blob&&e instanceof Blob?"blob":"undefined"!=typeof Buffer&&e instanceof Buffer?"buffer":"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?"arraybuffer":"undefined"!=typeof FormData&&e instanceof FormData?"form":"json"),this.request.type=r,this.request.entity=e,this},e.prototype.mimeType=function(e){return this.header("content-type",e)},e.prototype.contentLength=function(e){return void 0!==e?this.header("content-length",""+e):Number(this.header("content-length"))},e.prototype.ifMatch=function(e){return this.header("If-Match",this.formatETag(e))},e.prototype.ifNoneMatch=function(e){return this.header("If-None-Match",this.formatETag(e))},e.prototype.ifUnmodifiedSince=function(e){return this.header("if-unmodified-since",e&&e.toUTCString().replace("UTC","GMT"))},e.prototype.noCache=function(){return i||this.ifMatch("").ifNoneMatch("-"),this.cacheControl("max-age=0, no-cache")},e.prototype.cacheControl=function(e){return this.header("cache-control",e)},e.prototype.acl=function(e){return this.header("baqend-acl",e&&JSON.stringify(e))},e.prototype.customHeaders=function(e){return this.header("baqend-custom-headers",e&&JSON.stringify(e))},e.prototype.accept=function(e){return this.header("accept",e)},e.prototype.responseType=function(e){return void 0!==e?(this._responseType=e,this):this._responseType},e.prototype.progress=function(e){return void 0!==e?(this.progressCallback=e,this):this.progressCallback},e.prototype.addQueryString=function(e){var t=this;if("string"==typeof e)return this.request.path+=e,this;if(e){var r=this.request.path.indexOf("?")>=0?"&":"?";Object.keys(e).forEach((function(n){t.request.path+=r+n+"="+encodeURIComponent(e[n]),r="&"}))}return this},e.prototype.formatETag=function(e){if(null==e||"*"===e)return e;var t=""+e;return-1===t.indexOf('"')&&(t='"'+t+'"'),t},e.prototype.doReceive=function(e){if(-1===this.spec.status.indexOf(e.status))throw new o.CommunicationError(this,e)},e.StatusCode=t.StatusCode,e.BINARY={blob:!0,buffer:!0,stream:!0,arraybuffer:!0,"data-url":!0,base64:!0},e}();t.Message=a,t.OAuthMessages={Google:a.createExternal({method:"OAUTH",path:"https://accounts.google.com/o/oauth2/auth?response_type=code&access_type=online",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin:function(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/google"})}}),Facebook:a.createExternal({method:"OAUTH",path:"https://www.facebook.com/v7.0/dialog/oauth?response_type=code",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin:function(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/facebook"})}}),GitHub:a.createExternal({method:"OAUTH",path:"https://github.com/login/oauth/authorize?response_type=code&access_type=online",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin:function(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/github"})}}),LinkedIn:a.createExternal({method:"OAUTH",path:"https://www.linkedin.com/oauth/v2/authorization?response_type=code",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin:function(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/linkedin"})}}),Twitter:a.createExternal({method:"OAUTH",path:"",query:[],status:[200]},{addRedirectOrigin:function(e){this.request.path=e+"/db/User/OAuth1/twitter"}}),Salesforce:a.createExternal({method:"OAUTH",path:"",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin:function(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/salesforce"})}})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommunicationError=void 0;var n=r(0),o=function(e){function t(t,r){var n=this,o=r.entity||r.error||{},i=0===r.status?"Request":"Response",a=o.message||t&&"Handling the "+i+" for "+t.request.method+" "+t.request.path||"A communication error occurred.";(n=e.call(this,a,o)||this).name=o.className||"CommunicationError",n.reason=o.reason||"Communication failed",n.status=r.status,o.data&&(n.data=o.data);for(var s=o;s&&s.stackTrace;){n.stack+="\nServerside Caused by: "+s.className+" "+s.message;for(var u=s.stackTrace,c=0;c<u.length;c+=1){var l=u[c];n.stack+="\n    at "+l.className+"."+l.methodName,n.stack+=" ("+l.fileName+":"+l.lineNumber+")"}s=s.cause}return n}return n.__extends(t,e),t}(r(12).PersistentError);t.CommunicationError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IllegalEntityError=void 0;var n=r(0),o=function(e){function t(t){var r=e.call(this,"Entity "+t+" is not a valid entity")||this;return r.entity=t,r}return n.__extends(t,e),t}(r(12).PersistentError);t.IllegalEntityError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntityExistsError=void 0;var n=r(0),o=function(e){function t(t){var r=e.call(this,"The entity "+t+" is managed by a different db.")||this;return r.entity=t,r}return n.__extends(t,e),t}(r(12).PersistentError);t.EntityExistsError=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RollbackError=void 0;var n=r(0),o=function(e){function t(t){return e.call(this,"The transaction has been roll backed",t)||this}return n.__extends(t,e),t}(r(12).PersistentError);t.RollbackError=o},function(e,t){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=void 0,t.isNode=!1},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.atob=void 0,t.atob=window.atob.bind(window)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hmac=void 0,t.hmac=function(e,t){var r=new TextEncoder;return Promise.resolve(crypto.subtle.importKey("raw",r.encode(t),{name:"HMAC",hash:{name:"SHA-1"}},!1,["sign","verify"])).then((function(t){return crypto.subtle.sign("HMAC",t,r.encode(e))})).then((function(e){return new Uint8Array(e).reduce((function(e,t){return e+t.toString(16).padStart(2,"0")}),"")}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lockable=void 0;var n=function(){function e(){this.isLocked=!1,this.readyPromise=Promise.resolve(this)}return Object.defineProperty(e.prototype,"isReady",{get:function(){return!this.isLocked},enumerable:!1,configurable:!0}),e.prototype.ready=function(e,t){return this.readyPromise.then(e,t)},e.prototype.withLock=function(e,t){var r=this;if(void 0===t&&(t=!1),this.isLocked)throw new Error("Current operation has not been finished.");try{this.isLocked=!0;var n=e().then((function(e){return r.isLocked=!1,e}),(function(e){throw t||(r.isLocked=!1),e}));return this.readyPromise=n.then((function(){return r}),(function(e){if(!t)return r;throw e})),n}catch(e){throw t?this.readyPromise=Promise.reject(e):this.isLocked=!1,e}},e}();t.Lockable=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuid=void 0;var n=r(78).v4;t.uuid=n},function(e,t,r){"use strict";r.r(t);var n=r(40);r.d(t,"v1",(function(){return n.a}));var o=r(41);r.d(t,"v3",(function(){return o.a}));var i=r(42);r.d(t,"v4",(function(){return i.a}));var a=r(43);r.d(t,"v5",(function(){return a.a}));var s=r(44);r.d(t,"NIL",(function(){return s.a}));var u=r(45);r.d(t,"version",(function(){return u.a}));var c=r(8);r.d(t,"validate",(function(){return c.a}));var l=r(7);r.d(t,"stringify",(function(){return l.a}));var d=r(20);r.d(t,"parse",(function(){return d.a}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deprecated=void 0;var n={};t.deprecated=function(e){return function(t,r,o){void 0===o&&(o={writable:!0,enumerable:!1,configurable:!0});var i=("string"==typeof t?t:t.constructor.name)+"."+r,a=function(){n[i]||(n[i]=!0,console.warn("Usage of "+i+" is deprecated, use "+e+" instead."))},s={enumerable:o.enumerable,configurable:o.configurable};if(o.get||o.set)o.get&&(s.get=function(){return a(),o.get.call(this)}),o.set&&(s.set=function(e){return a(),o.set.call(this,e)});else{var u=o.value;s.get=function(){return a(),u},o.writable&&(s.set=function(e){a(),u=e})}return s}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trailingSlashIt=void 0,t.trailingSlashIt=function(e){return"/"!==e.charAt(e.length-1)?e+"/":e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFrameConnector=void 0;var n=r(0),o=r(25),i=function(e){function t(t,r,n,o){var i=e.call(this,t,r,n,o)||this;return i.queue=null,i.connected=!1,i.mid=0,i.messages={},i.doReceive=i.doReceive.bind(i),addEventListener("message",i.doReceive,!1),i}return n.__extends(t,e),t.isUsable=function(e,t,r){if("undefined"==typeof location||"undefined"==typeof document)return!1;var n="https:"===location.protocol,o=location.port||(n?443:80);return location.hostname!==e||o!==t||n!==r},t.prototype.load=function(e){this.iframe=document.createElement("iframe"),this.iframe.src=this.origin+this.basePath+e,this.iframe.setAttribute("style",t.style),document.body.appendChild(this.iframe),this.queue=[],this.iframe.addEventListener("load",this.onLoad.bind(this),!1)},t.prototype.onLoad=function(){if(this.queue){for(var e=this.queue,t=0;t<e.length;t+=1)this.postMessage(e[t]);this.queue=null}},t.prototype.doSend=function(t,r,n){var i=this;if(t.isBinary)e.prototype.doSend.call(this,t,r,n);else{this.iframe||(this.load(t.request.path),t.request.path="/connect");var a={mid:this.mid+=1,method:r.method,path:r.path,headers:r.headers,entity:r.entity,responseHeaders:o.Connector.RESPONSE_HEADERS};this.messages[a.mid]=n;var s=JSON.stringify(a);this.queue?this.queue.push(s):this.postMessage(s),this.connected||setTimeout((function(){i.messages[a.mid]&&(delete i.messages[a.mid],n({status:0,error:new Error("Connection refused."),headers:{}}))}),1e4)}},t.prototype.postMessage=function(e){this.iframe.contentWindow.postMessage(e,this.origin)},t.prototype.doReceive=function(e){if(e.origin===this.origin&&"{"===e.data[0]){var t=JSON.parse(e.data),r=this.messages[t.mid];r&&(delete this.messages[t.mid],this.connected=!0,r({status:t.status,headers:t.headers,entity:t.entity}))}},t.style="width:1px;height:1px;position:absolute;top:-10px;left:-10px;",t}(r(39).XMLHttpConnector);t.IFrameConnector=i,o.Connector.connectors.push(i)},function(e,t){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketConnector=void 0;var n=r(0),o=r(4),i=r(84),a=r(46),s=function(){function e(e){this.observers={},this.socket=null,this.url=e}return e.create=function(t){var r=this.websockets[t];return r||(r=new e(t),this.websockets[t]=r),r},e.prototype.open=function(){var e=this;if(!this.socket){var t,r=new i.WebSocket(this.url),a=function(i){var a=!1;e.socket===t&&(a=3!==r.readyState,e.socket=null);var s=null;if(Object.keys(e.observers).forEach((function(t){var r=e.observers[t];if(delete e.observers[t],r)try{a?r.error(new o.CommunicationError(null,n.__assign({status:0,headers:{}},i instanceof Error&&{error:i}))):r.complete()}catch(e){s||(s=e)}})),s)throw s};r.onerror=a,r.onclose=a,r.onmessage=function(t){var r=JSON.parse(t.data);r.date=new Date(r.date);var n=r.id;if(n){var i=e.observers[n];i&&("error"===r.type?i.error(new o.CommunicationError(null,r)):i.next(r))}else"error"===r.type&&a(r)},t=new Promise((function(e){r.onopen=e})).then((function(){return r})),this.socket=t}return this.socket},e.prototype.close=function(){this.socket&&(this.socket.then((function(e){e.close()})),this.socket=null)},e.prototype.openStream=function(e,t){var r=this,o=new a.Observable((function(e){if(r.observers[t])throw new Error("Only one subscription per stream is allowed.");return r.observers[t]=e,function(){r.observers[t]===e&&delete r.observers[t]}}));return Object.assign(o,{send:function(o){r.open().then((function(r){var i=JSON.stringify(n.__assign(n.__assign({id:t},o),e.token&&{token:e.token}));r.send(i)}))}}),o},e.websockets={},e}();t.WebSocketConnector=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocket=void 0,t.WebSocket=window.WebSocket},function(t,r){if(void 0===e){var n=new Error("Cannot find module 'rxjs'");throw n.code="MODULE_NOT_FOUND",n}t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Accessor=void 0;var n=function(){function e(){}return e.prototype.getValue=function(e,t){return e[t.name]},e.prototype.setValue=function(e,t,r){e[t.name]=r},e}();t.Accessor=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=t.MetadataState=void 0;var n,o=r(0),i=r(15),a=r(3),s=r(4);!function(e){e[e.UNAVAILABLE=-1]="UNAVAILABLE",e[e.PERSISTENT=0]="PERSISTENT",e[e.DIRTY=1]="DIRTY"}(n=t.MetadataState||(t.MetadataState={}));var u=function(e){function t(t){var r=e.call(this)||this;return r.entityManager=null,r.decodedKey=null,r.id=null,r.state=n.DIRTY,r.enabled=!0,r.id=null,r.version=null,r.type=t,r.acl=new i.Acl,r}return o.__extends(t,e),t.create=function(e,r){if(e.isEntity)return new t(e);if(e.isEmbeddable)return{type:e,db:r,setDirty:function(){}};throw new Error("Illegal type "+e)},t.get=function(e){return e._metadata},Object.defineProperty(t.prototype,"db",{get:function(){return this.entityManager||(this.entityManager=r(14).db),this.entityManager},set:function(e){if(this.entityManager)throw new Error("DB has already been set.");this.entityManager=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.type.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){if(!this.decodedKey&&this.id){var e=this.id.lastIndexOf("/");this.decodedKey=decodeURIComponent(this.id.substring(e+1))}return this.decodedKey},set:function(e){var t=""+e;if(this.id)throw new Error("The id can't be set twice.");this.id="/db/"+this.bucket+"/"+encodeURIComponent(t),this.decodedKey=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAttached",{get:function(){return!!this.entityManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAvailable",{get:function(){return this.state>n.UNAVAILABLE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPersistent",{get:function(){return this.state===n.PERSISTENT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDirty",{get:function(){return this.state===n.DIRTY},enumerable:!1,configurable:!0}),t.prototype.enable=function(e){this.enabled=e},t.prototype.throwUnloadedPropertyAccess=function(e){if(this.enabled&&!this.isAvailable)throw new s.PersistentError("Illegal property access on "+this.id+"#"+e+" , ensure that this reference is loaded before it's properties are accessed.")},t.prototype.setUnavailable=function(){this.state=n.UNAVAILABLE},t.prototype.setPersistent=function(){this.state=n.PERSISTENT},t.prototype.setDirty=function(){this.state=n.DIRTY},t.prototype.setRemoved=function(){this.isAvailable&&(this.setDirty(),this.version=null)},t}(a.Lockable);t.Metadata=u},function(e,r){if(void 0===t){var n=new Error("Cannot find module 'validator'");throw n.code="MODULE_NOT_FOUND",n}e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationResult=void 0;var n=function(){function e(){this.fields={}}return Object.defineProperty(e.prototype,"isValid",{get:function(){var e=this;return Object.keys(this.fields).every((function(t){return e.fields[t].isValid}))},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){var e=this,t={};return Object.keys(this.fields).forEach((function(r){t[r]=e.fields[r].toJSON()})),t},e}();t.ValidationResult=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Code=void 0;var n=r(0).__importStar(r(2)),o=r(6),i=r(49),a=function(){function e(e,t){this.metamodel=e,this.entityManagerFactory=t}return e.prototype.functionToString=function(e){if(!e)return"";var t=e.toString();return"\n"===(t=t.substring(t.indexOf("{")+1,t.lastIndexOf("}"))).charAt(0)&&(t=t.substring(1)),"\n"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t},e.prototype.stringToFunction=function(e,t){return new Function(e,t)},e.prototype.loadModules=function(){var e=new n.GetAllModules;return this.entityManagerFactory.send(e).then((function(e){return e.entity}))},e.prototype.loadCode=function(e,t,r){var i=this;void 0===r&&(r=!1);var a="string"==typeof e?e:e.name,s=new n.GetBaqendCode(a,t).responseType("text");return this.entityManagerFactory.send(s).then((function(e){return i.parseCode(a,t,r,e.entity)}),(function(e){if(e.status===o.StatusCode.OBJECT_NOT_FOUND)return null;throw e}))},e.prototype.saveCode=function(e,t,r){var o=this,i="string"==typeof e?e:e.name,a=new n.SetBaqendCode(i,t).entity(r instanceof Function?this.functionToString(r):r,"text").responseType("text");return this.entityManagerFactory.send(a).then((function(e){return o.parseCode(i,t,r instanceof Function,e.entity)}))},e.prototype.deleteCode=function(e,t){var r=this,o="string"==typeof e?e:e.name,i=new n.DeleteBaqendCode(o,t);return this.entityManagerFactory.send(i).then((function(){return r.parseCode(o,t,!1,null)}))},e.prototype.parseCode=function(e,t,r,n){if("validate"===t){var o=this.metamodel.entity(e);return o.validationCode=null===n?null:i.Validator.compile(o,n),r?o.validationCode:n}return n&&r?this.stringToFunction(["module","exports"],n):n},e}();t.Code=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Modules=void 0;var n=r(0).__importStar(r(2)),o=function(){function e(e){this.entityManager=e}return e.prototype.get=function(e,t,r,o,i){if(t instanceof Function)return this.get(e,{},t,r,o);if(r instanceof Function)return this.get(e,t,{},r,o);var a=r||{},s=new n.GetBaqendModule(e).addQueryString(t||"").responseType(a.responseType||null);return this.send(s,o,i)},e.prototype.post=function(e,t,r,o,i){if("function"==typeof r)return this.post(e,t,{},r,o);var a=r||{},s=new n.PostBaqendModule(e).entity(t,a.requestType).mimeType(a.mimeType||null).responseType(a.responseType||null);return this.send(s,o,i)},e.prototype.send=function(e,t,r){return this.entityManager.send(e).then((function(e){return e.entity})).then(t,r)},e}();t.Modules=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;var n=r(0),o=n.__importStar(r(2)),i=function(){function e(){this.entityManager=null,this.levelIndex=2}return e.create=function(e){var t=this.prototype,r=function(){function e(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];t.log.apply(e,r)}return Object.getOwnPropertyNames(t).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}();return r.init(e),r},Object.defineProperty(e.prototype,"level",{get:function(){return e.LEVELS[this.levelIndex]},set:function(t){var r=e.LEVELS.indexOf(t);if(-1===r)throw new Error("Unknown logging level "+t);this.levelIndex=r},enumerable:!1,configurable:!0}),e.prototype.log=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=-1===e.LEVELS.indexOf(t[0])?"info":t.shift();if(this.levelIndex>e.LEVELS.indexOf(o))return Promise.resolve(null);var i="string"==typeof t[0]?this.format(t.shift(),t):"[no message]",a=null;if(t.length){var s=t.pop();if(a=s,("object"!=typeof s||Array.isArray(s))&&(a={data:s}),s instanceof Error){var u=s.stack,c=s.data,l=s.message,d=s.name,p=s.status;a={name:d,message:l,stack:u,status:p,data:c}}}return t.length&&(i+=", "+t.join(", ")),this.logJSON(n.__assign({date:(new Date).toISOString(),message:i,level:o,data:a},this.entityManager.me&&{user:this.entityManager.me.id}))},e.prototype.format=function(t,r){return 0===r.length?t:String(t).replace(e.FORMAT_REGEXP,(function(e){if("%%"===e)return"%";if(!r.length)return e;switch(e){case"%s":return String(r.shift());case"%d":return String(Number(r.shift()));case"%j":try{return JSON.stringify(r.shift())}catch(e){return"[Circular]"}default:return e}}))},e.prototype.init=function(t){var r=this;this.entityManager=t,this.levelIndex=2,e.LEVELS.forEach((function(e){r[e]=r.log.bind(r,e)}))},e.prototype.logJSON=function(e){return this.entityManager.isReady?this.entityManager.send(new o.CreateObject("logs.AppLog",e)):this.entityManager.ready(this.logJSON.bind(this,e))},e.LEVELS=["trace","debug","info","warn","error"],e.FORMAT_REGEXP=/%[sdj%]/g,e}();t.Logger=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PushMessage=void 0;var n=r(5),o=function(){function e(t,r,n,o,i,a){var s="string"==typeof o?{sound:o,badge:i,data:a}:o||{};this.devices=e.initDevices(t),this.message=r,this.subject=n,Object.assign(this,s)}return e.initDevices=function(e){if(e instanceof Set)return e;if(e instanceof n.Entity)return new Set([e]);if(!e||e[Symbol.iterator])return new Set(e);throw new Error("Only Sets, Lists and Arrays can be used as devices.")},e.prototype.addDevice=function(e){this.devices.add(e)},e.prototype.toJSON=function(){if(!this.devices||!this.devices.size)throw new Error("Set of devices is empty.");return Object.assign({},this,{devices:Array.from(this.devices,(function(e){return e.id}))})},e}();t.PushMessage=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalStorage=void 0;var n=r(0),o=r(28),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.create=function(e){return Promise.resolve(new t(e,t.tokens[e]))},t.prototype.saveToken=function(e,r,n){n||(r?t.tokens[e]=r:delete t.tokens[e])},t.tokens={},t}(o.TokenStorage);t.GlobalStorage=i,o.TokenStorage.GLOBAL=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebStorage=void 0;var n=r(0),o=r(28),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.isAvailable=function(){try{return"undefined"!=typeof localStorage&&(localStorage.setItem("bq_webstorage_test","bq"),localStorage.removeItem("bq_webstorage_test"),!0)}catch(e){return!1}},t.create=function(e){var r=!1,n=localStorage.getItem("BAT:"+e);return n||"undefined"==typeof sessionStorage||(r=!!(n=sessionStorage.getItem("BAT:"+e))),Promise.resolve(new t(e,n,r))},t.prototype.saveToken=function(e,t,r){var n=r?sessionStorage:localStorage;t?n.setItem("BAT:"+e,t):n.removeItem("BAT:"+e)},t}(o.TokenStorage);t.WebStorage=i,i.isAvailable()&&(o.TokenStorage.WEB_STORAGE=i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserFactory=t.LoginOption=void 0;var n,o=r(0),i=r(29);!function(e){e[e.NO_LOGIN=-1]="NO_LOGIN",e[e.SESSION_LOGIN=0]="SESSION_LOGIN",e[e.PERSIST_LOGIN=1]="PERSIST_LOGIN"}(n=t.LoginOption||(t.LoginOption={}));var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),Object.defineProperty(t.prototype,"LoginOption",{get:function(){return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"me",{get:function(){return this.db.me},enumerable:!1,configurable:!0}),t.prototype.register=function(e,t,r,n,o){if(r instanceof Function)return this.register(e,t,!0,r,n);var i="string"==typeof e?this.fromJSON({username:e}):e;return this.db.register(i,t,void 0===r||r).then(n,o)},t.prototype.login=function(e,t,r,n,o){return r instanceof Function?this.login(e,t,!0,r,n):this.db.login(e,t,void 0===r||r).then(n,o)},t.prototype.loginWithToken=function(e,t,r,n){return t instanceof Function?this.loginWithToken(e,!0,t,r):(this.db.token=e,this.db.renew(t).then(r,n))},t.prototype.logout=function(e,t){return this.db.logout().then(e,t)},t.prototype.newPassword=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if("string"==typeof e[2]){var r=e,n=r[0],o=r[1],i=r[2],a=r[3],s=r[4];return this.db.newPassword(n,o,i).then(a,s)}var u=e,c=u[0],l=u[1],d=u[2],p=u[3],f=u[4];return d instanceof Function&&(f=p,p=d,d=!0),this.db.newPasswordWithToken(c,l,d).then(p,f)},t.prototype.resetPassword=function(e,t,r){return this.db.resetPassword(e).then(t,r)},t.prototype.changeUsername=function(e,t,r,n,o){return this.db.changeUsername(e,t,r).then(n,o)},t.prototype.requestAPIToken=function(e,t,r){return this.db.requestAPIToken(this.managedType.typeConstructor,e).then(t,r)},t.prototype.revokeAllTokens=function(e,t,r){return this.db.revokeAllTokens(this.managedType.typeConstructor,e).then(t,r)},t.DefaultOptions={google:{width:585,height:545,scope:"email"},facebook:{width:1140,height:640,scope:"email"},github:{width:1040,height:580,scope:"user:email"},twitter:{width:740,height:730},linkedin:{width:630,height:530,scope:"r_liteprofile"},salesforce:{width:585,height:545,scope:"email"}},t}(i.EntityFactory);t.UserFactory=a,["Google","Facebook","GitHub","Twitter","LinkedIn","Salesforce"].forEach((function(e){var t="loginWith"+e;a.prototype[t]=function(r,n,i,s){if(n instanceof Function)return this[t](r,{},n,i);var u=o.__assign(o.__assign({},a.DefaultOptions[e.toLowerCase()]),n||{});return this.db.loginWithOAuth(e,r,u).then(i,s)}}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceFactory=void 0;var n=r(0),o=n.__importStar(r(2)),i=r(1),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"PushMessage",{get:function(){return i.PushMessage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"me",{get:function(){return this.db.deviceMe},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRegistered",{get:function(){return this.db.isDeviceRegistered},enumerable:!1,configurable:!0}),t.prototype.loadWebPushKey=function(){var e=new o.VAPIDPublicKey;return e.responseType("arraybuffer"),this.db.send(e).then((function(e){return e.entity}))},t.prototype.register=function(e,t,r,n,o){if(r instanceof Function)return this.register(e,t,null,r,n);var i="string"==typeof t?{token:t}:t;return this.db.registerDevice(e,i,r).then(n,o)},t.prototype.push=function(e,t,r){return this.db.pushDevice(e).then(t,r)},t}(r(29).EntityFactory);t.DeviceFactory=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileFactory=void 0;var n=r(0),o=r(27),i=r(50),a=n.__importStar(r(2)),s=r(3),u=r(6),c=r(1),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.db=null,t}return n.__extends(t,e),t.create=function(e){var t=this.createFactory(i.File);return t.db=e,t},t.prototype.newInstance=function(t){var r=e.prototype.newInstance.call(this,t);return r.db=this.db,r},t.prototype.fromJSON=function(e){var t=this.newInstance([e.id]);return t.fromJSON(e),t},t.prototype.saveMetadata=function(e,t,r,n){var o=new a.SetFileBucketMetadata(e,t);return this.db.send(o).then(r,n)},t.prototype.loadMetadata=function(e,t,r,n){var o=new a.GetFileBucketMetadata(e);return this.db.send(o).then((function(e){var t={};return c.Permission.BASE_PERMISSIONS.forEach((function(r){t[r]=c.Permission.fromJSON(e.entity[r]||{})})),t}),(function(e){if(e.status===u.StatusCode.OBJECT_NOT_FOUND)return null;throw e})).then(r,n)},t.prototype.listBuckets=function(e,t){var r=this;return this.db.send(new a.ListBuckets).then((function(e){return e.entity.map((function(e){return r.new(e+"/")}))})).then(e,t)},t.prototype.listFiles=function(e,t,r,n,o){var i,u=this;if("string"==typeof e){var c=s.trailingSlashIt(e);i=this.new({path:c})}else i=e;var l=i.key,d=i.bucket;return this.db.send(new a.ListFiles(d,l,t?t.key:void 0,r)).then((function(e){return e.entity.map((function(e){return u.new(e)}))})).then(n,o)},t}(o.Factory);t.FileFactory=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntityPartialUpdateBuilder=void 0;var n=r(0),o=r(52),i=n.__importStar(r(2)),a=r(1),s=function(e){function t(t,r){var n=e.call(this,r)||this;return n.entity=t,n}return n.__extends(t,e),t.prototype.execute=function(){var e=this,t=a.Metadata.get(this.entity),r=JSON.stringify(this),n=new i.UpdatePartially(t.bucket,t.key,r);return t.withLock((function(){return t.db.send(n).then((function(r){return t.type.fromJsonValue(t,r.entity,e.entity,{persisting:!0}),e.entity}))}))},t}(o.PartialUpdateBuilder);t.EntityPartialUpdateBuilder=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateOperation=void 0;var n=function(e,t,r){this.name=e,this.path=t,this.value=r};t.UpdateOperation=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Role=void 0;var n=r(0),o=r(53),i=r(30),a=r(16),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.users=null,t.name=null,t}return n.__extends(t,e),t.prototype.hasUser=function(e){return!!this.users&&this.users.has(e)},t.prototype.addUser=function(e){if(!(e instanceof o.User))throw new Error("Only user instances can be added to a role.");this.users||(this.users=new Set),this.users.add(e)},t.prototype.removeUser=function(e){if(!(e instanceof o.User))throw new Error("Only user instances can be removed from a role.");this.users&&this.users.delete(e)},n.__decorate([a.enumerable(!1)],t.prototype,"hasUser",null),n.__decorate([a.enumerable(!1)],t.prototype,"addUser",null),n.__decorate([a.enumerable(!1)],t.prototype,"removeUser",null),t}(i.Entity);t.Role=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloomFilter=void 0;var n=r(3),o=function(){function e(e){this.bytes=n.atob(e.b),this.bits=e.m,this.hashes=e.h,this.creation=Date.now()}return e.prototype.contains=function(t){for(var r=e.getHashes(t,this.bits,this.hashes),n=0,o=r.length;n<o;n+=1)if(!this.isSet(r[n]))return!1;return!0},e.prototype.isSet=function(e){var t=Math.floor(e/8),r=1<<e%8;return 0!=(this.bytes.charCodeAt(t)&r)},e.getHashes=function(t,r,n){for(var o=new Array(n),i=e.murmur3(0,t),a=e.murmur3(i,t),s=0;s<n;s+=1)o[s]=(i+s*a)%r;return o},e.murmur3=function(e,t){var r,n,o,i,a=3&t.length,s=t.length-a,u=3432918353,c=461845907;for(r=e,i=0;i<s;)o=255&t.charCodeAt(i)|(255&t.charCodeAt(i+=1))<<8|(255&t.charCodeAt(i+=1))<<16|(255&t.charCodeAt(i+=1))<<24,i+=1,r=27492+(65535&(n=5*(65535&(r=(r^=o=(65535&(o=(o=(65535&o)*u+(((o>>>16)*u&65535)<<16)&4294967295)<<15|o>>>17))*c+(((o>>>16)*c&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(n>>>16)&65535)<<16);switch(o=0,a){case 3:o^=(255&t.charCodeAt(i+2))<<16;case 2:o^=(255&t.charCodeAt(i+1))<<8;case 1:r^=o=(65535&(o=(o=(65535&(o^=255&t.charCodeAt(i)))*u+(((o>>>16)*u&65535)<<16)&4294967295)<<15|o>>>17))*c+(((o>>>16)*c&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0},e}();t.BloomFilter=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Builder=void 0;var n=r(0),o=r(54),i=r(35),a=r(56),s=r(18),u=r(17),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.and=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.addOperator("$and",s.flatArgs(e))},t.prototype.or=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.addOperator("$or",s.flatArgs(e))},t.prototype.nor=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.addOperator("$nor",s.flatArgs(e))},t.prototype.eventStream=function(e,t,r,n){return this.where({}).eventStream(e,t,r,n)},t.prototype.resultStream=function(e,t,r,n){return this.where({}).resultStream(e,t,r,n)},t.prototype.resultList=function(e,t,r){return this.where({}).resultList(e,t,r)},t.prototype.singleResult=function(e,t,r){return this.where({}).singleResult(e,t,r)},t.prototype.count=function(e,t){return this.where({}).count(e,t)},t.prototype.addOperator=function(e,t){if(t.length<2)throw new Error("Only two or more queries can be joined with an "+e+" operator.");return t.forEach((function(e,t){if(!(e instanceof u.Node))throw new Error("Argument at index "+t+" is not a query.")})),new a.Operator(this.entityManager,this.resultClass,e,t)},t.prototype.addOrder=function(e,t){return new o.Filter(this.entityManager,this.resultClass).addOrder(e,t)},t.prototype.addFilter=function(e,t,r){return new o.Filter(this.entityManager,this.resultClass).addFilter(e,t,r)},t.prototype.addOffset=function(e){return new o.Filter(this.entityManager,this.resultClass).addOffset(e)},t.prototype.addLimit=function(e){return new o.Filter(this.entityManager,this.resultClass).addLimit(e)},t}(s.Query);t.Builder=c,Object.assign(c.prototype,i.Condition)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metamodel=void 0;var n=r(0),o=r(19),i=r(36),a=r(5),s=r(57),u=r(62),c=r(3),l=r(6),d=n.__importStar(r(2)),p=function(e){function t(t){var r=e.call(this)||this;return r.isInitialized=!1,r.entities={},r.embeddables={},r.baseTypes={},r.enhancer=new a.Enhancer,r.entityManagerFactory=t,r}return n.__extends(t,e),t.prototype.init=function(e){if(this.isInitialized)throw new Error("Metamodel is already initialized.");this.fromJSON(e||[]),this.isInitialized=!0},t.prototype.getRef=function(e){var t;return"string"==typeof e?0!==(t=e).indexOf("/db/")&&(t="/db/"+e):t=a.Enhancer.getIdentifier(e),t},t.prototype.entity=function(e){var t=this.getRef(e);return t?this.entities[t]:null},t.prototype.baseType=function(e){var t=null;if("string"==typeof e)t=this.getRef(e);else for(var r=Object.keys(this.baseTypes),n=0,o=r.length;n<o;n+=1){var i=r[n],a=this.baseTypes[i];if(!a.noResolving&&a.typeConstructor===e){t=i;break}}return t?this.baseTypes[t]:null},t.prototype.embeddable=function(e){var t=this.getRef(e);return t?this.embeddables[t]:null},t.prototype.managedType=function(e){return this.entity(e)||this.embeddable(e)},t.prototype.addType=function(e){var t={};if(e.isBasic)t=this.baseTypes;else if(e.isEmbeddable)e.init(this.enhancer),t=this.embeddables;else if(e.isEntity){var r=e;r.init(this.enhancer),t=this.entities,null===r.superType&&r.ref!==i.EntityType.Object.ref&&(r.superType=this.entity(i.EntityType.Object.ref))}if(t[e.ref])throw new Error("The type "+e.ref+" is already declared.");return t[e.ref]=e,e},t.prototype.load=function(){var e=this;if(!this.isInitialized)return this.withLock((function(){var t=new d.GetAllSchemas;return e.entityManagerFactory.send(t).then((function(t){return e.init(t.entity),e}))}));throw new Error("Metamodel is already initialized.")},t.prototype.save=function(e){var t=this;return this.sendUpdate(e||this.toJSON()).then((function(){return t}))},t.prototype.update=function(e){var t=this;return this.sendUpdate(e).then((function(e){return t.fromJSON(e.entity),t}))},t.prototype.sendUpdate=function(e){var t=this;return this.withLock((function(){var r;return r=e instanceof o.ManagedType?new d.UpdateSchema(e.name,e.toJSON()):new d.UpdateAllSchemas(e),t.entityManagerFactory.send(r)}))},t.prototype.toJSON=function(){var e=this;if(!this.isInitialized)throw new Error("Metamodel is not initialized.");return[].concat(Object.keys(this.entities).map((function(t){return e.entities[t].toJSON()})),Object.keys(this.embeddables).map((function(t){return e.embeddables[t].toJSON()})))},t.prototype.fromJSON=function(e){var t=this,r=(new s.ModelBuilder).buildModels(e);this.baseTypes={},this.embeddables={},this.entities={},Object.keys(r).forEach((function(e){return t.addType(r[e])}))},t.prototype.createIndex=function(e,t){var r=new d.CreateDropIndex(e,n.__assign(n.__assign({},t.toJSON()),{drop:!1}));return this.entityManagerFactory.send(r)},t.prototype.dropIndex=function(e,t){var r=new d.CreateDropIndex(e,n.__assign(n.__assign({},t.toJSON()),{drop:!0}));return this.entityManagerFactory.send(r)},t.prototype.dropAllIndexes=function(e){var t=new d.DropAllIndexes(e);return this.entityManagerFactory.send(t)},t.prototype.getIndexes=function(e){var t=new d.ListIndexes(e);return this.entityManagerFactory.send(t).then((function(e){return e.entity.map((function(e){return new u.DbIndex(e.keys,e.unique)}))})).catch((function(e){if(e.status===l.StatusCode.BUCKET_NOT_FOUND||e.status===l.StatusCode.OBJECT_NOT_FOUND)return null;throw e}))},t}(c.Lockable);t.Metamodel=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionAttribute=void 0;var n=r(0),o=r(11),i=function(e){function t(t,r,n){e.call(this,t,r,n);return e.call(this,t,r,n)||this}return n.__extends(t,e),Object.defineProperty(t.prototype,"collectionType",{get:function(){return o.CollectionType.COLLECTION},enumerable:!1,configurable:!0}),t}(o.PluralAttribute);t.CollectionAttribute=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.connect=t.configure=void 0;var n=r(0),o=n.__importStar(r(5)),i=n.__importStar(r(6)),a=n.__importStar(r(4)),s=n.__importStar(r(2)),u=n.__importStar(r(3)),c=n.__importStar(r(32)),l=n.__importStar(r(34)),d=n.__importStar(r(31)),p=n.__importStar(r(1)),f=n.__importStar(r(13)),h=r(1),y=r(13),b=r(23),g=r(24),m=r(15),v=r(14),O=r(3);function _(e,t,r,n){Object.keys(n).forEach((function(o){var i=O.deprecated(r.replace("$export",o));Object.defineProperty(e,o,i(t,o,{get:function(){return n[o]}}))}))}_(u,"util","intersection.$export",{Permission:h.Permission,Metadata:h.Metadata,TokenStorage:h.TokenStorage,Validator:h.Validator,PushMessage:h.PushMessage,Code:h.Code,Modules:h.Modules,Logger:h.Logger}),_(g.EntityManager.prototype,"db","import { $export } from 'baqend'",{db:v.db,binding:o,connector:i,error:a,message:s,util:u,caching:c,query:l,partialupdate:d,intersection:p,EntityManagerFactory:b.EntityManagerFactory,EntityManager:g.EntityManager,Acl:m.Acl}),_(y.Metamodel.prototype,"metamodel","import { metamodel } from 'baqend';",f),t.configure=function(){throw new Error("Please use Baqend.db.configure() or import { db } from 'baqend' instead.")},t.connect=function(){throw new Error("Please use Baqend.db.connect() or import { db } from 'baqend' instead.")}}])}));
//# sourceMappingURL=baqend.es5.min.js.map