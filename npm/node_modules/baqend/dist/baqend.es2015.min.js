/*! baqend 3.0.0 | Copyright (c) 2021 Baqend GmbH | License information baqend.es2015.min.js.LICENSE.txt */
var Baqend=function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=22)}([function(e,t,r){"use strict";r.r(t),r.d(t,"Message",(function(){return o})),r.d(t,"StatusCode",(function(){return a})),r.d(t,"OAuthMessages",(function(){return c})),r.d(t,"Connector",(function(){return u})),r.d(t,"FetchConnector",(function(){return d.FetchConnector})),r.d(t,"XMLHttpConnector",(function(){return l})),r.d(t,"IFrameConnector",(function(){return p})),r.d(t,"NodeConnector",(function(){return f.NodeConnector})),r.d(t,"WebSocketConnector",(function(){return m}));var s=r(5),n=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r};const i="undefined"==typeof navigator||"undefined"!=typeof chrome&&/google/i.test(navigator.vendor)||/cros i686/i.test(navigator.platform),a={NOT_MODIFIED:304,BAD_CREDENTIALS:460,BUCKET_NOT_FOUND:461,INVALID_PERMISSION_MODIFICATION:462,INVALID_TYPE_VALUE:463,OBJECT_NOT_FOUND:404,OBJECT_OUT_OF_DATE:412,PERMISSION_DENIED:466,QUERY_DISPOSED:467,QUERY_NOT_SUPPORTED:468,SCHEMA_NOT_COMPATIBLE:469,SCHEMA_STILL_EXISTS:470,SYNTAX_ERROR:471,TRANSACTION_INACTIVE:472,TYPE_ALREADY_EXISTS:473,TYPE_STILL_REFERENCED:474,SCRIPT_ABORTION:475};class o{constructor(...e){this.withCredentials=!1,this.progressCallback=null,this._tokenStorage=null,this._responseType=null;let t=0,r=this.spec.path[0];const s=this.spec.path.length;for(let n=1;n<s;n+=1)this.spec.dynamic&&s-1===n?r+=e[t].split("/").map(encodeURIComponent).join("/"):r+=encodeURIComponent(e[t])+this.spec.path[n],t+=1;let n="";for(let s=0;s<this.spec.query.length;s+=1){const i=e[t];t+=1,null!=i&&(n+=n||-1!==r.indexOf("?")?"&":"?",n+=`${this.spec.query[s]}=${encodeURIComponent(i)}`)}this.request={method:this.spec.method,path:r+n,entity:null,headers:{}},e[t]&&this.entity(e[t],"json"),this.responseType("json")}get spec(){return null}static create(e){const t=e.path.split("?"),r=t[0].split(/[:*]\w*/),s=[];t[1]&&t[1].split("&").forEach(e=>{const t=e.split("=");s.push(t[0])});const n={path:r,query:s,status:e.status,method:e.method,dynamic:-1!==e.path.indexOf("*")};return class extends o{get spec(){return n}}}static createExternal(e,t){const{path:r}=e,s=n(e,["path"]),i=Object.assign({dynamic:!1,path:[r]},s),a=class extends o{get spec(){return i}};return Object.assign(a.prototype,t),a}get isBinary(){return this.request.type&&this.request.type in o.BINARY||this._responseType in o.BINARY}tokenStorage(e){return void 0===e?this._tokenStorage:(this._tokenStorage=e,this)}path(e){if(void 0!==e){const t=this.request.path.indexOf("?")+1;return this.request.path=e+(t>0?(e.indexOf("?")>-1?"&":"?")+this.request.path.substring(t):""),this}return this.request.path}header(e,t){return null===t?(delete this.request.headers[e],this):void 0!==t?(this.request.headers[e]=t,this):this.request.headers[e]}entity(e,t){let r=t;return r||(r="string"==typeof e?/^data:(.+?)(;base64)?,.*$/.test(e)?"data-url":"text":"undefined"!=typeof Blob&&e instanceof Blob?"blob":"undefined"!=typeof Buffer&&e instanceof Buffer?"buffer":"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?"arraybuffer":"undefined"!=typeof FormData&&e instanceof FormData?"form":"json"),this.request.type=r,this.request.entity=e,this}mimeType(e){return this.header("content-type",e)}contentLength(e){return void 0!==e?this.header("content-length",""+e):Number(this.header("content-length"))}ifMatch(e){return this.header("If-Match",this.formatETag(e))}ifNoneMatch(e){return this.header("If-None-Match",this.formatETag(e))}ifUnmodifiedSince(e){return this.header("if-unmodified-since",e&&e.toUTCString().replace("UTC","GMT"))}noCache(){return i||this.ifMatch("").ifNoneMatch("-"),this.cacheControl("max-age=0, no-cache")}cacheControl(e){return this.header("cache-control",e)}acl(e){return this.header("baqend-acl",e&&JSON.stringify(e))}customHeaders(e){return this.header("baqend-custom-headers",e&&JSON.stringify(e))}accept(e){return this.header("accept",e)}responseType(e){return void 0!==e?(this._responseType=e,this):this._responseType}progress(e){return void 0!==e?(this.progressCallback=e,this):this.progressCallback}addQueryString(e){if("string"==typeof e)return this.request.path+=e,this;if(e){let t=this.request.path.indexOf("?")>=0?"&":"?";Object.keys(e).forEach(r=>{this.request.path+=`${t+r}=${encodeURIComponent(e[r])}`,t="&"})}return this}formatETag(e){if(null==e||"*"===e)return e;let t=""+e;return-1===t.indexOf('"')&&(t=`"${t}"`),t}doReceive(e){if(-1===this.spec.status.indexOf(e.status))throw new s.CommunicationError(this,e)}}o.StatusCode=a,o.BINARY={blob:!0,buffer:!0,stream:!0,arraybuffer:!0,"data-url":!0,base64:!0};const c={Google:o.createExternal({method:"OAUTH",path:"https://accounts.google.com/o/oauth2/auth?response_type=code&access_type=online",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/google"})}}),Facebook:o.createExternal({method:"OAUTH",path:"https://www.facebook.com/v7.0/dialog/oauth?response_type=code",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/facebook"})}}),GitHub:o.createExternal({method:"OAUTH",path:"https://github.com/login/oauth/authorize?response_type=code&access_type=online",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/github"})}}),LinkedIn:o.createExternal({method:"OAUTH",path:"https://www.linkedin.com/oauth/v2/authorization?response_type=code",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/linkedin"})}}),Twitter:o.createExternal({method:"OAUTH",path:"",query:[],status:[200]},{addRedirectOrigin(e){this.request.path=e+"/db/User/OAuth1/twitter"}}),Salesforce:o.createExternal({method:"OAUTH",path:"",query:["client_id","scope","state"],status:[200]},{addRedirectOrigin(e){this.addQueryString({redirect_uri:e+"/db/User/OAuth/salesforce"})}})};class u{constructor(e,t,r,s){this.host=e,this.port=t,this.secure=r,this.basePath=s,this.origin=u.toUri(this.host,this.port,this.secure,""),this.gzip=!1}static isUsable(e,t,r,s){return!1}static create(e,t,r,s){let n=e,i=t,a=r,o=s;if("undefined"!=typeof location&&(n||(n=location.hostname,i=Number(location.port)),void 0===a&&(a="https:"===location.protocol)),a=void 0===a||!!a,void 0===o&&(o=u.DEFAULT_BASE_PATH),-1!==n.indexOf("/")){const e=/^(https?):\/\/([^/:]+|\[[^\]]+])(:(\d*))?(\/\w+)?\/?$/.exec(n);if(!e)throw new Error(`The connection uri host ${n} seems not to be valid`);a="https"===e[1],n=e[2].replace(/(\[|])/g,""),i=Number(e[4]),o=e[5]||""}else"localhost"!==n&&/^[a-z0-9-]*$/.test(n)&&(n+=u.HTTP_DOMAIN);i||(i=a?443:80);const c=u.toUri(n,i,a,o);let d=this.connections[c];if(!d){for(let e=this.connectors.length-1;e>=0;e-=1){const t=this.connectors[e];if(t.isUsable&&t.isUsable(n,i,a,o)){d=new t(n,i,a,o);break}}if(!d)throw new Error("No connector is usable for the requested connection.");this.connections[c]=d}return d}static toUri(e,t,r,s){let n=(r?"https://":"http://")+(-1!==e.indexOf(":")?`[${e}]`:e);return n+=r&&443!==t||!r&&80!==t?":"+t:"",n+=s,n}send(e){let t={status:0,headers:{}};return Promise.resolve().then(()=>this.prepareRequest(e)).then(()=>new Promise(t=>{this.doSend(e,e.request,t)})).then(e=>{t=e}).then(()=>this.prepareResponse(e,t)).then(()=>(e.doReceive(t),t)).catch(e=>{throw t.entity=null,s.PersistentError.of(e)})}prepareRequest(e){if(!e.mimeType()){const{type:t}=e.request;"json"===t?e.mimeType("application/json;charset=utf-8"):"text"===t&&e.mimeType("text/plain;charset=utf-8")}let t;switch(this.toFormat(e),e.responseType()){case"json":t="application/json";break;case"text":t="text/*";break;default:t="application/json,text/*;q=0.5,*/*;q=0.1"}if(e.accept()||e.accept(t),this.gzip){const t=e.ifNoneMatch();t&&'""'!==t&&"*"!==t&&e.ifNoneMatch(t.slice(0,-1)+'--gzip"')}const r=e.tokenStorage();if("/connect"===e.request.path)return r.signPath(this.basePath+e.request.path).then(t=>(e.request.path=t.substring(this.basePath.length),e.cacheControl()&&(e.request.path+=(-1!==e.request.path.indexOf("?")?"&":"?")+"BCB"),e));if(r){const{token:t}=r;t&&e.header("authorization","BAT "+t)}return e}prepareResponse(e,t){let r;t.status=1223===t.status?204:t.status;const s=t.headers||{},n=204===t.status?null:t.entity;if(n&&(r=e.responseType(),!r||t.status>=400)){const e=s["content-type"]||s["Content-Type"];e&&e.indexOf("application/json")>-1&&(r="json")}s.etag&&(s.etag=s.etag.replace("--gzip",""));const i=e.tokenStorage();if(i){const e=s["baqend-authorization-token"]||s["Baqend-Authorization-Token"];e&&i.update(e)}return new Promise(e=>{e(n&&this.fromFormat(t,n,r))}).then(r=>{t.entity=r,-1!==e.request.path.indexOf("/connect")&&r&&(this.gzip=!!r.gzip)},e=>{throw new Error(`Response was not valid ${r}: ${e.message}`)})}}u.DEFAULT_BASE_PATH="/v1",u.HTTP_DOMAIN=".app.baqend.com",u.RESPONSE_HEADERS=["baqend-authorization-token","content-type","baqend-size","baqend-acl","etag","last-modified","baqend-created-at","baqend-custom-headers"],u.connectors=[],u.connections={};var d=r(17),h=r(4);class l extends u{static isUsable(e,t,r,s){return"undefined"!=typeof XMLHttpRequest}doSend(e,t,r){if("OAUTH"===t.method){this.oAuthHandle&&this.oAuthHandle({status:409,headers:{},entity:'{"message": "A new OAuth request was sent."}'}),localStorage.removeItem("oauth-response");const e=e=>{"oauth-response"===e.key&&this.oAuthHandle&&e.newValue&&this.oAuthHandle(JSON.parse(e.newValue))};return this.oAuthHandle=t=>{r(t),localStorage.removeItem("oauth-response"),removeEventListener("storage",e,!1)},void addEventListener("storage",e,!1)}const s=new XMLHttpRequest,n=this.origin+this.basePath+t.path;s.onreadystatechange=()=>{if(s.responseType&&2===s.readyState&&s.status>=400&&(s.responseType="text"),4===s.readyState){const e={headers:{},status:s.status,entity:s.response||s.responseText};u.RESPONSE_HEADERS.forEach(t=>{e.headers[t]=s.getResponseHeader(t)||""}),r(e)}},s.upload&&e.progress()&&(s.upload.onprogress=e.progress()),s.open(t.method,n,!0);const{entity:i}=t,{headers:a}=t,o=Object.keys(a);for(let e=0,t=o.length;e<t;e+=1){const t=o[e];s.setRequestHeader(t,a[t])}switch(s.withCredentials=e.withCredentials,e.responseType()){case"arraybuffer":s.responseType="arraybuffer";break;case"blob":case"data-url":case"base64":s.responseType="blob"}s.send(i)}fromFormat(e,t,r){if("json"===r)return JSON.parse(t);if("data-url"===r||"base64"===r){const e=new FileReader;return e.readAsDataURL(t),new Promise((t,r)=>{e.onload=t,e.onerror=r}).then(()=>{let{result:t}=e;return"base64"===r&&"string"==typeof t&&(t=t.substring(t.indexOf(",")+1)),t})}return t}toFormat(e){let{type:t}=e.request;if(t){let{entity:r}=e.request,s=e.mimeType();switch(t){case"blob":s=s||r.type;break;case"arraybuffer":case"form":break;case"data-url":{const e=r.match(/^data:(.+?)(;base64)?,(.*)$/),n=e[2];if(r=e[3],t="blob",s=s||e[1],!n){r=decodeURIComponent(r);break}}case"base64":{const e=Object(h.atob)(r),n=e.length,i=new Uint8Array(n);for(let t=0;t<n;t+=1)i[t]=e.charCodeAt(t);t="blob",r=new Blob([i],{type:s});break}case"json":"string"!=typeof r&&(r=JSON.stringify(r));break;case"text":break;default:throw new Error("Supported request format:"+t)}e.entity(r,t).mimeType(s)}}}u.connectors.push(l);class p extends l{constructor(e,t,r,s){super(e,t,r,s),this.queue=null,this.connected=!1,this.mid=0,this.messages={},this.doReceive=this.doReceive.bind(this),addEventListener("message",this.doReceive,!1)}static isUsable(e,t,r){if("undefined"==typeof location||"undefined"==typeof document)return!1;const s="https:"===location.protocol,n=location.port||(s?443:80);return location.hostname!==e||n!==t||s!==r}load(e){this.iframe=document.createElement("iframe"),this.iframe.src=this.origin+this.basePath+e,this.iframe.setAttribute("style",p.style),document.body.appendChild(this.iframe),this.queue=[],this.iframe.addEventListener("load",this.onLoad.bind(this),!1)}onLoad(){if(!this.queue)return;const{queue:e}=this;for(let t=0;t<e.length;t+=1)this.postMessage(e[t]);this.queue=null}doSend(e,t,r){if(e.isBinary)return void super.doSend(e,t,r);this.iframe||(this.load(e.request.path),e.request.path="/connect");const s={mid:this.mid+=1,method:t.method,path:t.path,headers:t.headers,entity:t.entity,responseHeaders:u.RESPONSE_HEADERS};this.messages[s.mid]=r;const n=JSON.stringify(s);this.queue?this.queue.push(n):this.postMessage(n),this.connected||setTimeout(()=>{this.messages[s.mid]&&(delete this.messages[s.mid],r({status:0,error:new Error("Connection refused."),headers:{}}))},1e4)}postMessage(e){this.iframe.contentWindow.postMessage(e,this.origin)}doReceive(e){if(e.origin!==this.origin||"{"!==e.data[0])return;const t=JSON.parse(e.data),r=this.messages[t.mid];r&&(delete this.messages[t.mid],this.connected=!0,r({status:t.status,headers:t.headers,entity:t.entity}))}}p.style="width:1px;height:1px;position:absolute;top:-10px;left:-10px;",u.connectors.push(p);var f=r(18);const{WebSocket:g}=window;var y=r(16);class m{constructor(e){this.observers={},this.socket=null,this.url=e}static create(e){let t=this.websockets[e];return t||(t=new m(e),this.websockets[e]=t),t}open(){if(!this.socket){const e=new g(this.url);let t;const r=r=>{let n=!1;this.socket===t&&(n=3!==e.readyState,this.socket=null);let i=null;if(Object.keys(this.observers).forEach(e=>{const t=this.observers[e];if(delete this.observers[e],t)try{n?t.error(new s.CommunicationError(null,Object.assign({status:0,headers:{}},r instanceof Error&&{error:r}))):t.complete()}catch(e){i||(i=e)}}),i)throw i};e.onerror=r,e.onclose=r,e.onmessage=e=>{const t=JSON.parse(e.data);t.date=new Date(t.date);const{id:n}=t;if(!n)return void("error"===t.type&&r(t));const i=this.observers[n];i&&("error"===t.type?i.error(new s.CommunicationError(null,t)):i.next(t))},t=new Promise(t=>{e.onopen=t}).then(()=>e),this.socket=t}return this.socket}close(){this.socket&&(this.socket.then(e=>{e.close()}),this.socket=null)}openStream(e,t){const r=new y.a(e=>{if(this.observers[t])throw new Error("Only one subscription per stream is allowed.");return this.observers[t]=e,()=>{this.observers[t]===e&&delete this.observers[t]}});return Object.assign(r,{send:r=>{this.open().then(s=>{const n=JSON.stringify(Object.assign(Object.assign({id:t},r),e.token&&{token:e.token}));s.send(n)})}}),r}}m.websockets={}},function(e,t,r){"use strict";r.r(t),r.d(t,"Metadata",(function(){return o})),r.d(t,"MetadataState",(function(){return s})),r.d(t,"Permission",(function(){return c.a})),r.d(t,"Validator",(function(){return h})),r.d(t,"ValidationResult",(function(){return p})),r.d(t,"Code",(function(){return y})),r.d(t,"Modules",(function(){return m})),r.d(t,"Logger",(function(){return b})),r.d(t,"PushMessage",(function(){return w})),r.d(t,"TokenStorage",(function(){return E})),r.d(t,"GlobalStorage",(function(){return T})),r.d(t,"WebStorage",(function(){return S}));var s,n=r(7),i=r(4),a=r(5);!function(e){e[e.UNAVAILABLE=-1]="UNAVAILABLE",e[e.PERSISTENT=0]="PERSISTENT",e[e.DIRTY=1]="DIRTY"}(s||(s={}));class o extends i.Lockable{constructor(e){super(),this.entityManager=null,this.decodedKey=null,this.id=null,this.state=s.DIRTY,this.enabled=!0,this.id=null,this.version=null,this.type=e,this.acl=new n.a}static create(e,t){if(e.isEntity)return new o(e);if(e.isEmbeddable)return{type:e,db:t,setDirty(){}};throw new Error("Illegal type "+e)}static get(e){return e._metadata}get db(){return this.entityManager||(this.entityManager=r(9).db),this.entityManager}set db(e){if(this.entityManager)throw new Error("DB has already been set.");this.entityManager=e}get bucket(){return this.type.name}get key(){if(!this.decodedKey&&this.id){const e=this.id.lastIndexOf("/");this.decodedKey=decodeURIComponent(this.id.substring(e+1))}return this.decodedKey}set key(e){const t=""+e;if(this.id)throw new Error("The id can't be set twice.");this.id=`/db/${this.bucket}/${encodeURIComponent(t)}`,this.decodedKey=t}get isAttached(){return!!this.entityManager}get isAvailable(){return this.state>s.UNAVAILABLE}get isPersistent(){return this.state===s.PERSISTENT}get isDirty(){return this.state===s.DIRTY}enable(e){this.enabled=e}throwUnloadedPropertyAccess(e){if(this.enabled&&!this.isAvailable)throw new a.PersistentError(`Illegal property access on ${this.id}#${e} , ensure that this reference is loaded before it's properties are accessed.`)}setUnavailable(){this.state=s.UNAVAILABLE}setPersistent(){this.state=s.PERSISTENT}setDirty(){this.state=s.DIRTY}setRemoved(){this.isAvailable&&(this.setDirty(),this.version=null)}}var c=r(15);const u={};let d=u;try{d=r(21)}catch(e){}class h{constructor(e,t){this.errors=[],this.key=e,this.entity=t}static compile(e,t){const r=[],s=e.attributes();for(let e=s.next();!e.done;e=s.next()){const t=e.value;r.push(t.name)}const n=new Function(...r,t);return function(e){if(d===u)throw new Error("Validation code will not be executed. Make sure that the validator package is correctly provided as an external dependency.");const t=r.map(t=>e[t]);return n.apply({},t)}}get value(){return this.entity[this.key]}get isValid(){return 0===this.errors.length}is(e,t){return e instanceof Function?this.is("is",e):(!1===t(this.value,d)&&this.errors.push(e),this)}callMethod(e,t,r){const s=r||[];try{s.unshift(this.toStringValue()),!1===d[e].apply(this,s)&&this.errors.push(t||e)}catch(e){this.errors.push(t||e.message)}return this}toStringValue(){const{value:e}=this;return"string"==typeof e||e instanceof Date?e:JSON.stringify(e)}toJSON(){return{isValid:this.isValid,errors:this.errors}}}const l=["contains","equals","matches"];Object.keys(d).forEach(e=>{(e.startsWith("is")||l.includes(e))&&(h.prototype[e]=function(...t){const r="string"==typeof t[0]?t.shift():null;return this.callMethod(e,r,t)})});class p{constructor(){this.fields={}}get isValid(){return Object.keys(this.fields).every(e=>this.fields[e].isValid)}toJSON(){const e={};return Object.keys(this.fields).forEach(t=>{e[t]=this.fields[t].toJSON()}),e}}var f=r(2),g=r(0);class y{constructor(e,t){this.metamodel=e,this.entityManagerFactory=t}functionToString(e){if(!e)return"";let t=e.toString();return t=t.substring(t.indexOf("{")+1,t.lastIndexOf("}")),"\n"===t.charAt(0)&&(t=t.substring(1)),"\n"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t}stringToFunction(e,t){return new Function(e,t)}loadModules(){const e=new f.GetAllModules;return this.entityManagerFactory.send(e).then(e=>e.entity)}loadCode(e,t,r=!1){const s="string"==typeof e?e:e.name,n=new f.GetBaqendCode(s,t).responseType("text");return this.entityManagerFactory.send(n).then(e=>this.parseCode(s,t,r,e.entity),e=>{if(e.status===g.StatusCode.OBJECT_NOT_FOUND)return null;throw e})}saveCode(e,t,r){const s="string"==typeof e?e:e.name,n=new f.SetBaqendCode(s,t).entity(r instanceof Function?this.functionToString(r):r,"text").responseType("text");return this.entityManagerFactory.send(n).then(e=>this.parseCode(s,t,r instanceof Function,e.entity))}deleteCode(e,t){const r="string"==typeof e?e:e.name,s=new f.DeleteBaqendCode(r,t);return this.entityManagerFactory.send(s).then(()=>this.parseCode(r,t,!1,null))}parseCode(e,t,r,s){if("validate"===t){const t=this.metamodel.entity(e);return t.validationCode=null===s?null:h.compile(t,s),r?t.validationCode:s}return s&&r?this.stringToFunction(["module","exports"],s):s}}class m{constructor(e){this.entityManager=e}get(e,t,r,s,n){if(t instanceof Function)return this.get(e,{},t,r,s);if(r instanceof Function)return this.get(e,t,{},r,s);const i=r||{},a=new f.GetBaqendModule(e).addQueryString(t||"").responseType(i.responseType||null);return this.send(a,s,n)}post(e,t,r,s,n){if("function"==typeof r)return this.post(e,t,{},r,s);const i=r||{},a=new f.PostBaqendModule(e).entity(t,i.requestType).mimeType(i.mimeType||null).responseType(i.responseType||null);return this.send(a,s,n)}send(e,t,r){return this.entityManager.send(e).then(e=>e.entity).then(t,r)}}class b{constructor(){this.entityManager=null,this.levelIndex=2}static create(e){const t=this.prototype,r=(()=>{function e(...r){t.log.apply(e,r)}return Object.getOwnPropertyNames(t).forEach(r=>{Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e})();return r.init(e),r}get level(){return b.LEVELS[this.levelIndex]}set level(e){const t=b.LEVELS.indexOf(e);if(-1===t)throw new Error("Unknown logging level "+e);this.levelIndex=t}log(...e){const t=-1===b.LEVELS.indexOf(e[0])?"info":e.shift();if(this.levelIndex>b.LEVELS.indexOf(t))return Promise.resolve(null);let r="string"==typeof e[0]?this.format(e.shift(),e):"[no message]",s=null;if(e.length){const t=e.pop();if(s=t,("object"!=typeof t||Array.isArray(t))&&(s={data:t}),t instanceof Error){const{stack:e,data:r,message:n,name:i,status:a}=t;s={name:i,message:n,stack:e,status:a,data:r}}}return e.length&&(r+=", "+e.join(", ")),this.logJSON(Object.assign({date:(new Date).toISOString(),message:r,level:t,data:s},this.entityManager.me&&{user:this.entityManager.me.id}))}format(e,t){if(0===t.length)return e;return String(e).replace(b.FORMAT_REGEXP,e=>{if("%%"===e)return"%";if(!t.length)return e;switch(e){case"%s":return String(t.shift());case"%d":return String(Number(t.shift()));case"%j":try{return JSON.stringify(t.shift())}catch(e){return"[Circular]"}default:return e}})}init(e){this.entityManager=e,this.levelIndex=2,b.LEVELS.forEach(e=>{this[e]=this.log.bind(this,e)})}logJSON(e){return this.entityManager.isReady?this.entityManager.send(new f.CreateObject("logs.AppLog",e)):this.entityManager.ready(this.logJSON.bind(this,e))}}b.LEVELS=["trace","debug","info","warn","error"],b.FORMAT_REGEXP=/%[sdj%]/g;var O=r(3);class w{constructor(e,t,r,s,n,i){const a="string"==typeof s?{sound:s,badge:n,data:i}:s||{};this.devices=w.initDevices(e),this.message=t,this.subject=r,Object.assign(this,a)}static initDevices(e){if(e instanceof Set)return e;if(e instanceof O.Entity)return new Set([e]);if(!e||e[Symbol.iterator])return new Set(e);throw new Error("Only Sets, Lists and Arrays can be used as devices.")}addDevice(e){this.devices.add(e)}toJSON(){if(!this.devices||!this.devices.size)throw new Error("Set of devices is empty.");return Object.assign({},this,{devices:Array.from(this.devices,e=>e.id)})}}class E{constructor(e,t,r){this.tokenData=t?E.parse(t):null,this.origin=e,this.temporary=!!r}static parse(e){return{val:e,createdAt:1e3*parseInt(e.substring(0,8),16),expireAt:1e3*parseInt(e.substring(8,16),16),sig:e.substring(e.length-40),data:e.substring(0,e.length-40)}}get token(){return this.tokenData?this.tokenData.val:null}static create(e){return Promise.resolve(new E(e))}saveToken(e,t,r){this._saveToken!==E.prototype._saveToken&&(console.log("Using deprecated TokenStorage._saveToken implementation."),this._saveToken(e,t,r))}_saveToken(e,t,r){}update(e){const t=e?E.parse(e):null;this.tokenData&&t&&this.tokenData.expireAt>t.expireAt||(this.tokenData=t,this.saveToken(this.origin,e,this.temporary))}signPath(e,t=!0){const{tokenData:r}=this,s=Promise.resolve(e.split("/").map(encodeURIComponent).join("/"));return r&&t?s.then(e=>E.hmac(e+r.data,r.sig).then(t=>`${e}?BAT=${r.data+t}`)).catch(e=>(console.warn("Can't sign the resource, run the SDK on a secured origin, or provide an alternative hmac implementation on TokenStorage.hmac",e),s)):s}}E.hmac=i.hmac;class T extends E{static create(e){return Promise.resolve(new T(e,T.tokens[e]))}saveToken(e,t,r){r||(t?T.tokens[e]=t:delete T.tokens[e])}}T.tokens={},E.GLOBAL=T;class S extends E{static isAvailable(){try{return"undefined"!=typeof localStorage&&(localStorage.setItem("bq_webstorage_test","bq"),localStorage.removeItem("bq_webstorage_test"),!0)}catch(e){return!1}}static create(e){let t=!1,r=localStorage.getItem("BAT:"+e);return r||"undefined"==typeof sessionStorage||(r=sessionStorage.getItem("BAT:"+e),t=!!r),Promise.resolve(new S(e,r,t))}saveToken(e,t,r){const s=r?sessionStorage:localStorage;t?s.setItem("BAT:"+e,t):s.removeItem("BAT:"+e)}}S.isAvailable()&&(E.WEB_STORAGE=S)},function(e,t,r){"use strict";r.r(t),r.d(t,"ListAllResources",(function(){return n})),r.d(t,"ApiVersion",(function(){return i})),r.d(t,"Specification",(function(){return a})),r.d(t,"GetBloomFilter",(function(){return o})),r.d(t,"GetBloomFilterExpirations",(function(){return c})),r.d(t,"DeleteBloomFilter",(function(){return u})),r.d(t,"GetOrestesConfig",(function(){return d})),r.d(t,"UpdateOrestesConfig",(function(){return h})),r.d(t,"Connect",(function(){return l})),r.d(t,"Status",(function(){return p})),r.d(t,"EventsUrl",(function(){return f})),r.d(t,"BannedIp",(function(){return g})),r.d(t,"Banned",(function(){return y})),r.d(t,"Unban",(function(){return m})),r.d(t,"UnbanIp",(function(){return b})),r.d(t,"GetBucketNames",(function(){return O})),r.d(t,"GetBucketIds",(function(){return w})),r.d(t,"ExportBucket",(function(){return E})),r.d(t,"ImportBucket",(function(){return T})),r.d(t,"TruncateBucket",(function(){return S})),r.d(t,"CreateObject",(function(){return v})),r.d(t,"GetObject",(function(){return M})),r.d(t,"ReplaceObject",(function(){return A})),r.d(t,"DeleteObject",(function(){return k})),r.d(t,"GetAllSchemas",(function(){return P})),r.d(t,"UpdateAllSchemas",(function(){return _})),r.d(t,"ReplaceAllSchemas",(function(){return C})),r.d(t,"GetSchema",(function(){return x})),r.d(t,"UpdateSchema",(function(){return N})),r.d(t,"ReplaceSchema",(function(){return R})),r.d(t,"DeleteSchema",(function(){return j})),r.d(t,"AdhocQuery",(function(){return D})),r.d(t,"AdhocQueryPOST",(function(){return I})),r.d(t,"AdhocCountQuery",(function(){return q})),r.d(t,"AdhocCountQueryPOST",(function(){return B})),r.d(t,"ListQueryResources",(function(){return F})),r.d(t,"CreateQuery",(function(){return L})),r.d(t,"ListThisQueryResources",(function(){return U})),r.d(t,"GetQueryCode",(function(){return $})),r.d(t,"RunQuery",(function(){return J})),r.d(t,"GetQueryParameters",(function(){return V})),r.d(t,"NewTransaction",(function(){return G})),r.d(t,"CommitTransaction",(function(){return z})),r.d(t,"UpdatePartially",(function(){return H})),r.d(t,"UpdateField",(function(){return W})),r.d(t,"Login",(function(){return Q})),r.d(t,"Register",(function(){return Y})),r.d(t,"Me",(function(){return K})),r.d(t,"ValidateUser",(function(){return X})),r.d(t,"Logout",(function(){return Z})),r.d(t,"NewPassword",(function(){return ee})),r.d(t,"ResetPassword",(function(){return te})),r.d(t,"Verify",(function(){return re})),r.d(t,"ChangeUsername",(function(){return se})),r.d(t,"VerifyUsername",(function(){return ne})),r.d(t,"OAuth2",(function(){return ie})),r.d(t,"OAuth1",(function(){return ae})),r.d(t,"UserToken",(function(){return oe})),r.d(t,"RevokeUserToken",(function(){return ce})),r.d(t,"GetBaqendCode",(function(){return ue})),r.d(t,"SetBaqendCode",(function(){return de})),r.d(t,"DeleteBaqendCode",(function(){return he})),r.d(t,"PostBaqendModule",(function(){return le})),r.d(t,"GetBaqendModule",(function(){return pe})),r.d(t,"GetAllModules",(function(){return fe})),r.d(t,"ListFiles",(function(){return ge})),r.d(t,"ListBuckets",(function(){return ye})),r.d(t,"DownloadArchive",(function(){return me})),r.d(t,"UploadPatchArchive",(function(){return be})),r.d(t,"GetFileBucketMetadata",(function(){return Oe})),r.d(t,"SetFileBucketMetadata",(function(){return we})),r.d(t,"DeleteFileBucket",(function(){return Ee})),r.d(t,"CreateFile",(function(){return Te})),r.d(t,"DownloadFile",(function(){return Se})),r.d(t,"UploadFile",(function(){return ve})),r.d(t,"GetFileMetadata",(function(){return Me})),r.d(t,"UpdateFileMetadata",(function(){return Ae})),r.d(t,"DeleteFile",(function(){return ke})),r.d(t,"CreateManifest",(function(){return Pe})),r.d(t,"DownloadAsset",(function(){return _e})),r.d(t,"RevalidateAssets",(function(){return Ce})),r.d(t,"GetRevalidationStatus",(function(){return xe})),r.d(t,"CancelRevalidation",(function(){return Ne})),r.d(t,"GetAllRevalidationStatus",(function(){return Re})),r.d(t,"CleanUpAssets",(function(){return je})),r.d(t,"ListIndexes",(function(){return De})),r.d(t,"CreateDropIndex",(function(){return Ie})),r.d(t,"DropAllIndexes",(function(){return qe})),r.d(t,"DeviceRegister",(function(){return Be})),r.d(t,"DevicePush",(function(){return Fe})),r.d(t,"DeviceRegistered",(function(){return Le})),r.d(t,"VAPIDKeys",(function(){return Ue})),r.d(t,"VAPIDPublicKey",(function(){return $e})),r.d(t,"GCMAKey",(function(){return Je})),r.d(t,"UploadAPNSCertificate",(function(){return Ve})),r.d(t,"Install",(function(){return Ge})),r.d(t,"SW",(function(){return ze})),r.d(t,"Beacon",(function(){return He}));var s=r(0);const n=s.Message.create({method:"GET",path:"/",status:[200]}),i=s.Message.create({method:"GET",path:"/version",status:[200]}),a=s.Message.create({method:"GET",path:"/spec",status:[200]}),o=s.Message.create({method:"GET",path:"/bloomfilter?rules=false",status:[200]}),c=s.Message.create({method:"GET",path:"/bloomfilter/expirations",status:[200]}),u=s.Message.create({method:"DELETE",path:"/bloomfilter?flush=true",status:[204]}),d=s.Message.create({method:"GET",path:"/config",status:[200]}),h=s.Message.create({method:"PUT",path:"/config",status:[200,202]}),l=s.Message.create({method:"GET",path:"/connect",status:[200]}),p=s.Message.create({method:"GET",path:"/status",status:[200]}),f=s.Message.create({method:"GET",path:"/events-url",status:[200]}),g=s.Message.create({method:"GET",path:"/banned/:ip",status:[204]}),y=s.Message.create({method:"GET",path:"/banned",status:[]}),m=s.Message.create({method:"DELETE",path:"/banned",status:[204]}),b=s.Message.create({method:"DELETE",path:"/banned/:ip",status:[204]}),O=s.Message.create({method:"GET",path:"/db",status:[200]}),w=s.Message.create({method:"GET",path:"/db/:bucket/ids?start=0&count=-1",status:[200]}),E=s.Message.create({method:"GET",path:"/db/:bucket",status:[200]}),T=s.Message.create({method:"PUT",path:"/db/:bucket",status:[200]}),S=s.Message.create({method:"DELETE",path:"/db/:bucket",status:[200]}),v=s.Message.create({method:"POST",path:"/db/:bucket",status:[201,202]}),M=s.Message.create({method:"GET",path:"/db/:bucket/:oid",status:[200,304]}),A=s.Message.create({method:"PUT",path:"/db/:bucket/:oid",status:[200,202]}),k=s.Message.create({method:"DELETE",path:"/db/:bucket/:oid",status:[202,204]}),P=s.Message.create({method:"GET",path:"/schema",status:[200]}),_=s.Message.create({method:"POST",path:"/schema",status:[200]}),C=s.Message.create({method:"PUT",path:"/schema",status:[200]}),x=s.Message.create({method:"GET",path:"/schema/:bucket",status:[200]}),N=s.Message.create({method:"POST",path:"/schema/:bucket",status:[200]}),R=s.Message.create({method:"PUT",path:"/schema/:bucket",status:[200]}),j=s.Message.create({method:"DELETE",path:"/schema/:bucket",status:[204]}),D=s.Message.create({method:"GET",path:"/db/:bucket/query?q&start=0&count=-1&sort=&eager=&hinted=",status:[200]}),I=s.Message.create({method:"POST",path:"/db/:bucket/query?start=0&count=-1&sort=",status:[200]}),q=s.Message.create({method:"GET",path:"/db/:bucket/count?q",status:[200]}),B=s.Message.create({method:"POST",path:"/db/:bucket/count",status:[200]}),F=s.Message.create({method:"GET",path:"/query",status:[200]}),L=s.Message.create({method:"POST",path:"/query",status:[201]}),U=s.Message.create({method:"GET",path:"/query/:qid",status:[200]}),$=s.Message.create({method:"GET",path:"/query/:qid/source",status:[200]}),J=s.Message.create({method:"GET",path:"/query/:qid/result?start=0&count=-1",status:[200]}),V=s.Message.create({method:"GET",path:"/query/:qid/parameters",status:[200]}),G=s.Message.create({method:"POST",path:"/transaction",status:[201]}),z=s.Message.create({method:"PUT",path:"/transaction/:tid/committed",status:[200]}),H=s.Message.create({method:"POST",path:"/db/:bucket/:oid",status:[200]}),W=s.Message.create({method:"POST",path:"/db/:bucket/:oid/:field",status:[200]}),Q=s.Message.create({method:"POST",path:"/db/User/login",status:[200]}),Y=s.Message.create({method:"POST",path:"/db/User/register",status:[200,204]}),K=s.Message.create({method:"GET",path:"/db/User/me",status:[200]}),X=s.Message.create({method:"GET",path:"/db/User/validate",status:[200]}),Z=s.Message.create({method:"GET",path:"/db/User/logout",status:[204]}),ee=s.Message.create({method:"POST",path:"/db/User/password",status:[200]}),te=s.Message.create({method:"POST",path:"/db/User/reset",status:[200]}),re=s.Message.create({method:"GET",path:"/db/User/verify?token=",status:[204]}),se=s.Message.create({method:"POST",path:"/db/User/changeUsername",status:[204]}),ne=s.Message.create({method:"GET",path:"/db/User/verifyUsername?token=",status:[204]}),ie=s.Message.create({method:"GET",path:"/db/User/OAuth/:provider?state=&code=&oauth_verifier=&oauth_token=&error_description=",status:[200]}),ae=s.Message.create({method:"GET",path:"/db/User/OAuth1/:provider",status:[200]}),oe=s.Message.create({method:"POST",path:"/db/User/:oid/token",status:[200]}),ce=s.Message.create({method:"DELETE",path:"/db/User/:oid/token",status:[204]}),ue=s.Message.create({method:"GET",path:"/code/:bucket/:type",status:[200]}),de=s.Message.create({method:"PUT",path:"/code/:bucket/:type",status:[200,202]}),he=s.Message.create({method:"DELETE",path:"/code/:bucket/:type",status:[202,204]}),le=s.Message.create({method:"POST",path:"/code/:bucket",status:[200,204]}),pe=s.Message.create({method:"GET",path:"/code/:bucket",status:[200,204]}),fe=s.Message.create({method:"GET",path:"/code",status:[200]}),ge=s.Message.create({method:"GET",path:"/file/:bucket/ids?path=/&start=&count=-1&deep=false",status:[200]}),ye=s.Message.create({method:"GET",path:"/file/buckets",status:[200]}),me=s.Message.create({method:"GET",path:"/file",status:[200]}),be=s.Message.create({method:"POST",path:"/file",status:[200]}),Oe=s.Message.create({method:"GET",path:"/file/:bucket",status:[200]}),we=s.Message.create({method:"PUT",path:"/file/:bucket",status:[204]}),Ee=s.Message.create({method:"DELETE",path:"/file/:bucket",status:[204]}),Te=s.Message.create({method:"POST",path:"/file/:bucket",status:[200]}),Se=s.Message.create({method:"GET",path:"/file/:bucket/*oid",status:[200,304]}),ve=s.Message.create({method:"PUT",path:"/file/:bucket/*oid",status:[200]}),Me=s.Message.create({method:"HEAD",path:"/file/:bucket/*oid",status:[200]}),Ae=s.Message.create({method:"POST",path:"/file/:bucket/*oid",status:[200]}),ke=s.Message.create({method:"DELETE",path:"/file/:bucket/*oid",status:[200,204]}),Pe=s.Message.create({method:"POST",path:"/pwa/manifest",status:[202]}),_e=s.Message.create({method:"GET",path:"/asset/*url",status:[200,304]}),Ce=s.Message.create({method:"POST",path:"/asset/revalidate",status:[202]}),xe=s.Message.create({method:"GET",path:"/asset/revalidate/:id",status:[200,202]}),Ne=s.Message.create({method:"DELETE",path:"/asset/revalidate/:id",status:[202]}),Re=s.Message.create({method:"GET",path:"/asset/revalidate?state=",status:[200]}),je=s.Message.create({method:"POST",path:"/asset/cleanup",status:[202]}),De=s.Message.create({method:"GET",path:"/index/:bucket",status:[200]}),Ie=s.Message.create({method:"POST",path:"/index/:bucket",status:[202]}),qe=s.Message.create({method:"DELETE",path:"/index/:bucket",status:[202]}),Be=s.Message.create({method:"POST",path:"/db/Device/register",status:[200]}),Fe=s.Message.create({method:"POST",path:"/db/Device/push",status:[204]}),Le=s.Message.create({method:"GET",path:"/db/Device/registered",status:[200]}),Ue=s.Message.create({method:"POST",path:"/config/VAPIDKeys",status:[200]}),$e=s.Message.create({method:"GET",path:"/config/VAPIDPublicKey",status:[200]}),Je=s.Message.create({method:"POST",path:"/config/GCMKey",status:[204]}),Ve=s.Message.create({method:"POST",path:"/config/APNSCert",status:[204]}),Ge=s.Message.create({method:"GET",path:"/speedkit?d=",status:[200]}),ze=s.Message.create({method:"GET",path:"/speedkit?r=&v=",status:[200]}),He=s.Message.create({method:"POST",path:"/rum/pi",status:[200]})},function(e,t,r){"use strict";r.r(t),r.d(t,"Accessor",(function(){return s})),r.d(t,"Enhancer",(function(){return a})),r.d(t,"Factory",(function(){return o})),r.d(t,"ManagedFactory",(function(){return d})),r.d(t,"EntityFactory",(function(){return h})),r.d(t,"LoginOption",(function(){return c})),r.d(t,"UserFactory",(function(){return l})),r.d(t,"DeviceFactory",(function(){return f})),r.d(t,"FileFactory",(function(){return A})),r.d(t,"Managed",(function(){return _})),r.d(t,"Entity",(function(){return N})),r.d(t,"Role",(function(){return I})),r.d(t,"User",(function(){return j})),r.d(t,"File",(function(){return M}));class s{getValue(e,t){return e[t.name]}setValue(e,t,r){e[t.name]=r}}const n=Symbol("BaqendId"),i=Symbol("BaqendType");class a{createProxy(e){return class extends e{}}static getBaqendType(e){return e[i]}static getIdentifier(e){return e[n]}static setIdentifier(e,t){e[n]=t}enhance(e,t){if(t[i]!==e){if(Object.prototype.hasOwnProperty.call(t,i))throw new Error("Type is already used by a different manager");t[i]=e,a.setIdentifier(t,e.ref),this.enhancePrototype(t.prototype,e)}}enhancePrototype(e,t){t.isEmbeddable||(e.toString===Object.prototype.toString&&Object.defineProperty(e,"toString",{value:function(){return this._metadata.id||this._metadata.bucket},enumerable:!1}),t.superType&&"Object"===t.superType.name&&t.superType.declaredAttributes.forEach(t=>{t.isMetadata||this.enhanceProperty(e,t)}),t.declaredAttributes.forEach(t=>{this.enhanceProperty(e,t)}))}enhanceProperty(e,t){const{name:r}=t;Object.defineProperty(e,r,{get(){return this._metadata.throwUnloadedPropertyAccess(r),null},set(e){this._metadata.throwUnloadedPropertyAccess(r),Object.defineProperty(this,r,{value:e,writable:!0,enumerable:!0,configurable:!0})},configurable:!0,enumerable:!0})}}class o{constructor(){this.type=null,this.prototype=null}static extend(e,t){t!==o.prototype&&this.extend(e,Object.getPrototypeOf(t));const r=Object.getOwnPropertyNames(t);for(let s=0,n=r.length;s<n;s+=1){const n=r[s];Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}return e}static createFactory(e){const t=o.extend((function(...e){return t.newInstance(e)}),this.prototype);return t.prototype=e.prototype,t.type=e,t}new(...e){return this.newInstance(e)}newInstance(e){if(!e||0===e.length)return new this.type;const t=[null];Array.prototype.push.apply(t,e);return new(Function.prototype.bind.apply(this.type,t))}}var c,u=r(1);class d extends o{constructor(){super(...arguments),this.methods=null,this.managedType=null,this.db=null}static create(e,t){const r=this.createFactory(e.typeConstructor);return r.methods=r.prototype,r.managedType=e,r.db=t,r}fromJSON(e){const t=this.newInstance();return this.managedType.fromJsonValue(u.Metadata.create(this.managedType,this.db),e,t,{persisting:!1})}addMethods(e){Object.assign(this.methods,e)}addMethod(e,t){this.methods[e]=t}}class h extends d{newInstance(e){const t=super.newInstance(e);return u.Metadata.get(t).db=this.db,t}load(e,t,r,s){return"function"==typeof t?this.load(e,{},t,r):this.db.load(this.managedType.typeConstructor,e,t).then(r,s)}ref(e){return this.db.getReference(this.managedType.ref,e)}fromJSON(e){const t=this.db.getReference(this.managedType.ref,e.id);return this.managedType.fromJsonValue(u.Metadata.get(t),e,t,{persisting:!1})}find(){return this.db.createQueryBuilder(this.managedType.typeConstructor)}partialUpdate(e,t){return this.ref(e).partialUpdate(t)}}!function(e){e[e.NO_LOGIN=-1]="NO_LOGIN",e[e.SESSION_LOGIN=0]="SESSION_LOGIN",e[e.PERSIST_LOGIN=1]="PERSIST_LOGIN"}(c||(c={}));class l extends h{get LoginOption(){return c}get me(){return this.db.me}register(e,t,r,s,n){if(r instanceof Function)return this.register(e,t,!0,r,s);const i="string"==typeof e?this.fromJSON({username:e}):e;return this.db.register(i,t,void 0===r||r).then(s,n)}login(e,t,r,s,n){return r instanceof Function?this.login(e,t,!0,r,s):this.db.login(e,t,void 0===r||r).then(s,n)}loginWithToken(e,t,r,s){return t instanceof Function?this.loginWithToken(e,!0,t,r):(this.db.token=e,this.db.renew(t).then(r,s))}logout(e,t){return this.db.logout().then(e,t)}newPassword(...e){if("string"==typeof e[2]){const[t,r,s,n,i]=e;return this.db.newPassword(t,r,s).then(n,i)}let[t,r,s,n,i]=e;return s instanceof Function&&(i=n,n=s,s=!0),this.db.newPasswordWithToken(t,r,s).then(n,i)}resetPassword(e,t,r){return this.db.resetPassword(e).then(t,r)}changeUsername(e,t,r,s,n){return this.db.changeUsername(e,t,r).then(s,n)}requestAPIToken(e,t,r){return this.db.requestAPIToken(this.managedType.typeConstructor,e).then(t,r)}revokeAllTokens(e,t,r){return this.db.revokeAllTokens(this.managedType.typeConstructor,e).then(t,r)}}l.DefaultOptions={google:{width:585,height:545,scope:"email"},facebook:{width:1140,height:640,scope:"email"},github:{width:1040,height:580,scope:"user:email"},twitter:{width:740,height:730},linkedin:{width:630,height:530,scope:"r_liteprofile"},salesforce:{width:585,height:545,scope:"email"}},["Google","Facebook","GitHub","Twitter","LinkedIn","Salesforce"].forEach(e=>{const t="loginWith"+e;l.prototype[t]=function(r,s,n,i){if(s instanceof Function)return this[t](r,{},s,n);const a=Object.assign(Object.assign({},l.DefaultOptions[e.toLowerCase()]),s||{});return this.db.loginWithOAuth(e,r,a).then(n,i)}});var p=r(2);class f extends h{get PushMessage(){return u.PushMessage}get me(){return this.db.deviceMe}get isRegistered(){return this.db.isDeviceRegistered}loadWebPushKey(){const e=new p.VAPIDPublicKey;return e.responseType("arraybuffer"),this.db.send(e).then(e=>e.entity)}register(e,t,r,s,n){if(r instanceof Function)return this.register(e,t,null,r,s);const i="string"==typeof t?{token:t}:t;return this.db.registerDevice(e,i,r).then(s,n)}push(e,t,r){return this.db.pushDevice(e).then(t,r)}}var g,y=r(5),m=r(7),b=r(4),O=r(0),w=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r};const E="/file".length,T=Symbol("Id"),S=Symbol("Metadata"),v=Symbol("Data");class M{constructor(e){this.db=null,this[g]=null;const t="string"==typeof e?{id:e}:e||{};if(t.id){if(-1===t.id.indexOf("/","/file/".length)||0!==t.id.indexOf("/file/"))throw new Error("Invalid file reference "+t.id);this[T]=t.id}else this[T]=this.createIdFromOptions(t);this.setDataOptions(t),this.isFolder="/"===this.id.charAt(this.id.length-1)}get id(){return this[T]}get url(){throw new Error("This method is removed. Use the asynchronous File.createURL() method instead.")}get name(){return this.id.substring(this.id.lastIndexOf("/",this.id.length-2)+1)}get mimeType(){if(this.isFolder)throw new Error("A folder has no mimeType");return this.checkAvailable(),this[S].mimeType}get acl(){return this.checkAvailable(),this[S].acl}get lastModified(){if(this.isFolder)throw new Error("A folder has no lastModified");return this.checkAvailable(),this[S].lastModified}get createdAt(){if(this.isFolder)throw new Error("A folder has no creation date");return this.checkAvailable(),this[S].createdAt}get eTag(){if(this.isFolder)throw new Error("A folder has no eTag");return this.checkAvailable(),this[S].eTag}get headers(){if(this.isFolder)throw new Error("A folder has no custom headers");return this.checkAvailable(),this[S].headers}get size(){if(this.isFolder)throw new Error("A folder has no size");return this.checkAvailable(),this[S].size}get bucket(){return this.id.substring(E+1,this.id.indexOf("/",E+1))}get key(){return this.id.substring(this.id.indexOf("/",E+1)+1)}get path(){return this.id.substring(E)}get parent(){return this.id.substring(E,this.id.lastIndexOf("/",this.id.length-2))}get isMetadataLoaded(){return!!this[S]}static parseETag(e){if(!e)return null;const t=e.match(/^(?:[wW]\/)?["'](.*)["']$/);return t?t[1]:null}createURL(e){if(this.isFolder)throw new Error("Url can not be created for folders.");return this.db.createURL(this.id,"boolean"==typeof e?e:"www"!==this.bucket)}upload(e,t,r){var s;const n=e||{};if(this.isFolder)throw new Error("A folder cannot be uploaded");this.setDataOptions(n);const i=new p.UploadFile(this.bucket,this.key).entity(this[v].data,null===(s=this[v])||void 0===s?void 0:s.type),a=this[S];return a&&(i.acl(a.acl),i.contentLength(a.size),i.mimeType(a.mimeType),i.customHeaders(a.headers)),i.progress(n.progress||null),this.conditional(i,n),this.db.addToBlackList(this.id),this.db.send(i).then(e=>(this[v]=null,this.fromJSON(e.entity),this)).then(t,r)}download(e,t,r){const s=e||{};if(this.isFolder)throw new Error("A folder cannot be downloaded");const n=s.type||"blob",i=new p.DownloadFile(this.bucket,this.key).responseType(n);return this.db.ensureCacheHeader(this.id,i,s.refresh),this.db.send(i).then(e=>(this.db.addToWhiteList(this.id),this.fromHeaders(e.headers),e.entity),e=>{if(e.status===O.StatusCode.OBJECT_NOT_FOUND)return null;throw e}).then(t,r)}delete(e,t,r){const s=e||{},n=new p.DeleteFile(this.bucket,this.key);return this.conditional(n,s),this.isFolder||this.db.addToBlackList(this.id),this.db.send(n).then(e=>this.isFolder?e.entity.map(e=>new this.db.File(e)):this).then(t,r)}createIdFromOptions(e){var t;let r;if(e.path)r=e.path;else{const s=Object(b.trailingSlashIt)(e.parent||"/www");if(s.length<3)throw new Error("Invalid parent name: "+s);r=s+(e.name||(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.name)||Object(b.uuid)())}if("/"!==r.charAt(0)&&(r="/"+r),-1!==r.indexOf("//")||r.length<3)throw new Error("Invalid path: "+r);return"/file"+r}conditional(e,t){if(t.force)return;const r=this[S];r&&(r.lastModified||r.eTag)?(e.ifUnmodifiedSince(r.lastModified),e.ifMatch(r.eTag)):e.ifNoneMatch("*")}loadMetadata(e,t,r){const s=e||{};if(this.isFolder)throw new Error("A folder has no mata data.");const n=new p.GetFileMetadata(this.bucket,this.key);return this.db.ensureCacheHeader(this.id,n,s.refresh),this.db.send(n).then(e=>(this.fromHeaders(e.headers),this),e=>{if(e.status===O.StatusCode.OBJECT_NOT_FOUND)return null;throw e}).then(t,r)}saveMetadata(e,t,r){const s=e||{},n=this.toJSON(),i=new p.UpdateFileMetadata(this.bucket,this.key).entity(n);return this.conditional(i,s),this.db.send(i).then(e=>(this.fromJSON(e.entity),this)).then(t,r)}setDataOptions(e){const{data:t,type:r}=e,s=w(e,["data","type"]);if(!t)return;this[v]={type:r,data:t};const n=this.guessMimeType(e)||void 0;this.fromJSON(Object.assign(Object.assign({},s),{mimeType:n}))}guessMimeType(e){const{mimeType:t}=e;if(t)return t;if("undefined"!=typeof Blob&&e.data instanceof Blob)return e.data.type;if("data-url"===e.type&&"string"==typeof e.data){const t=e.data.match(/^data:(.+?)(;base64)?,.*$/);return t&&t[1]}return null}fromHeaders(e){this.fromJSON({eTag:M.parseETag(e.etag),lastModified:e["last-modified"],createdAt:e["baqend-created-at"],mimeType:e["content-type"],acl:e["baqend-acl"]&&JSON.parse(e["baqend-acl"]),size:+e["baqend-size"],headers:e["baqend-custom-headers"]&&JSON.parse(e["baqend-custom-headers"])})}fromJSON(e){const{id:t}=e;if(t&&this.id!==t)throw new Error(`This file id ${this.id} does not match the given json id ${t}`);const r=this[S]||{};let s;e.acl instanceof m.a?s=e.acl:(s=r.acl||new m.a,e.acl&&s.fromJSON(e.acl)),this[S]=Object.assign(Object.assign({},this[S]),{mimeType:e.mimeType,lastModified:e.lastModified&&new Date(e.lastModified)||r.lastModified,createdAt:e.createdAt&&new Date(e.createdAt)||r.createdAt,eTag:e.eTag||r.eTag,acl:s,size:"number"==typeof e.size?e.size:e.contentLength,headers:e.headers||r.headers||{}})}toJSON(){var e;this.checkAvailable();const t=this[S];return{id:this.id,mimeType:t.mimeType,eTag:t.eTag,acl:null===(e=t.acl)||void 0===e?void 0:e.toJSON(),size:t.size,lastModified:t.lastModified&&t.lastModified.toISOString(),createdAt:t.createdAt&&t.createdAt.toISOString(),headers:t.headers}}checkAvailable(){if(!this.isMetadataLoaded)throw new y.PersistentError(`The file metadata of ${this.id} is not available.`)}}g=v;class A extends o{constructor(){super(...arguments),this.db=null}static create(e){const t=this.createFactory(M);return t.db=e,t}newInstance(e){const t=super.newInstance(e);return t.db=this.db,t}fromJSON(e){const t=this.newInstance([e.id]);return t.fromJSON(e),t}saveMetadata(e,t,r,s){const n=new p.SetFileBucketMetadata(e,t);return this.db.send(n).then(r,s)}loadMetadata(e,t,r,s){const n=new p.GetFileBucketMetadata(e);return this.db.send(n).then(e=>{const t={};return u.Permission.BASE_PERMISSIONS.forEach(r=>{t[r]=u.Permission.fromJSON(e.entity[r]||{})}),t},e=>{if(e.status===O.StatusCode.OBJECT_NOT_FOUND)return null;throw e}).then(r,s)}listBuckets(e,t){return this.db.send(new p.ListBuckets).then(e=>e.entity.map(e=>this.new(e+"/"))).then(e,t)}listFiles(e,t,r,s,n){let i;if("string"==typeof e){const t=Object(b.trailingSlashIt)(e);i=this.new({path:t})}else i=e;const a=i.key,{bucket:o}=i;return this.db.send(new p.ListFiles(o,a,t?t.key:void 0,r)).then(e=>e.entity.map(e=>this.new(e))).then(s,n)}}function k(e){return function(t,r,s){s.enumerable=e}}var P=function(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};class _{static init(e,t){const r=a.getBaqendType(e.constructor);r.isEntity&&Object.defineProperty(e,"_metadata",{value:u.Metadata.create(r),configurable:!0}),t&&Object.assign(e,t)}static extend(e){return e.prototype=Object.create(this.prototype,{constructor:{value:e,configurable:!0,writable:!0}}),e.extend=_.extend,e}constructor(e){_.init(this,e)}toString(){return a.getBaqendType(this.constructor).ref}toJSON(){const e=a.getBaqendType(this.constructor);return e.toJsonValue(u.Metadata.create(e),this,{persisting:!1})}}P([k(!1)],_.prototype,"toString",null),P([k(!1)],_.prototype,"toJSON",null);var C=r(13),x=function(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};class N extends _{get id(){return this._metadata.id}set id(e){if(this._metadata.id)throw new Error("The id can't be set twice: "+e);0===(""+e).indexOf(`/db/${this._metadata.bucket}/`)?this._metadata.id=e:this.key=e}get key(){return this._metadata.key}set key(e){this._metadata.key=e}get version(){return this._metadata.version}get acl(){return this._metadata.throwUnloadedPropertyAccess("acl"),this._metadata.acl}attach(e){e.attach(this)}ready(e){return this._metadata.ready().then(()=>this).then(e)}save(e,t,r){return"function"==typeof e?this.save({},e,t):this._metadata.db.save(this,e).then(t,r)}insert(e,t,r){return"function"==typeof e?this.insert({},e,t):this._metadata.db.insert(this,e).then(t,r)}update(e,t,r){return"function"==typeof e?this.update({},e,t):this._metadata.db.update(this,e).then(t,r)}load(e,t,r){if("function"==typeof e)return this.load({},e,t);const s=Object.assign({local:!0},e);if(null===this.id)throw new y.PersistentError("This object can't be loaded, it does have an id.");return this._metadata.db.load(this.id,void 0,s).then(t,r)}delete(e,t,r){return"function"==typeof e?this.delete({},e,t):this._metadata.db.delete(this,e).then(t,r)}optimisticSave(e,t,r){return this._metadata.db.optimisticSave(this,e).then(t,r)}attr(){throw new Error("Attr is not yet implemented.")}validate(){return this._metadata.db.validate(this)}partialUpdate(e){return new C.EntityPartialUpdateBuilder(this,e)}getReferencing(e){const{db:t}=this._metadata,r=this._metadata.type.getReferencing(t,e),s=Array.from(r).map(([e,r])=>{const s=t.createQueryBuilder(e.typeConstructor),n=[];r.forEach(e=>{n.push(s.equal(e,this))});return(1===n.length?n[0]:s.or(n)).resultList()});return Promise.all(s).then(e=>e.filter(e=>!!e.length)).then(e=>Array.prototype.concat.apply([],e))}toString(){const e=a.getBaqendType(this.constructor);return this.id||e.ref}toJSON(e){let t=e;"boolean"==typeof t&&(t={excludeMetadata:t}),"object"!=typeof t&&(t={});const r=this._metadata;return r.type.toJsonValue(r,this,t)}}x([k(!0)],N.prototype,"id",null),x([k(!1)],N.prototype,"key",null),x([k(!0)],N.prototype,"version",null),x([k(!0)],N.prototype,"acl",null),x([k(!1)],N.prototype,"attach",null),x([k(!1)],N.prototype,"ready",null),x([k(!1)],N.prototype,"save",null),x([k(!1)],N.prototype,"insert",null),x([k(!1)],N.prototype,"update",null),x([k(!1)],N.prototype,"load",null),x([k(!1)],N.prototype,"delete",null),x([k(!1)],N.prototype,"optimisticSave",null),x([k(!1)],N.prototype,"attr",null),x([k(!1)],N.prototype,"validate",null),x([k(!1)],N.prototype,"partialUpdate",null),x([k(!1)],N.prototype,"getReferencing",null),x([k(!1)],N.prototype,"toString",null),x([k(!1)],N.prototype,"toJSON",null);var R=function(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};class j extends N{newPassword(e,t,r,s){return this._metadata.db.newPassword(this.username,e,t).then(r,s)}changeUsername(e,t,r,s){return this._metadata.db.changeUsername(this.username,e,t).then(r,s)}requestAPIToken(e,t){return this._metadata.db.requestAPIToken(this.constructor,this).then(e,t)}}R([k(!1)],j.prototype,"newPassword",null),R([k(!1)],j.prototype,"changeUsername",null),R([k(!1)],j.prototype,"requestAPIToken",null);var D=function(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};class I extends N{constructor(){super(...arguments),this.users=null,this.name=null}hasUser(e){return!!this.users&&this.users.has(e)}addUser(e){if(!(e instanceof j))throw new Error("Only user instances can be added to a role.");this.users||(this.users=new Set),this.users.add(e)}removeUser(e){if(!(e instanceof j))throw new Error("Only user instances can be removed from a role.");this.users&&this.users.delete(e)}}D([k(!1)],I.prototype,"hasUser",null),D([k(!1)],I.prototype,"addUser",null),D([k(!1)],I.prototype,"removeUser",null)},function(e,t,r){"use strict";r.r(t),r.d(t,"isNode",(function(){return s})),r.d(t,"atob",(function(){return n})),r.d(t,"hmac",(function(){return i})),r.d(t,"Lockable",(function(){return a})),r.d(t,"uuid",(function(){return g})),r.d(t,"deprecated",(function(){return m})),r.d(t,"trailingSlashIt",(function(){return b}));const s=!1,n=window.atob.bind(window);function i(e,t){const r=new TextEncoder;return Promise.resolve(crypto.subtle.importKey("raw",r.encode(t),{name:"HMAC",hash:{name:"SHA-1"}},!1,["sign","verify"])).then(t=>crypto.subtle.sign("HMAC",t,r.encode(e))).then(e=>new Uint8Array(e).reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""))}class a{constructor(){this.isLocked=!1,this.readyPromise=Promise.resolve(this)}get isReady(){return!this.isLocked}ready(e,t){return this.readyPromise.then(e,t)}withLock(e,t=!1){if(this.isLocked)throw new Error("Current operation has not been finished.");try{this.isLocked=!0;const r=e().then(e=>(this.isLocked=!1,e),e=>{throw t||(this.isLocked=!1),e});return this.readyPromise=r.then(()=>this,e=>{if(!t)return this;throw e}),r}catch(e){throw t?this.readyPromise=Promise.reject(e):this.isLocked=!1,e}}}var o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),c=new Uint8Array(16);function u(){if(!o)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(c)}var d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var h=function(e){return"string"==typeof e&&d.test(e)},l=[],p=0;p<256;++p)l.push((p+256).toString(16).substr(1));var f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!h(r))throw TypeError("Stringified UUID is invalid");return r};const g=function(e,t,r){var s=(e=e||{}).random||(e.rng||u)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=s[n];return t}return f(s)},y={};function m(e){return function(t,r,s={writable:!0,enumerable:!1,configurable:!0}){const n=`${"string"==typeof t?t:t.constructor.name}.${r}`,i=()=>{y[n]||(y[n]=!0,console.warn(`Usage of ${n} is deprecated, use ${e} instead.`))},a={enumerable:s.enumerable,configurable:s.configurable};if(s.get||s.set)s.get&&(a.get=function(){return i(),s.get.call(this)}),s.set&&(a.set=function(e){return i(),s.set.call(this,e)});else{let e=s.value;a.get=function(){return i(),e},s.writable&&(a.set=function(t){i(),e=t})}return a}}function b(e){return"/"!==e.charAt(e.length-1)?e+"/":e}},function(e,t,r){"use strict";r.r(t),r.d(t,"PersistentError",(function(){return s})),r.d(t,"CommunicationError",(function(){return n})),r.d(t,"IllegalEntityError",(function(){return i})),r.d(t,"EntityExistsError",(function(){return a})),r.d(t,"RollbackError",(function(){return o}));const s=(()=>{function e(e,t){Object.prototype.hasOwnProperty.call(Error,"captureStackTrace")?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e||"An unexpected persistent error occurred.",this.name=this.constructor.name,t&&(this.cause=t,t.stack&&(this.stack+="\nCaused By: "+t.stack))}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0}}),e})();s.of=function(e){return e instanceof s?e:new s(null,e)};class n extends s{constructor(e,t){const r=t.entity||t.error||{},s=0===t.status?"Request":"Response";super(r.message||e&&`Handling the ${s} for ${e.request.method} ${e.request.path}`||"A communication error occurred.",r),this.name=r.className||"CommunicationError",this.reason=r.reason||"Communication failed",this.status=t.status,r.data&&(this.data=r.data);let n=r;for(;n&&n.stackTrace;){this.stack+=`\nServerside Caused by: ${n.className} ${n.message}`;const{stackTrace:e}=n;for(let t=0;t<e.length;t+=1){const r=e[t];this.stack+=`\n    at ${r.className}.${r.methodName}`,this.stack+=` (${r.fileName}:${r.lineNumber})`}n=n.cause}}}class i extends s{constructor(e){super(`Entity ${e} is not a valid entity`),this.entity=e}}class a extends s{constructor(e){super(`The entity ${e} is managed by a different db.`),this.entity=e}}class o extends s{constructor(e){super("The transaction has been roll backed",e)}}},function(e,t,r){"use strict";var s;r.r(t),r.d(t,"Metamodel",(function(){return x})),r.d(t,"DbIndex",(function(){return k})),r.d(t,"Type",(function(){return n})),r.d(t,"PersistenceType",(function(){return s})),r.d(t,"SingularAttribute",(function(){return y})),r.d(t,"SetAttribute",(function(){return M})),r.d(t,"PluralAttribute",(function(){return b})),r.d(t,"CollectionType",(function(){return m})),r.d(t,"ModelBuilder",(function(){return A})),r.d(t,"MapAttribute",(function(){return v})),r.d(t,"ManagedType",(function(){return o})),r.d(t,"ListAttribute",(function(){return T})),r.d(t,"EntityType",(function(){return w})),r.d(t,"EmbeddableType",(function(){return E})),r.d(t,"CollectionAttribute",(function(){return N})),r.d(t,"BasicType",(function(){return l})),r.d(t,"Attribute",(function(){return g})),r.d(t,"PersistentAttributeType",(function(){return c})),function(e){e[e.BASIC=0]="BASIC",e[e.EMBEDDABLE=1]="EMBEDDABLE",e[e.ENTITY=2]="ENTITY",e[e.MAPPED_SUPERCLASS=3]="MAPPED_SUPERCLASS"}(s||(s={}));class n{constructor(e,t){if(0!==e.indexOf("/db/"))throw new SyntaxError(`Type ref ${e} is invalid.`);this.ref=e,this.name=e.substring(4),this._typeConstructor=t}get persistenceType(){return-1}get isBasic(){return this.persistenceType===s.BASIC}get isEmbeddable(){return this.persistenceType===s.EMBEDDABLE}get isEntity(){return this.persistenceType===s.ENTITY}get isMappedSuperclass(){return this.persistenceType===s.MAPPED_SUPERCLASS}get typeConstructor(){return this._typeConstructor}set typeConstructor(e){if(this._typeConstructor)throw new Error("typeConstructor has already been set.");this._typeConstructor=e}}var i=r(3),a=r(1);class o extends n{constructor(e,t){super(0!==e.indexOf("/db/")?"/db/"+e:e,t),this.enhancer=null,this.declaredAttributes=[],this.schemaAddPermission=new a.Permission,this.schemaReplacePermission=new a.Permission,this.metadata=null,this.superType=null,this._validationCode=null}get validationCode(){return this._validationCode}set validationCode(e){this._validationCode=e}get typeConstructor(){return this._typeConstructor||(this.typeConstructor=this.createProxyClass()),this._typeConstructor}set typeConstructor(e){if(this._typeConstructor)throw new Error("Type constructor has already been set.");const t=e.prototype instanceof i.Entity;if(this.isEntity){if(!t)throw new TypeError("Entity classes must extends the Entity class.")}else if(!(e.prototype instanceof i.Managed)||t)throw new TypeError("Embeddable classes must extends the Managed class.");this.enhancer.enhance(this,e),this._typeConstructor=e}init(e){this.enhancer=e,this._typeConstructor&&!i.Enhancer.getIdentifier(this._typeConstructor)&&i.Enhancer.setIdentifier(this._typeConstructor,this.ref)}create(){const e=Object.create(this.typeConstructor.prototype);return i.Managed.init(e),e}attributes(){let e,t=0;const r=this;return this.superType&&(e=this.superType.attributes()),{[Symbol.iterator](){return this},next(){if(e){const t=e.next();if(!t.done)return t;e=null}if(t<r.declaredAttributes.length){const e=r.declaredAttributes[t];return t+=1,{value:e,done:!1}}return{done:!0,value:void 0}}}}addAttribute(e,t){if(this.getAttribute(e.name))throw new Error(`An attribute with the name ${e.name} is already declared.`);let r;r=e.order?e.order:void 0===t?this.declaredAttributes.length:t,e.init(this,r),this.declaredAttributes.push(e),this._typeConstructor&&"Object"!==this.name&&this.enhancer.enhanceProperty(this._typeConstructor,e)}removeAttribute(e){const{length:t}=this.declaredAttributes;if(this.declaredAttributes=this.declaredAttributes.filter(t=>t.name!==e),t===this.declaredAttributes.length)throw new Error(`An Attribute with the name ${e} is not declared.`)}getAttribute(e){let t=this.getDeclaredAttribute(e);return!t&&this.superType&&(t=this.superType.getAttribute(e)),t}getDeclaredAttribute(e){return this.declaredAttributes.filter(t=>t.name===e||t.order===e)[0]||null}fromJsonValue(e,t,r,s){if(!t||!r)return null;const n=this.attributes();for(let i=n.next();!i.done;i=n.next()){const n=i.value;s.onlyMetadata&&!n.isMetadata||n.setJsonValue(e,r,t[n.name],s)}return r}toJsonValue(e,t,r){if(!(t instanceof this.typeConstructor))return null;const s={},n=this.attributes();for(let i=n.next();!i.done;i=n.next()){const n=i.value;r.excludeMetadata&&n.isMetadata||(s[n.name]=n.getJsonValue(e,t,r))}return s}toJSON(){const e={};return this.declaredAttributes.forEach(t=>{t.isMetadata||(e[t.name]=t)}),Object.assign(Object.assign(Object.assign({class:this.ref,fields:e,acl:{schemaAdd:this.schemaAddPermission.toJSON(),schemaReplace:this.schemaReplacePermission.toJSON()}},this.superType&&{superClass:this.superType.ref}),this.isEmbeddable&&{embedded:!0}),this.metadata&&{metadata:this.metadata})}references(){const e=this.attributes();let t,r;return{[Symbol.iterator](){return this},next(){for(;;){if(r){const e=r.next();if(!e.done)return{value:{path:[t.name].concat(e.value.path)}};r=null}const s=e.next();if(s.done)return{done:!0,value:void 0};t=s.value;const n=t.isCollection?t.elementType:t.type;if(n.isEntity)return{value:{path:[t.name]}};n.isEmbeddable&&(r=n.references())}}}}hasMetadata(e){return!!this.metadata&&!!this.metadata[e]}getMetadata(e){return this.hasMetadata(e)?this.metadata[e]:null}}var c,u=r(8);function d(e){return e instanceof Date?e.toISOString().replace(/\.?0*Z/,"Z"):null}function h(e,t){const r="string"==typeof e?new Date(e):null;return t&&r&&t.toISOString()===r.toISOString()?t:r}class l extends n{constructor(e,t,r){super(0===e.indexOf("/db/")?e:"/db/"+e,t),this.noResolving=!!r}get persistenceType(){return s.BASIC}toJsonValue(e,t){return null==t?null:this.typeConstructor(t)}fromJsonValue(e,t,r){return null==t?null:t}toString(){return`BasicType(${this.ref})`}}l.Boolean=new class extends l{fromJsonValue(e,t,r){return"string"==typeof t?"false"!==t:super.fromJsonValue(e,t,r)}}("Boolean",Boolean),l.Double=new class extends l{fromJsonValue(e,t,r){return"string"==typeof t?parseFloat(t):super.fromJsonValue(e,t,r)}}("Double",Number),l.Integer=new class extends l{fromJsonValue(e,t,r){return"string"==typeof t?parseInt(t,10):super.fromJsonValue(e,t,r)}}("Integer",Number),l.String=new class extends l{}("String",String),l.DateTime=new class extends l{toJsonValue(e,t){return d(t)}fromJsonValue(e,t,r){return h(t,r)}}("DateTime",Date),l.Date=new class extends l{toJsonValue(e,t){const r=d(t);return r?r.substring(0,r.indexOf("T")):null}fromJsonValue(e,t,r){return h(t,r)}}("Date",Date),l.Time=new class extends l{toJsonValue(e,t){const r=d(t);return r?r.substring(r.indexOf("T")+1):null}fromJsonValue(e,t,r){return"string"==typeof t?h("1970-01-01T"+t,r):null}}("Time",Date),l.File=new class extends l{toJsonValue(e,t){return t instanceof i.File?t.id:null}fromJsonValue(e,t,r){return t?r&&r.id===t?r:e.db?new e.db.File(t):null:null}}("File",i.File),l.GeoPoint=new class extends l{toJsonValue(e,t){return t instanceof u.a?t.toJSON():null}fromJsonValue(e,t){return t?new u.a(t):null}}("GeoPoint",u.a),l.JsonArray=new class extends l{toJsonValue(e,t){return Array.isArray(t)?t:null}fromJsonValue(e,t){return Array.isArray(t)?t:null}}("JsonArray",Array),l.JsonObject=new class extends l{toJsonValue(e,t){return t&&t.constructor===Object?t:null}}("JsonObject",Object),function(e){e[e.BASIC=0]="BASIC",e[e.ELEMENT_COLLECTION=1]="ELEMENT_COLLECTION",e[e.EMBEDDED=2]="EMBEDDED",e[e.MANY_TO_MANY=3]="MANY_TO_MANY",e[e.MANY_TO_ONE=4]="MANY_TO_ONE",e[e.ONE_TO_MANY=5]="ONE_TO_MANY",e[e.ONE_TO_ONE=6]="ONE_TO_ONE"}(c||(c={}));const p=Symbol("AttachedState"),f=Symbol("AttachedSize");class g{constructor(e,t){this.isId=!1,this.isVersion=!1,this.isAcl=!1,this.order=null,this.accessor=null,this.declaringType=null,this.metadata=null,this.isMetadata=!!t,this.name=e}static attachState(e,t,r=!1){return void 0===t||!r&&void 0!==e[p]||Object.defineProperty(e,p,{value:t,configurable:!0}),e[p]}static attachSize(e,t){return void 0!==t&&Object.defineProperty(e,f,{value:t,configurable:!0}),e[f]||-1}get persistentAttributeType(){return-1}get isAssociation(){return this.persistentAttributeType>c.EMBEDDED}get isCollection(){return this.persistentAttributeType===c.ELEMENT_COLLECTION}init(e,t){if(this.declaringType)throw new Error("The attribute is already initialized.");this.order=t,this.accessor=new i.Accessor,this.declaringType=e}getValue(e){return this.accessor.getValue(e,this)}setValue(e,t){this.accessor.setValue(e,this,t)}hasMetadata(e){return!!this.metadata&&e in this.metadata}getMetadata(e){return this.hasMetadata(e)&&this.metadata[e]||null}toJSON(){return Object.assign({name:this.name,order:this.order},this.metadata&&{metadata:this.metadata})}}g.PersistentAttributeType=c;class y extends g{constructor(e,t,r){super(e,r),this.type=t}get typeConstructor(){return this.type.typeConstructor}get persistentAttributeType(){switch(this.type.persistenceType){case s.BASIC:return c.BASIC;case s.EMBEDDABLE:return c.EMBEDDED;case s.ENTITY:return c.ONE_TO_MANY;default:throw new Error("Unknown persistent attribute type.")}}getJsonValue(e,t,r){const s=g.attachState(t,{}),n=this.getValue(t),i=s[this.name]!==n;return r.persisting&&(s[this.name]=n),i&&e.setDirty(),this.type.toJsonValue(e,n,r)}setJsonValue(e,t,r,s){const n=this.type.fromJsonValue(e,r,this.getValue(t),s);if(s.persisting){g.attachState(t,{})[this.name]=n}this.setValue(t,n)}toJSON(){return Object.assign({type:this.type.ref},super.toJSON())}}var m;!function(e){e[e.COLLECTION=0]="COLLECTION",e[e.LIST=1]="LIST",e[e.MAP=2]="MAP",e[e.SET=3]="SET"}(m||(m={}));class b extends g{constructor(e,t,r){super(e),this.elementType=r,this.typeConstructor=t}get persistentAttributeType(){return c.ELEMENT_COLLECTION}keyValue(e){return String(e&&"object"==typeof e&&"id"in e?e.id:e)}}b.CollectionType=m;var O=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r};class w extends o{constructor(e,t,r){super(e,r),this.declaredId=null,this.declaredVersion=null,this.declaredAcl=null,this.loadPermission=new a.Permission,this.updatePermission=new a.Permission,this.deletePermission=new a.Permission,this.queryPermission=new a.Permission,this.schemaSubclassPermission=new a.Permission,this.insertPermission=new a.Permission,this.superType=t}get persistenceType(){return s.ENTITY}get id(){return this.declaredId||this.superType.id}get version(){return this.declaredVersion||this.superType.version}get acl(){return this.declaredAcl||this.superType.acl}createProxyClass(){let{typeConstructor:e}=this.superType;if(e===Object)switch(this.name){case"User":e=i.User;break;case"Role":e=i.Role;break;default:e=i.Entity}return this.enhancer.createProxy(e)}getReferencing(e,t){const r=Object.assign({},t),{entities:s}=e.metamodel,n=new Map,i=Object.keys(s);for(let e=0,t=i.length;e<t;e+=1){const t=i[e];if(!r.classes||-1!==r.classes.indexOf(t)){const e=s[t].attributes();for(let t=e.next();!t.done;t=e.next()){const e=t.value;if(e instanceof y&&e.type===this||e instanceof b&&e.elementType===this){const t=n.get(e.declaringType)||new Set;t.add(e.name),n.set(e.declaringType,t)}}}}return n}createObjectFactory(e){switch(this.name){case"User":return i.UserFactory.create(this,e);case"Device":return i.DeviceFactory.create(this,e);default:return i.EntityFactory.create(this,e)}}fromJsonValue(e,t,r,s){var n,i;if("string"==typeof t)return(null===(n=e.db)||void 0===n?void 0:n.getReference(t))||null;if(!t||"object"!=typeof t)return null;const o=t,c=Object.assign({persisting:!1,onlyMetadata:!1},s);let u;if(r){const e=a.Metadata.get(r);o.id&&e.id&&o.id!==e.id||(u=r)}if(u||(u=null===(i=e.db)||void 0===i?void 0:i.getReference(this.typeConstructor,o.id)),!u)return null;const d=a.Metadata.get(u);return d.enable(!1),super.fromJsonValue(d,o,u,c),d.enable(!0),c.persisting?d.setPersistent():c.onlyMetadata||d.setDirty(),u}toJsonValue(e,t,r){const{depth:s=0,persisting:n=!1}=r||{},i=!0===s||s>-1,o=t&&a.Metadata.get(t);if(i&&o&&o.isAvailable){o.enable(!1);const e=super.toJsonValue(o,t,Object.assign(Object.assign({},r),{persisting:n,depth:"boolean"==typeof s?s:s-1}));return o.enable(!0),e}return e.db&&t instanceof this.typeConstructor?(t.attach(e.db),t.id):null}toString(){return`EntityType(${this.ref})`}toJSON(){const e=super.toJSON(),{acl:t}=e,r=O(e,["acl"]);return Object.assign(Object.assign({},r),{acl:Object.assign(Object.assign({},t),{schemaSubclass:this.schemaSubclassPermission.toJSON(),load:this.loadPermission.toJSON(),insert:this.insertPermission.toJSON(),update:this.updatePermission.toJSON(),delete:this.deletePermission.toJSON(),query:this.queryPermission.toJSON()})})}}w.Object=class extends w{static get ref(){return"/db/Object"}constructor(){super(w.Object.ref,null,Object),this.declaredId=new class extends y{constructor(){super("id",l.String,!0)}getJsonValue(e){return e.id||void 0}setJsonValue(e,t,r){e.id||(e.id=r)}},this.declaredId.init(this,0),this.declaredId.isId=!0,this.declaredVersion=new class extends y{constructor(){super("version",l.Integer,!0)}getJsonValue(e){return e.version||void 0}setJsonValue(e,t,r){r&&(e.version=r)}},this.declaredVersion.init(this,1),this.declaredVersion.isVersion=!0,this.declaredAcl=new class extends y{constructor(){super("acl",l.JsonObject,!0)}getJsonValue(e,t,r){const s=g.attachState(t,{}),n=s.acl||{},i=e.acl.toJSON();return Object.keys(i).every(e=>{const t=n[e]||{},r=i[e],s=Object.keys(r),a=Object.keys(t);return s.length===a.length&&s.every(e=>t[e]===r[e])})||e.setDirty(),r.persisting&&(s.acl=i),i}setJsonValue(e,t,r,s){const n=r||{};if(s.persisting){g.attachState(t,{}).acl=n}e.acl.fromJSON(n)}},this.declaredAcl.init(this,2),this.declaredAcl.isAcl=!0,this.declaredAttributes=[this.declaredId,this.declaredVersion,this.declaredAcl]}createObjectFactory(){throw new Error("Objects can't be directly created and persisted")}};class E extends o{get persistenceType(){return s.EMBEDDABLE}createProxyClass(){return this.enhancer.createProxy(i.Managed)}createObjectFactory(e){return i.ManagedFactory.create(this,e)}fromJsonValue(e,t,r,s){let n=r;return t&&(n instanceof this.typeConstructor||(n=this.create())),super.fromJsonValue(e,t,n,s)}toString(){return`EmbeddableType(${this.ref})`}}class T extends b{static get ref(){return"/db/collection.List"}get collectionType(){return m.LIST}constructor(e,t){super(e,Array,t)}getJsonValue(e,t,r){const s=this.getValue(t);if(!(s instanceof this.typeConstructor))return null;const n=s.length,i=new Array(n),a=g.attachState(s),o=a||[];let c=!a||a.length!==n;const u=new Array(n);for(let t=0;t<n;t+=1){const n=s[t];u[t]=this.elementType.toJsonValue(e,n,r),i[t]=n,c=c||o[t]!==n}return r.persisting&&g.attachState(s,i,!0),c&&e.setDirty(),u}setJsonValue(e,t,r,s){let n=null;if(r){n=this.getValue(t);const i=r.length;n instanceof this.typeConstructor||(n=new this.typeConstructor(i));const a=new Array(i),o=g.attachState(n)||[];i<n.length&&n.splice(i,n.length-i);for(let t=0;t<i;t+=1){const i=this.elementType.fromJsonValue(e,r[t],o[t],s);n[t]=i,a[t]=i}s.persisting&&g.attachState(n,a,!0)}this.setValue(t,n)}toJSON(){return Object.assign({type:`${T.ref}[${this.elementType.ref}]`},super.toJSON())}}var S=r(5);class v extends b{constructor(e,t,r){super(e,Map,r),this.keyType=t}static get ref(){return"/db/collection.Map"}get collectionType(){return m.MAP}getJsonValue(e,t,r){const s=this.getValue(t);if(!(s instanceof this.typeConstructor))return null;const n={},i=g.attachState(s)||{};let a=g.attachSize(s)!==s.size;const o={},c=s.entries();for(let t=c.next();!t.done;t=c.next()){const s=t.value;if(null===s[0]||void 0===s[0])throw new S.PersistentError("Map keys can't be null nor undefined.");const c=this.keyValue(this.keyType.toJsonValue(e,s[0],r));o[c]=this.elementType.toJsonValue(e,s[1],r),n[c]=[s[0],s[1]],a=a||(i[c]||[])[1]!==s[1]}return r.persisting&&(g.attachState(s,n,!0),g.attachSize(s,s.size)),a&&e.setDirty(),o}setJsonValue(e,t,r,s){let n=null;if(r){n=this.getValue(t),n instanceof this.typeConstructor||(n=new this.typeConstructor);const i={},a=g.attachState(n)||{};n.clear();const o=Object.keys(r);for(let t=0,c=o.length;t<c;t+=1){const c=o[t],u=a[c]||[],d=this.keyType.fromJsonValue(e,c,u[0],s),h=this.elementType.fromJsonValue(e,r[c],u[1],s);i[c]=[d,h],n.set(d,h)}s.persisting&&(g.attachState(n,i,!0),g.attachSize(n,n.size))}this.setValue(t,n)}toJSON(){return Object.assign({type:`${v.ref}[${this.keyType.ref},${this.elementType.ref}]`},super.toJSON())}}class M extends b{static get ref(){return"/db/collection.Set"}get collectionType(){return m.SET}constructor(e,t){super(e,Set,t)}getJsonValue(e,t,r){const s=this.getValue(t);if(!(s instanceof this.typeConstructor))return null;const n={},i=g.attachState(s)||{};let a=g.attachSize(s)!==s.size;const o=[],c=s.values();for(let t=c.next();!t.done;t=c.next()){const s=t.value,c=this.elementType.toJsonValue(e,s,r);o.push(c);const u=this.keyValue(c);n[u]=s,a=a||i[u]!==s}return r.persisting&&(g.attachState(s,n,!0),g.attachSize(s,s.size)),a&&e.setDirty(),o}setJsonValue(e,t,r,s){let n=null;if(r){n=this.getValue(t),n instanceof this.typeConstructor||(n=new this.typeConstructor);const i={},a=g.attachState(n)||{};n.clear();for(let t=0,o=r.length;t<o;t+=1){const o=r[t],c=this.keyValue(o),u=this.elementType.fromJsonValue(e,o,a[c],s);n.add(u),i[c]=u}s.persisting&&(g.attachState(n,i,!0),g.attachSize(n,n.size))}this.setValue(t,n)}toJSON(){return Object.assign({type:`${M.ref}[${this.elementType.ref}]`},super.toJSON())}}class A{constructor(){this.models={},this.modelDescriptors=null,Object.keys(l).forEach(e=>{const t=l[e];t instanceof l&&(this.models[t.ref]=t)})}getModel(e){if(e in this.models)return this.models[e];const t=this.buildModel(e);return this.models[e]=t,t}buildModels(e){return this.modelDescriptors={},e.forEach(e=>{this.modelDescriptors[e.class]=e}),Object.keys(this.modelDescriptors).forEach(e=>{try{const t=this.getModel(e);this.buildAttributes(t)}catch(t){throw new S.PersistentError("Can't create model for entity class "+e,t)}}),this.getModel(w.Object.ref),this.models}buildModel(e){const t=this.modelDescriptors[e];let r;if(e===w.Object.ref)r=new w.Object;else{if(!t)throw new TypeError("No model available for "+e);if(t.embedded)r=new E(e);else{const s=t.superClass||w.Object.ref;r=new w(e,this.getModel(s))}}if(r.metadata={},t){r.metadata=t.metadata||{};const e=t.acl||{};Object.keys(e).forEach(t=>{r[t+"Permission"].fromJSON(e[t])})}return r}buildAttributes(e){const t=this.modelDescriptors[e.ref],r=t.fields;Object.keys(r).forEach(t=>{const s=r[t];e.getAttribute(t)||e.addAttribute(this.buildAttribute(s),s.order)}),"string"==typeof t.validationCode&&(e.validationCode=a.Validator.compile(e,t.validationCode))}buildAttribute(e){const t=e.flags&&(-1!==e.flags.indexOf("METADATA")||-1!==e.flags.indexOf("READONLY")),{name:r}=e,s=e.type;if(0!==s.indexOf("/db/collection.")){const n=new y(r,this.getModel(s),t);return n.metadata=e.metadata,n}const n=s.substring(0,s.indexOf("[")),i=s.substring(s.indexOf("[")+1,s.indexOf("]")).trim();switch(n){case T.ref:return new T(r,this.getModel(i));case M.ref:return new M(r,this.getModel(i));case v.ref:{const e=i.substring(0,i.indexOf(",")).trim(),t=i.substring(i.indexOf(",")+1).trim();return new v(r,this.getModel(e),this.getModel(t))}default:throw new TypeError("No collection available for "+s)}}}class k{constructor(e,t){if("string"==typeof e){const t={};t[e]=k.ASC,this.keys=[t]}else if(Array.isArray(e))this.keys=e;else{if(!e)throw new Error("The keys parameter must be an String, Object or Array.");this.keys=[e]}this.unique=!0===t}static fromJSON(e){return new k(e.keys,e.unique)}hasKey(e){for(let t=0;t<this.keys.length;t+=1)if(this.keys[t][e])return!0;return!1}get isCompound(){return this.keys.length>1}get isUnique(){return this.unique}toJSON(){return{unique:this.unique,keys:this.keys}}}k.ASC="asc",k.DESC="desc";var P=r(4),_=r(0),C=r(2);class x extends P.Lockable{constructor(e){super(),this.isInitialized=!1,this.entities={},this.embeddables={},this.baseTypes={},this.enhancer=new i.Enhancer,this.entityManagerFactory=e}init(e){if(this.isInitialized)throw new Error("Metamodel is already initialized.");this.fromJSON(e||[]),this.isInitialized=!0}getRef(e){let t;return"string"==typeof e?(t=e,0!==t.indexOf("/db/")&&(t="/db/"+e)):t=i.Enhancer.getIdentifier(e),t}entity(e){const t=this.getRef(e);return t?this.entities[t]:null}baseType(e){let t=null;if("string"==typeof e)t=this.getRef(e);else{const r=Object.keys(this.baseTypes);for(let s=0,n=r.length;s<n;s+=1){const n=r[s],i=this.baseTypes[n];if(!i.noResolving&&i.typeConstructor===e){t=n;break}}}return t?this.baseTypes[t]:null}embeddable(e){const t=this.getRef(e);return t?this.embeddables[t]:null}managedType(e){return this.entity(e)||this.embeddable(e)}addType(e){let t={};if(e.isBasic)t=this.baseTypes;else if(e.isEmbeddable)e.init(this.enhancer),t=this.embeddables;else if(e.isEntity){const r=e;r.init(this.enhancer),t=this.entities,null===r.superType&&r.ref!==w.Object.ref&&(r.superType=this.entity(w.Object.ref))}if(t[e.ref])throw new Error(`The type ${e.ref} is already declared.`);return t[e.ref]=e,e}load(){if(!this.isInitialized)return this.withLock(()=>{const e=new C.GetAllSchemas;return this.entityManagerFactory.send(e).then(e=>(this.init(e.entity),this))});throw new Error("Metamodel is already initialized.")}save(e){return this.sendUpdate(e||this.toJSON()).then(()=>this)}update(e){return this.sendUpdate(e).then(e=>(this.fromJSON(e.entity),this))}sendUpdate(e){return this.withLock(()=>{let t;return t=e instanceof o?new C.UpdateSchema(e.name,e.toJSON()):new C.UpdateAllSchemas(e),this.entityManagerFactory.send(t)})}toJSON(){if(!this.isInitialized)throw new Error("Metamodel is not initialized.");return[].concat(Object.keys(this.entities).map(e=>this.entities[e].toJSON()),Object.keys(this.embeddables).map(e=>this.embeddables[e].toJSON()))}fromJSON(e){const t=(new A).buildModels(e);this.baseTypes={},this.embeddables={},this.entities={},Object.keys(t).forEach(e=>this.addType(t[e]))}createIndex(e,t){const r=new C.CreateDropIndex(e,Object.assign(Object.assign({},t.toJSON()),{drop:!1}));return this.entityManagerFactory.send(r)}dropIndex(e,t){const r=new C.CreateDropIndex(e,Object.assign(Object.assign({},t.toJSON()),{drop:!0}));return this.entityManagerFactory.send(r)}dropAllIndexes(e){const t=new C.DropAllIndexes(e);return this.entityManagerFactory.send(t)}getIndexes(e){const t=new C.ListIndexes(e);return this.entityManagerFactory.send(t).then(e=>e.entity.map(e=>new k(e.keys,e.unique))).catch(e=>{if(e.status===_.StatusCode.BUCKET_NOT_FOUND||e.status===_.StatusCode.OBJECT_NOT_FOUND)return null;throw e})}}class N extends b{get collectionType(){return m.COLLECTION}constructor(e,t,r){super(e,t,r),super(e,t,r)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r(15);class n{constructor(){this.read=new s.a,this.write=new s.a}clear(){this.read.clear(),this.write.clear()}copy(e){return this.read.copy(e.read),this.write.copy(e.write),this}isPublicReadAllowed(){return this.read.isPublicAllowed()}setPublicReadAllowed(){return this.read.setPublicAllowed()}isReadAllowed(e){return this.read.isAllowed(e)}isReadDenied(e){return this.read.isDenied(e)}allowReadAccess(...e){return this.read.allowAccess(...e),this}denyReadAccess(...e){return this.read.denyAccess(...e),this}deleteReadAccess(...e){return this.read.deleteAccess(...e),this}isPublicWriteAllowed(){return this.write.isPublicAllowed()}setPublicWriteAllowed(){return this.write.setPublicAllowed()}isWriteAllowed(e){return this.write.isAllowed(e)}isWriteDenied(e){return this.write.isDenied(e)}allowWriteAccess(...e){return this.write.allowAccess(...e),this}denyWriteAccess(...e){return this.write.denyAccess(...e),this}deleteWriteAccess(...e){return this.write.deleteAccess(...e),this}toJSON(){return{read:this.read.toJSON(),write:this.write.toJSON()}}fromJSON(e){this.read.fromJSON(e.read||{}),this.write.fromJSON(e.write||{})}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));class s{constructor(e,t){let r,s;if("string"==typeof e){const t=e.indexOf(";");r=Number(e.substring(0,t)),s=Number(e.substring(t+1))}else Array.isArray(e)?[r,s]=e:"object"==typeof e?(r=e.latitude,s=e.longitude):(r="number"==typeof e?e:0,s="number"==typeof t?t:0);if(this.longitude=s,this.latitude=r,this.latitude<-90||this.latitude>90)throw new Error(`Latitude ${this.latitude} is not in bound of -90 <= latitude <= 90`);if(this.longitude<-180||this.longitude>180)throw new Error(`Longitude ${this.longitude} is not in bound of -180 <= longitude <= 180`)}static current(){return new Promise((e,t)=>{navigator||t(new Error("This seems not to be a browser context.")),navigator.geolocation||t(new Error("This browser does not support geolocation.")),navigator.geolocation.getCurrentPosition(t=>{e(new s(t.coords.latitude,t.coords.longitude))},e=>{t(e)})})}kilometersTo(e){return Number((s.EARTH_RADIUS_IN_KILOMETERS*this.radiansTo(e)).toFixed(3))}milesTo(e){return Number((s.EARTH_RADIUS_IN_MILES*this.radiansTo(e)).toFixed(3))}radiansTo(e){const t=e,r=this.latitude*s.DEG_TO_RAD,n=t.latitude*s.DEG_TO_RAD,i=(t.longitude-this.longitude)*s.DEG_TO_RAD;return Math.acos(Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos(i))}toString(){return`${this.latitude};${this.longitude}`}toJSON(){return{latitude:this.latitude,longitude:this.longitude}}}s.DEG_TO_RAD=Math.PI/180,s.EARTH_RADIUS_IN_KILOMETERS=6371,s.EARTH_RADIUS_IN_MILES=3956},function(e,t,r){"use strict";r.r(t),r.d(t,"db",(function(){return n}));var s=r(11);const n=(()=>{const e=new s.a,t=e.createEntityManager(!0);return Object.assign(t,{configure(t){return e.configure(t),this},connect(t,r,s,n){return r instanceof Function?this.connect(t,void 0,r,s):(e.connect(t,r),this.ready(s,n))}}),t})()},function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var s=r(2),n=r(3),i=r(4),a=r(0),o=r(14),c=r(8),u=r(12),d=r(5),h=r(6),l=r(1),p=function(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},f=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r};class g extends i.Lockable{constructor(e){super(),this.List=Array,this.Set=Set,this.Map=Map,this.GeoPoint=c.a,this.log=l.Logger.create(this),this.connection=null,this.entities={},this.modules=new l.Modules(this),this.me=null,this.deviceMe=null,this.tokenStorage=null,this.bloomFilter=null,this.cacheWhiteList=null,this.cacheBlackList=null,this.bloomFilterRefresh=60,this.bloomFilterLock=new i.Lockable,this.File=null,this.entityManagerFactory=e,this.metamodel=e.metamodel,this.code=e.code}get isOpen(){return!!this.connection}get token(){return this.tokenStorage.token}get isCachingDisabled(){return!this.isCachingEnabled()}isCachingEnabled(){return!!this.bloomFilter}get isDeviceRegistered(){return!!this.deviceMe}set token(e){this.tokenStorage.update(e)}connected(e,t,r){this.connection=e,this.tokenStorage=r,this.bloomFilterRefresh=this.entityManagerFactory.staleness,this.File=n.FileFactory.create(this),this._createObjectFactory(this.metamodel.embeddables),this._createObjectFactory(this.metamodel.entities),t&&(t.device&&this._updateDevice(t.device),t.user&&r.token&&this._updateUser(t.user,!0),this.bloomFilterRefresh>0&&t.bloomFilter&&i.atob&&!i.isNode&&this._updateBloomFilter(t.bloomFilter))}_createObjectFactory(e){const t=Object.values(e);for(let e=0;e<t.length;e+=1){const r=t[e],{name:s}=r;this[s]?(r.typeConstructor=this[s],Object.defineProperty(this,s,{value:r.createObjectFactory(this)})):Object.defineProperty(this,s,{get(){return Object.defineProperty(this,s,{value:r.createObjectFactory(this)}),this[s]},set(e){r.typeConstructor=e},configurable:!0})}}send(e,t=!0){if(!this.connection)throw new Error("This EntityManager is not connected.");const r=e;r.tokenStorage(this.tokenStorage);let s=this.connection.send(r);return t||(s=s.catch(e=>{throw e.status===a.StatusCode.BAD_CREDENTIALS&&this._logout(),e})),s}getReference(e,t){let r,s=null;if(t){const n=t;r=this.metamodel.entity(e),s=0===n.indexOf("/db/")?n:`${r.ref}/${encodeURIComponent(n)}`}else if("string"==typeof e){const t=e.indexOf("/","/db/".length);-1!==t&&(s=e),r=this.metamodel.entity(-1!==t?e.substring(0,t):e)}else r=this.metamodel.entity(e);let n=this.entities[s];if(!n){n=r.create();const e=l.Metadata.get(n);s&&(e.id=s),e.setUnavailable(),this._attach(n)}return n}createQueryBuilder(e){return new u.Builder(this,e)}clear(){this.entities={}}close(){return this.connection=null,this.clear()}contains(e){return!!e&&!!e.id&&this.entities[e.id]===e}containsById(e){return!!(e&&e.id&&this.entities[e.id])}detach(e){return l.Metadata.get(e).withLock(()=>(this.removeReference(e),Promise.resolve(e)))}resolveDepth(e,t){if(!t||!t.depth)return Promise.resolve(e);const r=t.resolved||[],s=[],n=Object.assign(Object.assign({},t),{resolved:r,depth:!0===t.depth||t.depth-1});return this.getSubEntities(e,1).forEach(e=>{null!==e&&-1===r.indexOf(e)&&e.id&&(r.push(e),s.push(this.load(e.id,void 0,n)))}),Promise.all(s).then(()=>e)}load(e,t,r){const n=r||{},i=this.getReference(e,t),o=l.Metadata.get(i);if(!n.refresh&&n.local&&o.isAvailable)return this.resolveDepth(i,n);const c=new s.GetObject(o.bucket,o.key);return this.ensureCacheHeader(i.id,c,n.refresh),this.send(c).then(r=>i.version&&i.version>r.entity.version?(n.refresh=!0,this.load(e,t,n)):(this.addToWhiteList(r.entity.id),r.status!==a.StatusCode.NOT_MODIFIED&&o.type.fromJsonValue(o,r.entity,i,{persisting:!0}),this.resolveDepth(i,n)),e=>{if(e.status===a.StatusCode.OBJECT_NOT_FOUND)return this.removeReference(i),o.setRemoved(),null;throw e})}insert(e,t){const r=t||{};let n;return this._save(e,r,(e,t)=>{if(e.version)throw new d.PersistentError("Existing objects can't be inserted.");return n=!e.id,new s.CreateObject(e.bucket,t)}).then(t=>(n&&this._attach(e),t))}update(e,t){const r=t||{};return this._save(e,r,(e,t)=>{if(!e.version)throw new d.PersistentError("New objects can't be inserted.");if(r.force){const{version:r}=t,n=f(t,["version"]);return new s.ReplaceObject(e.bucket,e.key,n).ifMatch("*")}return new s.ReplaceObject(e.bucket,e.key,t).ifMatch(""+e.version)})}save(e,t,r=!1){const n=t||{},i=(e,t)=>{if(n.force){if(!e.id)throw new d.PersistentError("New special objects can't be forcefully saved.");const{version:r}=t,n=f(t,["version"]);return new s.ReplaceObject(e.bucket,e.key,n)}return e.version?new s.ReplaceObject(e.bucket,e.key,t).ifMatch(e.version):new s.CreateObject(e.bucket,t)};return r?this._locklessSave(e,n,i):this._save(e,n,i)}optimisticSave(e,t){return l.Metadata.get(e).withLock(()=>this._optimisticSave(e,t))}_optimisticSave(e,t){let r=!1;const s=Promise.resolve(t(e,()=>{r=!0}));return r?Promise.resolve(e):s.then(()=>this.save(e,{},!0).catch(r=>{if(412===r.status)return this.refresh(e,{}).then(()=>this._optimisticSave(e,t));throw r}))}_locklessSave(e,t,r){this.attach(e);const s=l.Metadata.get(e);let n,i;if(s.isAvailable&&(i=s.type.toJsonValue(s,e,{persisting:!0})),s.isDirty){t.refresh||s.setPersistent();const o=this.send(r(s,i)).then(r=>(s.id&&s.id!==r.entity.id&&(this.removeReference(e),s.id=r.entity.id,this._attach(e)),s.type.fromJsonValue(s,r.entity,e,{persisting:t.refresh,onlyMetadata:!t.refresh}),e),t=>{if(t.status===a.StatusCode.OBJECT_NOT_FOUND)return this.removeReference(e),s.setRemoved(),null;throw s.setDirty(),t});n=[o]}else n=[Promise.resolve(e)];const o=Object.assign({},t);return o.depth=0,this.getSubEntities(e,t.depth).forEach(e=>{n.push(this._save(e,o,r))}),Promise.all(n).then(()=>e)}_save(e,t,r){this.ensureBloomFilterFreshness();const s=l.Metadata.get(e);return s.version&&this.addToBlackList(e.id),s.withLock(()=>this._locklessSave(e,t,r))}getSubEntities(e,t,r=[],s){if(!t)return r;const n=s||e,i=l.Metadata.get(e).type.references();for(let s=i.next();!s.done;s=i.next()){const{value:i}=s,a=this.getSubEntitiesByPath(e,i.path);for(let e=0,s=a.length;e<s;e+=1){const s=a[e];-1===r.indexOf(s)&&s!==n&&(r.push(s),this.getSubEntities(s,!0===t?t:t-1,r,n))}}return r}getSubEntitiesByPath(e,t){let r=[e];return t.forEach(e=>{const t=[];r.forEach(r=>{const s=r[e];if(!s)return;const n=this.metamodel.managedType(r.constructor).getAttribute(e);if(n instanceof h.PluralAttribute){const e=s.entries();for(let r=e.next();!r.done;r=e.next()){const e=r.value;t.push(e[1]),n instanceof h.MapAttribute&&n.keyType.isEntity&&t.push(e[0])}}else t.push(s)}),r=t}),r}delete(e,t){const r=t||{};this.attach(e);const n=l.Metadata.get(e);return n.withLock(()=>{if(!n.version&&!r.force)throw new d.IllegalEntityError(e);const t=new s.DeleteObject(n.bucket,n.key);this.addToBlackList(e.id),r.force||t.ifMatch(""+n.version);const i=[this.send(t).then(()=>(this.removeReference(e),n.setRemoved(),e))],a=Object.assign({},r);return a.depth=0,this.getSubEntities(e,r.depth).forEach(e=>{i.push(this.delete(e,a))}),Promise.all(i).then(()=>e)})}flush(){throw new Error("Not implemented.")}persist(e){this.attach(e)}refresh(e,t){return e.id?this.load(e.id,void 0,Object.assign(Object.assign({},t),{refresh:!0})):Promise.resolve(e)}attach(e){if(!this.contains(e)){if(!this.metamodel.entity(e.constructor))throw new d.IllegalEntityError(e);if(this.containsById(e))throw new d.EntityExistsError(e);this._attach(e)}}_attach(e){const t=l.Metadata.get(e);if(t.isAttached){if(t.db!==this)throw new d.EntityExistsError(e)}else t.db=this;t.id||"User"!==t.type.name&&"Role"!==t.type.name&&"logs.AppLog"!==t.type.name&&(t.id=`${"/db/"+t.type.name}/${Object(i.uuid)()}`),t.id&&(this.entities[t.id]=e)}removeReference(e){const t=l.Metadata.get(e);if(!t||!t.id)throw new d.IllegalEntityError(e);delete this.entities[t.id]}register(e,t,r){const i=r>n.LoginOption.NO_LOGIN;if(this.me&&i)throw new d.PersistentError("User is already logged in.");return this.withLock(()=>{const n=new s.Register({user:e,password:t,login:i});return this._userRequest(n,r)})}login(e,t,r){if(this.me)throw new d.PersistentError("User is already logged in.");return this.withLock(()=>{const n=new s.Login({username:e,password:t});return this._userRequest(n,r)})}logout(){return this.withLock(()=>this.send(new s.Logout).then(this._logout.bind(this)))}loginWithOAuth(e,t,r){if(!this.connection)throw new Error("This EntityManager is not connected.");if(this.me)throw new d.PersistentError("User is already logged in.");const s=Object.assign({title:"Login with "+e,timeout:3e5,state:{},loginOption:!0},r);let n;if(s.redirect&&Object.assign(s.state,{redirect:s.redirect,loginOption:s.loginOption}),!a.OAuthMessages[e])throw new Error(`OAuth provider ${e} not supported.`);n=new a.OAuthMessages[e](t,s.scope,JSON.stringify(s.state)),n.addRedirectOrigin(this.connection.origin+this.connection.basePath),s.path&&n.path(s.path);const i={width:""+s.width,height:""+s.height};if(s.redirect){const e=-1!==document.URL.indexOf("http://")||-1!==document.URL.indexOf("https://");return this.openOAuthWindow(n.request.path,e?"_self":"_system",i),new Promise(()=>{})}const o=this._userRequest(n,s.loginOption);return this.openOAuthWindow(n.request.path,s.title,i),new Promise((e,t)=>{const r=setTimeout(()=>{t(new d.PersistentError("OAuth login timeout."))},s.timeout);o.then(e,t).then(()=>{clearTimeout(r)})})}openOAuthWindow(e,t,r){const s=Object.keys(r).filter(e=>void 0!==r[e]).map(e=>`${e}=${r[e]}`).join(",");open(e,t,s)}renew(e){return this.withLock(()=>{const t=new s.Me;return this._userRequest(t,e)})}newPassword(e,t,r){return this.withLock(()=>{const n=new s.NewPassword({username:e,password:t,newPassword:r});return this.send(n,!0).then(e=>this._updateUser(e.entity))})}newPasswordWithToken(e,t,r){return this.withLock(()=>this._userRequest(new s.NewPassword({token:e,newPassword:t}),r))}resetPassword(e){return this.send(new s.ResetPassword({username:e}))}changeUsername(e,t,r){return this.send(new s.ChangeUsername({username:e,newUsername:t,password:r}))}_updateUser(e,t=!1){const r=this.getReference(e.id),s=l.Metadata.get(r);return s.type.fromJsonValue(s,e,r,{persisting:!0}),t&&(this.me=r),r}_logout(){this.me=null,this.token=null}_userRequest(e,t){const r=void 0===t||t,s=r>n.LoginOption.NO_LOGIN;return s&&(this.tokenStorage.temporary=r<n.LoginOption.PERSIST_LOGIN),this.send(e,!s).then(e=>e.entity?this._updateUser(e.entity,s):null,e=>{if(e.status===a.StatusCode.OBJECT_NOT_FOUND)return s&&this._logout(),null;throw e})}registerDevice(e,t,r){const n=new s.DeviceRegister({devicetype:e,subscription:t,device:r});return n.withCredentials=!0,this.send(n).then(e=>this._updateDevice(e.entity))}_updateDevice(e){const t=this.getReference(e.id),r=l.Metadata.get(t);return r.type.fromJsonValue(r,e,t,{persisting:!0}),this.deviceMe=t,t}checkDeviceRegistration(){return this.send(new s.DeviceRegistered).then(()=>!0,e=>{if(e.status===a.StatusCode.OBJECT_NOT_FOUND)return!1;throw e})}pushDevice(e){return this.send(new s.DevicePush(e.toJSON()))}validate(e){const{type:t}=l.Metadata.get(e),r=new l.ValidationResult,s=t.attributes();for(let t=s.next();!t.done;t=s.next()){const s=new l.Validator(t.value.name,e);r.fields[s.key]=s}const{validationCode:n}=t;return n&&n(r.fields),r}addToWhiteList(e){this.isCachingEnabled()&&(this.bloomFilter.contains(e)&&this.cacheWhiteList.add(e),this.cacheBlackList.delete(e))}addToBlackList(e){this.isCachingEnabled()&&e&&(this.bloomFilter.contains(e)||this.cacheBlackList.add(e),this.cacheWhiteList.delete(e))}refreshBloomFilter(){if(!this.isCachingEnabled())return Promise.resolve(null);const e=new s.GetBloomFilter;return e.noCache(),this.send(e).then(e=>(this._updateBloomFilter(e.entity),this.bloomFilter))}_updateBloomFilter(e){this.bloomFilter=new o.BloomFilter(e),this.cacheWhiteList=new Set,this.cacheBlackList=new Set}ensureBloomFilterFreshness(){if(!this.isCachingEnabled())return;const e=(new Date).getTime(),t=1e3*this.bloomFilterRefresh;this.bloomFilterLock.isReady&&e-this.bloomFilter.creation>t&&this.bloomFilterLock.withLock(()=>this.refreshBloomFilter())}mustRevalidate(e){return!i.isNode&&(this.ensureBloomFilterFreshness(),!this.isCachingEnabled()||!this.bloomFilterLock.isReady||!this.cacheWhiteList.has(e)&&(this.cacheBlackList.has(e)||this.bloomFilter.contains(e)))}ensureCacheHeader(e,t,r){(r||!e||this.mustRevalidate(e))&&t.noCache()}createURL(e,t){const{connection:r}=this;if(!r)throw new Error("This EntityManager is not connected.");return this.tokenStorage.signPath(r.basePath+e,t).then(s=>{let n=r.origin+s;return this.mustRevalidate(e)&&(n+=(t?"&":"?")+"BCB"),n})}requestAPIToken(e,t){const r=this._getUserReference(e,t),n=new s.UserToken(r.key);return this.send(n).then(e=>e.entity)}revokeAllTokens(e,t){const r=this._getUserReference(e,t),n=new s.RevokeUserToken(r.key);return this.send(n)}_getUserReference(e,t){return"string"==typeof t?this.getReference(e,t):t}}p([Object(i.deprecated)("EntityManager.isCachingEnabled()")],g.prototype,"isCachingDisabled",null)},function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var s=r(10),n=r(2),i=r(0),a=r(4),o=r(1),c=r(6);const u=Symbol("Connected"),d=Symbol("WebSocket");class h extends a.Lockable{constructor(e={}){super(),this.connection=null,this.metamodel=this.createMetamodel(),this.code=new o.Code(this.metamodel,this),this.tokenStorageFactory=o.TokenStorage.WEB_STORAGE||o.TokenStorage.GLOBAL,this.tokenStorage=null,this.staleness=null;const t="string"==typeof e?{host:e}:e||{};this.configure(t);let r=!0,s=new Promise(e=>{this[u]=e});t.host?this.connect(t.host,t.port,t.secure,t.basePath):r=!1,this.tokenStorage||(r=!1,s=s.then(()=>this.tokenStorageFactory.create(this.connection.origin)).then(e=>{this.tokenStorage=e})),t.schema?(this.connectData=t,this.metamodel.init(t.schema)):(r=!1,s=s.then(()=>{const e=new n.Connect;return e.withCredentials=!0,0===this.staleness&&e.noCache(),this.send(e)}).then(e=>{this.connectData=e.entity,null===this.staleness&&(this.staleness=this.connectData.bloomFilterRefresh||60),this.metamodel.isInitialized||this.metamodel.init(this.connectData.schema),this.tokenStorage.update(this.connectData.token)})),r||this.withLock(()=>s,!0)}get websocket(){if(!this[d]){const{secure:e}=this.connection;let t;t=this.connectData.websocket?(e?"wss:":"ws:")+this.connectData.websocket:this.connection.origin.replace(/^http/,"ws")+this.connection.basePath+"/events",this[d]=i.WebSocketConnector.create(t)}return this[d]}configure(e){if(this.connection)throw new Error("The EntityManagerFactory can only be configured before is is connected.");e.tokenStorage&&(this.tokenStorage=e.tokenStorage),e.tokenStorageFactory&&(this.tokenStorageFactory=e.tokenStorageFactory),void 0!==e.staleness&&(this.staleness=e.staleness)}connect(e,t,r,s){if(this.connection)throw new Error("The EntityManagerFactory is already connected.");return"boolean"==typeof t?this.connect(e,0,t,r):(this.connection=i.Connector.create(e,t,r,s),this[u](),this.ready())}createMetamodel(){return new c.Metamodel(this)}createEntityManager(e){const t=new s.a(this);return this.isReady?t.connected(this.connection,this.connectData,e?this.tokenStorage:new o.TokenStorage(this.connection.origin)):t.withLock(()=>this.ready().then(()=>{t.connected(this.connection,this.connectData,e?this.tokenStorage:new o.TokenStorage(this.connection.origin))}),!0),t}send(e){return e.tokenStorage()||e.tokenStorage(this.tokenStorage),this.connection.send(e)}}},function(e,t,r){"use strict";r.r(t),r.d(t,"Builder",(function(){return y})),r.d(t,"Condition",(function(){return p})),r.d(t,"Filter",(function(){return f})),r.d(t,"Node",(function(){return l})),r.d(t,"Operator",(function(){return g})),r.d(t,"flatArgs",(function(){return i})),r.d(t,"Query",(function(){return n})),r.d(t,"Stream",(function(){return h}));var s=r(3);class n{constructor(e,t){this.entityManager=e,this.resultClass=t}ascending(e){return this.addOrder(e,1)}descending(e){return this.addOrder(e,-1)}sort(e){if("object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype)throw new Error("sort must be an object.");return this.addOrder(e)}offset(e){if(e<0)throw new Error("The offset can't be nagative.");return this.addOffset(e)}limit(e){if(e<0)throw new Error("The limit can't be nagative.");return this.addLimit(e)}}function i(e){return Array.prototype.concat.apply([],e)}n.MAX_URI_SIZE=2e3;var a=r(2),o=r(1),c=r(16),u=r(4),d=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r};class h{static createEventStream(e,t,r){const s=r||{};return s.reconnects=0,h.streamObservable(e,t,s,(r,s)=>{const{type:n}=r,i=d(r,["type"]);"result"===r.type&&r.data.forEach((r,n)=>{const a=Object.assign(Object.assign(Object.assign({matchType:"add",operation:"none",initial:!0},i),{data:h.resolveObject(e,r)}),t.sort&&{index:n});s(a)}),"match"===r.type&&s(Object.assign(Object.assign({initial:!1},i),{data:h.resolveObject(e,r.data)}))})}static createResultStream(e,t,r){const s=r||{};let n;s.initial=!0,s.matchTypes="all",s.operations="any";const i=!!t.sort;return h.streamObservable(e,t,s,(t,r)=>{if("result"===t.type&&(n=t.data.map(t=>h.resolveObject(e,t)),r(n.slice())),"match"===t.type){const s=h.resolveObject(e,t.data);if("remove"===t.matchType||"changeIndex"===t.matchType)for(let e=0,r=n.length;e<r;e+=1)if(n[e].id===t.data.id){n.splice(e,1);break}"add"!==t.matchType&&"changeIndex"!==t.matchType||(i?n.splice(t.index,0,s):n.push(s)),r(n.slice())}})}static streamObservable(e,t,r,s){const n=h.parseOptions(r),i=e.entityManagerFactory.websocket,a=new c.a(r=>{const a=Object(u.uuid)(),o=i.openStream(e.tokenStorage,a);o.send(Object.assign(Object.assign({type:"subscribe"},t),n));let c=!1;const d=r.next.bind(r),h=o.subscribe({complete(){c=!0,r.complete()},error(e){c=!0,r.error(e)},next(e){s(e,d)}});return()=>{c||(o.send({type:"unsubscribe"}),h.unsubscribe(),c=!0)}});return h.cachedObservable(a,n)}static cachedObservable(e,t){let r=null;const s=[];return new c.a(n=>{if(!r){let n=t.reconnects,i=1;const a={next(e){i=1,s.forEach(t=>t.next(e))},error(e){s.forEach(t=>t.error(e))},complete(){0!==n?(n=n<0?-1:n-1,setTimeout(()=>{r=e.subscribe(a)},1e3*i),i*=2):s.forEach(e=>e.complete())}};r=e.subscribe(a)}return s.push(n),()=>{s.splice(s.indexOf(n),1),!s.length&&r&&(r.unsubscribe(),r=null)}})}static parseOptions(e){const t=e||{},r={initial:void 0===t.initial||!!t.initial,matchTypes:h.normalizeMatchTypes(t.matchTypes),operations:h.normalizeOperations(t.operations),reconnects:h.normalizeReconnects(t.reconnects)};if(-1===r.matchTypes.indexOf("all")&&-1===r.operations.indexOf("any"))throw new Error("Only subscriptions for either operations or matchTypes are allowed. You cannot subscribe to a query using matchTypes and operations at the same time!");return r}static normalizeMatchTypes(e){return h.normalizeSortedSet(e,"all","match types",["add","change","changeIndex","match","remove"])}static normalizeReconnects(e){return void 0===e||e<0?-1:Number(e)}static normalizeOperations(e){return h.normalizeSortedSet(e,"any","operations",["delete","insert","none","update"])}static normalizeSortedSet(e,t,r,s){if(!e)return[t];const n=Array.isArray(e)?e:[e];if(0===n.length)return[t];let i;n.sort();let a=null;for(let e=n.length-1;e>=0;e-=1){if(i=n[e],!i)throw new Error("undefined and null not allowed!");if(i===a&&n.splice(e,1),i===t)return[t];if(-1===s.indexOf(i))throw new Error(`${i} not allowed for ${r}! (permitted: ${s}.)`);a=i}return n}static resolveObject(e,t){const r=e.getReference(t.id),s=o.Metadata.get(r);return t.version?r.version<=t.version&&s.type.fromJsonValue(s,t,r,{persisting:!0}):(s.setRemoved(),e.removeReference(r)),r}}class l extends n{constructor(){super(...arguments),this.firstResult=0,this.maxResults=-1,this.order={}}eventStream(e,t,r,s){if(e instanceof Function)return this.eventStream({},e,t,r);const n=h.createEventStream(this.entityManager,this.createRealTimeQuery(),e);return t instanceof Function?n.subscribe(t,r,s):n}resultStream(e,t,r,s){if(e instanceof Function)return this.resultStream({},e,t,r);const n=h.createResultStream(this.entityManager,this.createRealTimeQuery(),e);return t instanceof Function?n.subscribe(t,r,s):n}resultList(e,t,r){var s;if(e instanceof Function)return this.resultList({},e,t);const i=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!i)throw new Error("Only typed queries can be executed.");const o=this.serializeQuery(),c=this.serializeSort();let u;return u=((null===(s=this.entityManager.connection)||void 0===s?void 0:s.host.length)||0)+o.length+c.length>n.MAX_URI_SIZE?new a.AdhocQueryPOST(i.name,this.firstResult,this.maxResults,c).entity(o,"text"):new a.AdhocQuery(i.name,o,this.firstResult,this.maxResults,c),this.entityManager.send(u).then(t=>this.createResultList(t.entity,e)).then(t,r)}singleResult(e,t,r){var s;if(e instanceof Function)return this.singleResult({},e,t);const i=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!i)throw new Error("Only typed queries can be executed.");const o=this.serializeQuery(),c=this.serializeSort();let u;return u=((null===(s=this.entityManager.connection)||void 0===s?void 0:s.host.length)||0)+o.length>n.MAX_URI_SIZE?new a.AdhocQueryPOST(i.name,this.firstResult,1,c).entity(o,"text"):new a.AdhocQuery(i.name,o,this.firstResult,1,c),this.entityManager.send(u).then(t=>this.createResultList(t.entity,e)).then(e=>e.length?e[0]:null).then(t,r)}count(e,t){var r;const s=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!s)throw new Error("Only typed queries can be executed.");const i=this.serializeQuery();let o;return o=((null===(r=this.entityManager.connection)||void 0===r?void 0:r.host.length)||0)+i.length>n.MAX_URI_SIZE?new a.AdhocCountQueryPOST(s.name).entity(i,"text"):new a.AdhocCountQuery(s.name,i),this.entityManager.send(o).then(e=>e.entity.count).then(e,t)}serializeQuery(){return JSON.stringify(this,(function(e,t){const r=this[e];return r instanceof Date?{$date:t}:r instanceof s.Entity?r.id:t}))}serializeSort(){return JSON.stringify(this.order)}createResultList(e,t){return e.length?Promise.all(e.map(e=>{if(e.id){const r=this.entityManager.getReference(this.resultClass,e.id),s=o.Metadata.get(r);return s.type.fromJsonValue(s,e,r,{persisting:!0}),this.entityManager.resolveDepth(r,t)}return this.entityManager.load(Object.keys(e)[0])})).then(e=>e.filter(e=>!!e)):Promise.resolve([])}createRealTimeQuery(){const e=this.resultClass?this.entityManager.metamodel.entity(this.resultClass):null;if(!e)throw new Error("Only typed queries can be executed.");const t={bucket:e.name,query:this.serializeQuery()},r=this.serializeSort();return r&&"{}"!==r&&(t.sort=r),this.maxResults>0&&(t.limit=this.maxResults),this.firstResult>0&&(t.offset=this.firstResult),t}addOrder(e,t){return"string"==typeof e?this.order[e]=t:this.order=e,this}addOffset(e){return this.firstResult=e,this}addLimit(e){return this.maxResults=e,this}}const p={where(e){return this.addFilter(null,null,e)},equal(e,t){return this.addFilter(e,null,t)},notEqual(e,t){return this.addFilter(e,"$ne",t)},greaterThan(e,t){return this.addFilter(e,"$gt",t)},greaterThanOrEqualTo(e,t){return this.addFilter(e,"$gte",t)},lessThan(e,t){return this.addFilter(e,"$lt",t)},lessThanOrEqualTo(e,t){return this.addFilter(e,"$lte",t)},between(e,t,r){return this.addFilter(e,"$gt",t).addFilter(e,"$lt",r)},in(e,...t){return this.addFilter(e,"$in",i(t))},notIn(e,...t){return this.addFilter(e,"$nin",i(t))},isNull(e){return this.equal(e,null)},isNotNull(e){return this.addFilter(e,"$exists",!0).addFilter(e,"$ne",null)},containsAll(e,...t){return this.addFilter(e,"$all",i(t))},mod(e,t,r){return this.addFilter(e,"$mod",[t,r])},matches(e,t){const r=t instanceof RegExp?t:new RegExp(t);if(r.ignoreCase)throw new Error("RegExp.ignoreCase flag is not supported.");if(r.global)throw new Error("RegExp.global flag is not supported.");if(0!==r.source.indexOf("^"))throw new Error("regExp must be an anchored expression, i.e. it must be started with a ^.");const s=this.addFilter(e,"$regex",r.source);return r.multiline&&s.addFilter(e,"$options","m"),s},size(e,t){return this.addFilter(e,"$size",t)},near(e,t,r){return this.addFilter(e,"$nearSphere",{$geometry:{type:"Point",coordinates:[t.longitude,t.latitude]},$maxDistance:r})},withinPolygon(e,...t){const r=i(t);return this.addFilter(e,"$geoWithin",{$geometry:{type:"Polygon",coordinates:[r.map(e=>[e.longitude,e.latitude])]}})}};Object.assign(p,{eq:p.equal,ne:p.notEqual,lt:p.lessThan,le:p.lessThanOrEqualTo,gt:p.greaterThan,ge:p.greaterThanOrEqualTo,containsAny:p.in});class f extends l{constructor(){super(...arguments),this.filter={}}addFilter(e,t,r){if(null!==e){if("string"!=typeof e)throw new Error("Field must be a string.");if(t){const s=this.filter[e];let n;"object"==typeof s&&Object.getPrototypeOf(s)===Object.prototype?n=s:(n={},this.filter[e]=n),n[t]=r}else this.filter[e]=r}else Object.assign(this.filter,r);return this}toJSON(){return this.filter}}Object.assign(f.prototype,p);class g extends l{constructor(e,t,r,s){super(e,t),this.operator=r,this.childes=s}toJSON(){const e={};return e[this.operator]=this.childes,e}}class y extends n{and(...e){return this.addOperator("$and",i(e))}or(...e){return this.addOperator("$or",i(e))}nor(...e){return this.addOperator("$nor",i(e))}eventStream(e,t,r,s){return this.where({}).eventStream(e,t,r,s)}resultStream(e,t,r,s){return this.where({}).resultStream(e,t,r,s)}resultList(e,t,r){return this.where({}).resultList(e,t,r)}singleResult(e,t,r){return this.where({}).singleResult(e,t,r)}count(e,t){return this.where({}).count(e,t)}addOperator(e,t){if(t.length<2)throw new Error(`Only two or more queries can be joined with an ${e} operator.`);return t.forEach((e,t)=>{if(!(e instanceof l))throw new Error(`Argument at index ${t} is not a query.`)}),new g(this.entityManager,this.resultClass,e,t)}addOrder(e,t){return new f(this.entityManager,this.resultClass).addOrder(e,t)}addFilter(e,t,r){return new f(this.entityManager,this.resultClass).addFilter(e,t,r)}addOffset(e){return new f(this.entityManager,this.resultClass).addOffset(e)}addLimit(e){return new f(this.entityManager,this.resultClass).addLimit(e)}}Object.assign(y.prototype,p)},function(e,t,r){"use strict";r.r(t),r.d(t,"EntityPartialUpdateBuilder",(function(){return c})),r.d(t,"PartialUpdateBuilder",(function(){return i}));class s{constructor(e,t,r){this.name=e,this.path=t,this.value=r}}const n=["$add","$and","$currentDate","$dec","$inc","$max","$min","$mul","$or","$pop","$push","$put","$remove","$rename","$replace","$set","$shift","$unshift","$xor"];class i{constructor(e){this.operations=[],e&&this.addOperations(e)}set(e,t){let r=t;if(r instanceof Set)r=Array.from(r);else if(r instanceof Map){const e={};r.forEach((t,r)=>{e[r]=t}),r=e}return this.addOperation(e,"$set",r)}inc(e,t){return this.addOperation(e,"$inc","number"==typeof t?t:1)}dec(e,t){return this.inc(e,"number"==typeof t?-t:-1)}mul(e,t){if("number"!=typeof t)throw new Error("Multiplicator must be a number.");return this.addOperation(e,"$mul",t)}div(e,t){if("number"!=typeof t)throw new Error("Divisor must be a number.");return this.addOperation(e,"$mul",1/t)}min(e,t){if("number"!=typeof t)throw new Error("Value must be a number");return this.addOperation(e,"$min",t)}max(e,t){if("number"!=typeof t)throw new Error("Value must be a number");return this.addOperation(e,"$max",t)}remove(e,t){return this.addOperation(e,"$remove",t)}put(e,t,r){const s={};return"string"==typeof t||"number"==typeof t?s[t]=r:"object"==typeof t&&Object.assign(s,t),this.addOperation(e,"$put",s)}push(e,t){return this.addOperation(e,"$push",t)}unshift(e,t){return this.addOperation(e,"$unshift",t)}pop(e){return this.addOperation(e,"$pop")}shift(e){return this.addOperation(e,"$shift")}add(e,t){return this.addOperation(e,"$add",t)}replace(e,t,r){if(this.hasOperationOnPath(e))throw new Error(`You cannot update ${e} multiple times`);return this.addOperation(`${e}.${t}`,"$replace",r)}currentDate(e){return this.addOperation(e,"$currentDate")}and(e,t){return this.addOperation(e,"$and",t)}or(e,t){return this.addOperation(e,"$or",t)}xor(e,t){return this.addOperation(e,"$xor",t)}rename(e,t){return this.addOperation(e,"$rename",t)}toJSON(){return this.operations.reduce((e,t)=>Object.assign(Object.assign({},e),{[t.name]:Object.assign(Object.assign({},e[t.name]),{[t.path]:t.value})}),{})}execute(){throw new Error('Cannot call "execute" on abstract PartialUpdateBuilder')}addOperation(e,t,r){if("string"!=typeof e)throw new Error("Path must be a string");if(-1===n.indexOf(t))throw new Error("Operation invalid: "+t);if(this.hasOperationOnPath(e))throw new Error(`You cannot update ${e} multiple times`);if("number"==typeof r){if(Number.isNaN(r))throw new Error("NaN is not a supported value");if(!Number.isFinite(r))throw new Error("Infinity is not a supported value")}const i=new s(t,e,void 0===r?null:r);return this.operations.push(i),this}addOperations(e){Object.keys(e).forEach(t=>{const r=e[t];Object.keys(r).forEach(e=>{const n=r[e];this.operations.push(new s(t,e,n))})})}hasOperationOnPath(e){return this.operations.some(t=>t.path===e)}}Object.assign(i.prototype,{increment:i.prototype.inc,decrement:i.prototype.dec,multiply:i.prototype.mul,divide:i.prototype.div,atMost:i.prototype.min,atLeast:i.prototype.max,toNow:i.prototype.currentDate});var a=r(2),o=r(1);class c extends i{constructor(e,t){super(t),this.entity=e}execute(){const e=o.Metadata.get(this.entity),t=JSON.stringify(this),r=new a.UpdatePartially(e.bucket,e.key,t);return e.withLock(()=>e.db.send(r).then(t=>(e.type.fromJsonValue(e,t.entity,this.entity,{persisting:!0}),this.entity)))}}},function(e,t,r){"use strict";r.r(t),r.d(t,"BloomFilter",(function(){return n}));var s=r(4);class n{constructor(e){this.bytes=Object(s.atob)(e.b),this.bits=e.m,this.hashes=e.h,this.creation=Date.now()}contains(e){const t=n.getHashes(e,this.bits,this.hashes);for(let e=0,r=t.length;e<r;e+=1)if(!this.isSet(t[e]))return!1;return!0}isSet(e){const t=Math.floor(e/8),r=1<<e%8;return 0!=(this.bytes.charCodeAt(t)&r)}static getHashes(e,t,r){const s=new Array(r),i=n.murmur3(0,e),a=n.murmur3(i,e);for(let e=0;e<r;e+=1)s[e]=(i+e*a)%t;return s}static murmur3(e,t){const r=3&t.length,s=t.length-r,n=3432918353,i=461845907;let a,o,c,u;for(a=e,u=0;u<s;)c=255&t.charCodeAt(u)|(255&t.charCodeAt(u+=1))<<8|(255&t.charCodeAt(u+=1))<<16|(255&t.charCodeAt(u+=1))<<24,u+=1,c=(65535&c)*n+(((c>>>16)*n&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*i+(((c>>>16)*i&65535)<<16)&4294967295,a^=c,a=a<<13|a>>>19,o=5*(65535&a)+((5*(a>>>16)&65535)<<16)&4294967295,a=27492+(65535&o)+((58964+(o>>>16)&65535)<<16);switch(c=0,r){case 3:c^=(255&t.charCodeAt(u+2))<<16;case 2:c^=(255&t.charCodeAt(u+1))<<8;case 1:c^=255&t.charCodeAt(u),c=(65535&c)*n+(((c>>>16)*n&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*i+(((c>>>16)*i&65535)<<16)&4294967295,a^=c}return a^=t.length,a^=a>>>16,a=2246822507*(65535&a)+((2246822507*(a>>>16)&65535)<<16)&4294967295,a^=a>>>13,a=3266489909*(65535&a)+((3266489909*(a>>>16)&65535)<<16)&4294967295,a^=a>>>16,a>>>0}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));class s{constructor(){this.rules={}}allRules(){return Object.keys(this.rules)}clear(){this.rules={}}copy(e){return this.rules=Object.assign({},e.rules),this}isPublicAllowed(){return!("*"in this.rules)&&!this.allRules().some(e=>"allow"===this.rules[e])}setPublicAllowed(){this.allRules().forEach(e=>{"allow"===this.rules[e]&&delete this.rules[e]})}getRule(e){return this.rules[this.ref(e)]}isAllowed(e){return"allow"===this.rules[this.ref(e)]}isDenied(e){return"deny"===this.rules[this.ref(e)]}allowAccess(...e){for(let t=0;t<e.length;t+=1)this.rules[this.ref(e[t])]="allow";return this}denyAccess(...e){for(let t=0;t<e.length;t+=1)this.rules[this.ref(e[t])]="deny";return this}deleteAccess(...e){for(let t=0;t<e.length;t+=1)delete this.rules[this.ref(e[t])];return this}toJSON(){return Object.assign({},this.rules)}fromJSON(e){this.rules=e}static fromJSON(e){const t=new this;return t.fromJSON(e),t}ref(e){const t="string"==typeof e?e:e.id;if(0===t.indexOf("/db/User/")||0===t.indexOf("/db/Role/"))return t;throw new TypeError("The given object isn't a user, role or a valid reference.")}}s.BASE_PERMISSIONS=["load","update","delete","query","insert"]},function(e,t,r){"use strict";function s(){throw new Error("This functionality is only available, if the optional rxjs dependency is also provided.")}r.d(t,"a",(function(){return i}));let n={Observable:s,Subscription:s,Subscriber:s};try{n=r(20)}catch(e){}const{Observable:i,Subscription:a,Subscriber:o}=n},function(e,t){},function(e,t){},function(e,t){},function(e,t){if("undefined"==typeof rxjs){var r=new Error("Cannot find module 'rxjs'");throw r.code="MODULE_NOT_FOUND",r}e.exports=rxjs},function(e,t){if("undefined"==typeof validator){var r=new Error("Cannot find module 'validator'");throw r.code="MODULE_NOT_FOUND",r}e.exports=validator},function(e,t,r){"use strict";r.r(t),r.d(t,"binding",(function(){return n})),r.d(t,"connector",(function(){return i})),r.d(t,"error",(function(){return a})),r.d(t,"message",(function(){return o})),r.d(t,"metamodel",(function(){return c})),r.d(t,"util",(function(){return u})),r.d(t,"intersection",(function(){return d})),r.d(t,"caching",(function(){return h})),r.d(t,"query",(function(){return l})),r.d(t,"partialupdate",(function(){return p})),r.d(t,"model",(function(){return f})),r.d(t,"EntityManagerFactory",(function(){return g.a})),r.d(t,"EntityManager",(function(){return y.a})),r.d(t,"Acl",(function(){return m.a})),r.d(t,"GeoPoint",(function(){return b.a})),r.d(t,"db",(function(){return s.db})),r.d(t,"connect",(function(){return E})),r.d(t,"configure",(function(){return w})),r.d(t,"Set",(function(){return T})),r.d(t,"List",(function(){return v})),r.d(t,"Map",(function(){return S}));var s=r(9),n=r(3),i=r(0),a=r(5),o=r(2),c=r(6),u=r(4),d=r(1),h=r(14),l=r(12),p=r(13),f=r(19),g=r(11),y=r(10),m=r(7),b=r(8);function O(e,t,r,s){Object.keys(s).forEach(n=>{const i=Object(u.deprecated)(r.replace("$export",n));Object.defineProperty(e,n,i(t,n,{get:()=>s[n]}))})}function w(){throw new Error("Please use Baqend.db.configure() or import { db } from 'baqend' instead.")}function E(){throw new Error("Please use Baqend.db.connect() or import { db } from 'baqend' instead.")}O(u,"util","intersection.$export",{Permission:d.Permission,Metadata:d.Metadata,TokenStorage:d.TokenStorage,Validator:d.Validator,PushMessage:d.PushMessage,Code:d.Code,Modules:d.Modules,Logger:d.Logger}),O(y.a.prototype,"db","import { $export } from 'baqend'",{db:s.db,binding:n,connector:i,error:a,message:o,util:u,caching:h,query:l,partialupdate:p,intersection:d,EntityManagerFactory:g.a,EntityManager:y.a,Acl:m.a}),O(c.Metamodel.prototype,"metamodel","import { metamodel } from 'baqend';",c);const T=Set,S=Map,v=Array;t.default=s.db}]);void 0===Baqend&&console.error("esm-webpack-plugin: nothing exported!");const _Baqend$binding=Baqend.binding,_Baqend$connector=Baqend.connector,_Baqend$error=Baqend.error,_Baqend$message=Baqend.message,_Baqend$metamodel=Baqend.metamodel,_Baqend$util=Baqend.util,_Baqend$intersection=Baqend.intersection,_Baqend$caching=Baqend.caching,_Baqend$query=Baqend.query,_Baqend$partialupdate=Baqend.partialupdate,_Baqend$model=Baqend.model,_Baqend$EntityManagerFactory=Baqend.EntityManagerFactory,_Baqend$EntityManager=Baqend.EntityManager,_Baqend$Acl=Baqend.Acl,_Baqend$GeoPoint=Baqend.GeoPoint,_Baqend$db=Baqend.db,_Baqend$connect=Baqend.connect,_Baqend$configure=Baqend.configure,_Baqend$Set=Baqend.Set,_Baqend$List=Baqend.List,_Baqend$Map=Baqend.Map;export default Baqend.default;export{_Baqend$binding as binding,_Baqend$connector as connector,_Baqend$error as error,_Baqend$message as message,_Baqend$metamodel as metamodel,_Baqend$util as util,_Baqend$intersection as intersection,_Baqend$caching as caching,_Baqend$query as query,_Baqend$partialupdate as partialupdate,_Baqend$model as model,_Baqend$EntityManagerFactory as EntityManagerFactory,_Baqend$EntityManager as EntityManager,_Baqend$Acl as Acl,_Baqend$GeoPoint as GeoPoint,_Baqend$db as db,_Baqend$connect as connect,_Baqend$configure as configure,_Baqend$Set as Set,_Baqend$List as List,_Baqend$Map as Map};
//# sourceMappingURL=baqend.es2015.min.js.map