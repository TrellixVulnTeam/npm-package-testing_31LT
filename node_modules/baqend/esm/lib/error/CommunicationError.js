import { PersistentError } from './PersistentError';
export class CommunicationError extends PersistentError {
    /**
     * @param httpMessage The http message which was send
     * @param response The received entity headers and content
     */
    constructor(httpMessage, response) {
        const entity = response.entity || response.error || {};
        const state = (response.status === 0 ? 'Request' : 'Response');
        const message = entity.message
            || (httpMessage && `Handling the ${state} for ${httpMessage.request.method} ${httpMessage.request.path}`)
            || 'A communication error occurred.';
        super(message, entity);
        this.name = entity.className || 'CommunicationError';
        this.reason = entity.reason || 'Communication failed';
        this.status = response.status;
        if (entity.data) {
            this.data = entity.data;
        }
        let cause = entity;
        while (cause && cause.stackTrace) {
            this.stack += `\nServerside Caused by: ${cause.className} ${cause.message}`;
            const { stackTrace } = cause;
            for (let i = 0; i < stackTrace.length; i += 1) {
                const el = stackTrace[i];
                this.stack += `\n    at ${el.className}.${el.methodName}`;
                this.stack += ` (${el.fileName}:${el.lineNumber})`;
            }
            cause = cause.cause;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tbXVuaWNhdGlvbkVycm9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2Vycm9yL0NvbW11bmljYXRpb25FcnJvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFJcEQsTUFBTSxPQUFPLGtCQUFtQixTQUFRLGVBQWU7SUFnQnJEOzs7T0FHRztJQUNILFlBQVksV0FBMkIsRUFBRSxRQUFrQjtRQUN6RCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO1FBQ3ZELE1BQU0sS0FBSyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDL0QsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU87ZUFDdkIsQ0FBQyxXQUFXLElBQUksZ0JBQWdCLEtBQUssUUFBUSxXQUFXLENBQUMsT0FBTyxDQUFDLE1BQU0sSUFBSSxXQUFXLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO2VBQ3RHLGlDQUFpQyxDQUFDO1FBRXpDLEtBQUssQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFdkIsSUFBSSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsU0FBUyxJQUFJLG9CQUFvQixDQUFDO1FBQ3JELElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sSUFBSSxzQkFBc0IsQ0FBQztRQUN0RCxJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFFOUIsSUFBSSxNQUFNLENBQUMsSUFBSSxFQUFFO1lBQ2YsSUFBSSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO1NBQ3pCO1FBRUQsSUFBSSxLQUFLLEdBQUcsTUFBTSxDQUFDO1FBQ25CLE9BQU8sS0FBSyxJQUFJLEtBQUssQ0FBQyxVQUFVLEVBQUU7WUFDaEMsSUFBSSxDQUFDLEtBQUssSUFBSSwyQkFBMkIsS0FBSyxDQUFDLFNBQVMsSUFBSSxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7WUFFNUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxHQUFHLEtBQUssQ0FBQztZQUM3QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUM3QyxNQUFNLEVBQUUsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRXpCLElBQUksQ0FBQyxLQUFLLElBQUksWUFBWSxFQUFFLENBQUMsU0FBUyxJQUFJLEVBQUUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDMUQsSUFBSSxDQUFDLEtBQUssSUFBSSxLQUFLLEVBQUUsQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDLFVBQVUsR0FBRyxDQUFDO2FBQ3BEO1lBRUQsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7U0FDckI7SUFDSCxDQUFDO0NBQ0YifQ==