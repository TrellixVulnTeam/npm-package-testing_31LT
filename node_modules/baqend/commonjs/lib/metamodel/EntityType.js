"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EntityType = void 0;
// eslint-disable-next-line max-classes-per-file
var binding_1 = require("../binding");
var ManagedType_1 = require("./ManagedType");
var Type_1 = require("./Type");
var BasicType_1 = require("./BasicType");
var SingularAttribute_1 = require("./SingularAttribute");
var PluralAttribute_1 = require("./PluralAttribute");
var Attribute_1 = require("./Attribute");
var intersection_1 = require("../intersection");
var EntityType = /** @class */ (function (_super) {
    __extends(EntityType, _super);
    /**
     * @param ref
     * @param superType
     * @param typeConstructor
     */
    function EntityType(ref, superType, typeConstructor) {
        var _this = _super.call(this, ref, typeConstructor) || this;
        _this.declaredId = null;
        _this.declaredVersion = null;
        _this.declaredAcl = null;
        _this.loadPermission = new intersection_1.Permission();
        _this.updatePermission = new intersection_1.Permission();
        _this.deletePermission = new intersection_1.Permission();
        _this.queryPermission = new intersection_1.Permission();
        _this.schemaSubclassPermission = new intersection_1.Permission();
        _this.insertPermission = new intersection_1.Permission();
        _this.superType = superType;
        return _this;
    }
    Object.defineProperty(EntityType.prototype, "persistenceType", {
        /**
         * @inheritDoc
         */
        get: function () {
            return Type_1.PersistenceType.ENTITY;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(EntityType.prototype, "id", {
        get: function () {
            return this.declaredId || this.superType.id;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(EntityType.prototype, "version", {
        get: function () {
            return this.declaredVersion || this.superType.version;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(EntityType.prototype, "acl", {
        get: function () {
            return this.declaredAcl || this.superType.acl;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * @inheritDoc
     */
    EntityType.prototype.createProxyClass = function () {
        var typeConstructor = this.superType.typeConstructor;
        if (typeConstructor === Object) {
            switch (this.name) {
                case 'User':
                    typeConstructor = binding_1.User;
                    break;
                case 'Role':
                    typeConstructor = binding_1.Role;
                    break;
                default:
                    typeConstructor = binding_1.Entity;
                    break;
            }
        }
        return this.enhancer.createProxy(typeConstructor);
    };
    /**
     * Gets all on this class referencing attributes
     *
     * @param db The instances will be found by this EntityManager
     * @param [options] Some options to pass
     * @param [options.classes] An array of class names to filter for, null for no filter
     * @return A map from every referencing class to a set of its referencing attribute names
     */
    EntityType.prototype.getReferencing = function (db, options) {
        var opts = __assign({}, options);
        var entities = db.metamodel.entities;
        var referencing = new Map();
        var names = Object.keys(entities);
        for (var i = 0, len = names.length; i < len; i += 1) {
            var name_1 = names[i];
            // Skip class if not in class filter
            if (!opts.classes || opts.classes.indexOf(name_1) !== -1) {
                var entity = entities[name_1];
                var iter = entity.attributes();
                for (var el = iter.next(); !el.done; el = iter.next()) {
                    var attr = el.value;
                    // Filter only referencing singular and collection attributes
                    if ((attr instanceof SingularAttribute_1.SingularAttribute && attr.type === this)
                        || (attr instanceof PluralAttribute_1.PluralAttribute && attr.elementType === this)) {
                        var typeReferences = referencing.get(attr.declaringType) || new Set();
                        typeReferences.add(attr.name);
                        referencing.set(attr.declaringType, typeReferences);
                    }
                }
            }
        }
        return referencing;
    };
    /**
     * @inheritDoc
     */
    EntityType.prototype.createObjectFactory = function (db) {
        switch (this.name) {
            case 'User':
                return binding_1.UserFactory.create(this, db);
            case 'Device':
                return binding_1.DeviceFactory.create(this, db);
            default:
                return binding_1.EntityFactory.create(this, db);
        }
    };
    /**
     * @param state The root object state, can be <code>null</code> if a currentObject is provided
     * @param jsonObject The json data to merge
     * @param currentObject The object where the jsonObject will be merged into, if the current object is null,
     * a new instance will be created
     * @param options The options used to apply the json
     * @param [options.persisting=false] indicates if the current state will be persisted.
     * Used to update the internal change tracking state of collections and mark the object persistent or dirty afterwards
     * @param [options.onlyMetadata=false] Indicates if only the metadata should be updated
     * @return The merged entity instance
     */
    EntityType.prototype.fromJsonValue = function (state, jsonObject, currentObject, options) {
        var _a, _b;
        // handle references
        if (typeof jsonObject === 'string') {
            return ((_a = state.db) === null || _a === void 0 ? void 0 : _a.getReference(jsonObject)) || null;
        }
        if (!jsonObject || typeof jsonObject !== 'object') {
            return null;
        }
        var json = jsonObject;
        var opt = __assign({ persisting: false, onlyMetadata: false }, options);
        var obj;
        if (currentObject) {
            var currentObjectState = intersection_1.Metadata.get(currentObject);
            // merge state into the current object if:
            // 1. The provided json does not contains an id and we have an already created object for it
            // 2. The object was created without an id and was later fetched from the server (e.g. User/Role)
            // 3. The provided json has the same id as the current object, they can differ on embedded json for a reference
            if (!json.id || !currentObjectState.id || json.id === currentObjectState.id) {
                obj = currentObject;
            }
        }
        if (!obj) {
            obj = (_b = state.db) === null || _b === void 0 ? void 0 : _b.getReference(this.typeConstructor, json.id);
        }
        if (!obj) {
            return null;
        }
        var objectState = intersection_1.Metadata.get(obj);
        // deserialize our properties
        objectState.enable(false);
        _super.prototype.fromJsonValue.call(this, objectState, json, obj, opt);
        objectState.enable(true);
        if (opt.persisting) {
            objectState.setPersistent();
        }
        else if (!opt.onlyMetadata) {
            objectState.setDirty();
        }
        return obj;
    };
    /**
     * Converts the given object to json
     * @param state The root object state
     * @param object The object to convert
     * @param [options=false] to json options by default excludes the metadata
     * @param [options.excludeMetadata=false] Excludes the metadata form the serialized json
     * @param [options.depth=0] Includes up to depth referenced objects into the serialized json
     * @param [options.persisting=false] indicates if the current state will be persisted.
     *  Used to update the internal change tracking state of collections and mark the object persistent if its true
     * @return JSON-Object
     */
    EntityType.prototype.toJsonValue = function (state, object, options) {
        var _a = options || {}, _b = _a.depth, depth = _b === void 0 ? 0 : _b, _c = _a.persisting, persisting = _c === void 0 ? false : _c;
        var isInDepth = depth === true || depth > -1;
        // check if object is already loaded in state
        var objectState = object && intersection_1.Metadata.get(object);
        if (isInDepth && objectState && objectState.isAvailable) {
            // serialize our properties
            objectState.enable(false);
            var json = _super.prototype.toJsonValue.call(this, objectState, object, __assign(__assign({}, options), { persisting: persisting, depth: typeof depth === 'boolean' ? depth : depth - 1 }));
            objectState.enable(true);
            return json;
        }
        if (state.db && object instanceof this.typeConstructor) {
            object.attach(state.db);
            return object.id;
        }
        return null;
    };
    EntityType.prototype.toString = function () {
        return "EntityType(" + this.ref + ")";
    };
    EntityType.prototype.toJSON = function () {
        var _a = _super.prototype.toJSON.call(this), acl = _a.acl, json = __rest(_a, ["acl"]);
        return __assign(__assign({}, json), { acl: __assign(__assign({}, acl), { schemaSubclass: this.schemaSubclassPermission.toJSON(), load: this.loadPermission.toJSON(), insert: this.insertPermission.toJSON(), update: this.updatePermission.toJSON(), delete: this.deletePermission.toJSON(), query: this.queryPermission.toJSON() }) });
    };
    EntityType.Object = /** @class */ (function (_super) {
        __extends(ObjectType, _super);
        function ObjectType() {
            var _this = _super.call(this, EntityType.Object.ref, null, Object) || this;
            _this.declaredId = new /** @class */ (function (_super) {
                __extends(class_1, _super);
                function class_1() {
                    return _super.call(this, 'id', BasicType_1.BasicType.String, true) || this;
                }
                class_1.prototype.getJsonValue = function (state) {
                    return state.id || undefined;
                };
                class_1.prototype.setJsonValue = function (state, object, jsonValue) {
                    if (!state.id) {
                        // eslint-disable-next-line no-param-reassign
                        state.id = jsonValue;
                    }
                };
                return class_1;
            }(SingularAttribute_1.SingularAttribute))();
            _this.declaredId.init(_this, 0);
            _this.declaredId.isId = true;
            _this.declaredVersion = new /** @class */ (function (_super) {
                __extends(class_2, _super);
                function class_2() {
                    return _super.call(this, 'version', BasicType_1.BasicType.Integer, true) || this;
                }
                class_2.prototype.getJsonValue = function (state) {
                    return state.version || undefined;
                };
                class_2.prototype.setJsonValue = function (state, object, jsonValue) {
                    if (jsonValue) {
                        // eslint-disable-next-line no-param-reassign
                        state.version = jsonValue;
                    }
                };
                return class_2;
            }(SingularAttribute_1.SingularAttribute))();
            _this.declaredVersion.init(_this, 1);
            _this.declaredVersion.isVersion = true;
            _this.declaredAcl = new /** @class */ (function (_super) {
                __extends(class_3, _super);
                function class_3() {
                    return _super.call(this, 'acl', BasicType_1.BasicType.JsonObject, true) || this;
                }
                class_3.prototype.getJsonValue = function (state, object, options) {
                    var persisted = Attribute_1.Attribute.attachState(object, {});
                    var persistedAcl = persisted.acl || {};
                    var acl = state.acl.toJSON();
                    var unchanged = Object.keys(acl).every(function (permission) {
                        var oldPermission = (persistedAcl[permission] || {});
                        var newPermission = acl[permission];
                        var newKeys = Object.keys(newPermission);
                        var oldKeys = Object.keys(oldPermission);
                        return newKeys.length === oldKeys.length
                            && newKeys.every(function (ref) { return oldPermission[ref] === newPermission[ref]; });
                    });
                    if (!unchanged) {
                        state.setDirty();
                    }
                    if (options.persisting) {
                        persisted.acl = acl;
                    }
                    return acl;
                };
                class_3.prototype.setJsonValue = function (state, object, jsonValue, options) {
                    var acl = (jsonValue || {});
                    if (options.persisting) {
                        var persistedState = Attribute_1.Attribute.attachState(object, {});
                        persistedState.acl = acl;
                    }
                    state.acl.fromJSON(acl);
                };
                return class_3;
            }(SingularAttribute_1.SingularAttribute))();
            _this.declaredAcl.init(_this, 2);
            _this.declaredAcl.isAcl = true;
            _this.declaredAttributes = [_this.declaredId, _this.declaredVersion, _this.declaredAcl];
            return _this;
        }
        Object.defineProperty(ObjectType, "ref", {
            get: function () {
                return '/db/Object';
            },
            enumerable: false,
            configurable: true
        });
        ObjectType.prototype.createObjectFactory = function () {
            throw new Error("Objects can't be directly created and persisted");
        };
        return ObjectType;
    }(EntityType));
    return EntityType;
}(ManagedType_1.ManagedType));
exports.EntityType = EntityType;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW50aXR5VHlwZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9tZXRhbW9kZWwvRW50aXR5VHlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLGdEQUFnRDtBQUNoRCxzQ0FFb0I7QUFHcEIsNkNBQTRDO0FBQzVDLCtCQUF5QztBQUN6Qyx5Q0FBd0M7QUFDeEMseURBQXdEO0FBR3hELHFEQUFvRDtBQUNwRCx5Q0FBd0M7QUFDeEMsZ0RBQXFFO0FBRXJFO0lBQWtELDhCQUFjO0lBNEk5RDs7OztPQUlHO0lBQ0gsb0JBQVksR0FBVyxFQUFFLFNBQTBCLEVBQUUsZUFBMEI7UUFBL0UsWUFDRSxrQkFBTSxHQUFHLEVBQUUsZUFBZSxDQUFDLFNBRTVCO1FBN0NNLGdCQUFVLEdBQXFDLElBQUksQ0FBQztRQUVwRCxxQkFBZSxHQUFxQyxJQUFJLENBQUM7UUFFekQsaUJBQVcsR0FBa0MsSUFBSSxDQUFDO1FBRWxELG9CQUFjLEdBQWUsSUFBSSx5QkFBVSxFQUFFLENBQUM7UUFFOUMsc0JBQWdCLEdBQWUsSUFBSSx5QkFBVSxFQUFFLENBQUM7UUFFaEQsc0JBQWdCLEdBQWUsSUFBSSx5QkFBVSxFQUFFLENBQUM7UUFFaEQscUJBQWUsR0FBZSxJQUFJLHlCQUFVLEVBQUUsQ0FBQztRQUUvQyw4QkFBd0IsR0FBZSxJQUFJLHlCQUFVLEVBQUUsQ0FBQztRQUV4RCxzQkFBZ0IsR0FBZSxJQUFJLHlCQUFVLEVBQUUsQ0FBQztRQTRCckQsS0FBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7O0lBQzdCLENBQUM7SUF4QkQsc0JBQUksdUNBQWU7UUFIbkI7O1dBRUc7YUFDSDtZQUNFLE9BQU8sc0JBQWUsQ0FBQyxNQUFNLENBQUM7UUFDaEMsQ0FBQzs7O09BQUE7SUFFRCxzQkFBSSwwQkFBRTthQUFOO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUks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