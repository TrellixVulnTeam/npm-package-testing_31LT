"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.CommunicationError = void 0;
var PersistentError_1 = require("./PersistentError");
var CommunicationError = /** @class */ (function (_super) {
    __extends(CommunicationError, _super);
    /**
     * @param httpMessage The http message which was send
     * @param response The received entity headers and content
     */
    function CommunicationError(httpMessage, response) {
        var _this = this;
        var entity = response.entity || response.error || {};
        var state = (response.status === 0 ? 'Request' : 'Response');
        var message = entity.message
            || (httpMessage && "Handling the " + state + " for " + httpMessage.request.method + " " + httpMessage.request.path)
            || 'A communication error occurred.';
        _this = _super.call(this, message, entity) || this;
        _this.name = entity.className || 'CommunicationError';
        _this.reason = entity.reason || 'Communication failed';
        _this.status = response.status;
        if (entity.data) {
            _this.data = entity.data;
        }
        var cause = entity;
        while (cause && cause.stackTrace) {
            _this.stack += "\nServerside Caused by: " + cause.className + " " + cause.message;
            var stackTrace = cause.stackTrace;
            for (var i = 0; i < stackTrace.length; i += 1) {
                var el = stackTrace[i];
                _this.stack += "\n    at " + el.className + "." + el.methodName;
                _this.stack += " (" + el.fileName + ":" + el.lineNumber + ")";
            }
            cause = cause.cause;
        }
        return _this;
    }
    return CommunicationError;
}(PersistentError_1.PersistentError));
exports.CommunicationError = CommunicationError;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29tbXVuaWNhdGlvbkVycm9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2Vycm9yL0NvbW11bmljYXRpb25FcnJvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEscURBQW9EO0FBSXBEO0lBQXdDLHNDQUFlO0lBZ0JyRDs7O09BR0c7SUFDSCw0QkFBWSxXQUEyQixFQUFFLFFBQWtCO1FBQTNELGlCQStCQztRQTlCQyxJQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO1FBQ3ZELElBQU0sS0FBSyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDL0QsSUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU87ZUFDdkIsQ0FBQyxXQUFXLElBQUksa0JBQWdCLEtBQUssYUFBUSxXQUFXLENBQUMsT0FBTyxDQUFDLE1BQU0sU0FBSSxXQUFXLENBQUMsT0FBTyxDQUFDLElBQU0sQ0FBQztlQUN0RyxpQ0FBaUMsQ0FBQztRQUV6QyxRQUFBLGtCQUFNLE9BQU8sRUFBRSxNQUFNLENBQUMsU0FBQztRQUV2QixLQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLElBQUksb0JBQW9CLENBQUM7UUFDckQsS0FBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxJQUFJLHNCQUFzQixDQUFDO1FBQ3RELEtBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUU5QixJQUFJLE1BQU0sQ0FBQyxJQUFJLEVBQUU7WUFDZixLQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7U0FDekI7UUFFRCxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUM7UUFDbkIsT0FBTyxLQUFLLElBQUksS0FBSyxDQUFDLFVBQVUsRUFBRTtZQUNoQyxLQUFJLENBQUMsS0FBSyxJQUFJLDZCQUEyQixLQUFLLENBQUMsU0FBUyxTQUFJLEtBQUssQ0FBQyxPQUFTLENBQUM7WUFFcEUsSUFBQSxVQUFVLEdBQUssS0FBSyxXQUFWLENBQVc7WUFDN0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDN0MsSUFBTSxFQUFFLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUV6QixLQUFJLENBQUMsS0FBSyxJQUFJLGNBQVksRUFBRSxDQUFDLFNBQVMsU0FBSSxFQUFFLENBQUMsVUFBWSxDQUFDO2dCQUMxRCxLQUFJLENBQUMsS0FBSyxJQUFJLE9BQUssRUFBRSxDQUFDLFFBQVEsU0FBSSxFQUFFLENBQUMsVUFBVSxNQUFHLENBQUM7YUFDcEQ7WUFFRCxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztTQUNyQjs7SUFDSCxDQUFDO0lBQ0gseUJBQUM7QUFBRCxDQUFDLEFBcERELENBQXdDLGlDQUFlLEdBb0R0RDtBQXBEWSxnREFBa0IifQ==